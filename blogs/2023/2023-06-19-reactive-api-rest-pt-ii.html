<!DOCTYPE html>
<html lang="es-ES">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Crea tu API REST reactiva con Kotlin y Ktor Parte II | José Luis González</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="favicon.png">
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-103H05W8P8"></script>
    <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
      
          gtag('config', 'G-103H05W8P8');
    </script>
    <script async="true" src="https://code.iconify.design/2/2.2.1/iconify.min.js"></script>
    <script type="module" async="true" src="https://unpkg.com/giscus?module"></script>
    <meta name="description" content="Cómo crear un servicio REST aplicando reactividad y consideraciones a tener en cuenta para ello">
    <meta property="og:image" content="https://miro.medium.com/v2/resize:fit:720/format:webp/1*0f7cDW-SPHD23LtnVi2Bgw.png">
    <meta property="og:image:type">
    <meta property="og:image:width">
    <meta property="og:image:height">
    <meta property="og:image:alt">
    <meta name="twitter:image" content="https://miro.medium.com/v2/resize:fit:720/format:webp/1*0f7cDW-SPHD23LtnVi2Bgw.png">
    <meta itemprop="image" content="https://miro.medium.com/v2/resize:fit:720/format:webp/1*0f7cDW-SPHD23LtnVi2Bgw.png">
    <meta property="og:description" content="Cómo crear un servicio REST aplicando reactividad y consideraciones a tener en cuenta para ello">
    <meta name="twitter:description" content="Cómo crear un servicio REST aplicando reactividad y consideraciones a tener en cuenta para ello">
    <meta itemprop="description" content="Cómo crear un servicio REST aplicando reactividad y consideraciones a tener en cuenta para ello">
    <meta property="og:url" content="https://joseluisgs.dev/blogs/2023/2023-06-19-reactive-api-rest-pt-ii.html">
    <meta name="twitter:url" content="https://joseluisgs.dev/blogs/2023/2023-06-19-reactive-api-rest-pt-ii.html">
    <meta property="og:title" content="Crea tu API REST reactiva con Kotlin y Ktor Parte II">
    <meta name="twitter:title" content="Crea tu API REST reactiva con Kotlin y Ktor Parte II">
    <meta itemprop="name" content="Crea tu API REST reactiva con Kotlin y Ktor Parte II">
    <meta property="og:type" content="article">
    <meta name="twitter:card" content="summary_large_image">
    <meta property="og:site_name" content="José Luis González - Web">
    <meta name="twitter:creator" content="@JoseLuisGS_">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta name="author" content="José Luis González Sánchez">
    <meta name="application-name" content="José Luis González Sánchez. Web Personal">
    <meta name="keywords" content="José Luis González Sánchez, Profesor, Formador, Desarrollador, Investigador, Desarrollo de Aplicaciones, Web, Multiplataforma, FP, Formación Profesional, Kotlin, Trainer, Certificación, Jetbrains, Embajador, GIT, GitKraken, Vuejs, móvil, jetbrains, intellij, hyperskill, docker, mongodb, nodejs, node, android, compose, backend, java, spring, springboot, instituto, test, pruebas, calidad, Luis Vives, Leganés, Madrid, Universidad de Granada, Jugabilidad, Videojuegos">
    <meta name="google-site-verification" content="6faOYM6NoaSKvkuz4Qexps8JgYe65lIQukYB5eScb90">
    
    <link rel="preload" href="/assets/css/0.styles.6f259648.css" as="style"><link rel="preload" href="/assets/js/app.6f62f259.js" as="script"><link rel="preload" href="/assets/js/3.33813761.js" as="script"><link rel="preload" href="/assets/js/1.35f3822e.js" as="script"><link rel="preload" href="/assets/js/50.bb80fe18.js" as="script"><link rel="prefetch" href="/assets/js/10.d30b2d9d.js"><link rel="prefetch" href="/assets/js/11.681bda01.js"><link rel="prefetch" href="/assets/js/12.9ad81fbc.js"><link rel="prefetch" href="/assets/js/13.f3464028.js"><link rel="prefetch" href="/assets/js/14.b84cc3c1.js"><link rel="prefetch" href="/assets/js/15.c42379f5.js"><link rel="prefetch" href="/assets/js/16.57b5d478.js"><link rel="prefetch" href="/assets/js/17.9a72ddc2.js"><link rel="prefetch" href="/assets/js/18.ae1da3d7.js"><link rel="prefetch" href="/assets/js/19.3fbf0958.js"><link rel="prefetch" href="/assets/js/20.bf5f823a.js"><link rel="prefetch" href="/assets/js/21.5b6a71d3.js"><link rel="prefetch" href="/assets/js/22.3f27c70d.js"><link rel="prefetch" href="/assets/js/23.e4bc4b3a.js"><link rel="prefetch" href="/assets/js/24.50bcb3f5.js"><link rel="prefetch" href="/assets/js/25.dd784bc9.js"><link rel="prefetch" href="/assets/js/26.4b38f250.js"><link rel="prefetch" href="/assets/js/27.66350ee8.js"><link rel="prefetch" href="/assets/js/28.707ca0d7.js"><link rel="prefetch" href="/assets/js/29.d6bfd850.js"><link rel="prefetch" href="/assets/js/30.1cbfb936.js"><link rel="prefetch" href="/assets/js/31.55928574.js"><link rel="prefetch" href="/assets/js/32.5745cab7.js"><link rel="prefetch" href="/assets/js/33.3e36d24a.js"><link rel="prefetch" href="/assets/js/34.1f219f46.js"><link rel="prefetch" href="/assets/js/35.d2552993.js"><link rel="prefetch" href="/assets/js/36.ea1706b1.js"><link rel="prefetch" href="/assets/js/37.60ed081e.js"><link rel="prefetch" href="/assets/js/38.40c291df.js"><link rel="prefetch" href="/assets/js/39.12c63280.js"><link rel="prefetch" href="/assets/js/4.383314b2.js"><link rel="prefetch" href="/assets/js/40.97aebc9d.js"><link rel="prefetch" href="/assets/js/41.30d1fb33.js"><link rel="prefetch" href="/assets/js/42.1e673a10.js"><link rel="prefetch" href="/assets/js/43.5312190c.js"><link rel="prefetch" href="/assets/js/44.b3ed0efd.js"><link rel="prefetch" href="/assets/js/45.22f4e0dc.js"><link rel="prefetch" href="/assets/js/46.55fe05af.js"><link rel="prefetch" href="/assets/js/47.1a9344d0.js"><link rel="prefetch" href="/assets/js/48.36eb6102.js"><link rel="prefetch" href="/assets/js/49.4a088336.js"><link rel="prefetch" href="/assets/js/5.c9f6f19d.js"><link rel="prefetch" href="/assets/js/51.d36620f5.js"><link rel="prefetch" href="/assets/js/52.60bb72bf.js"><link rel="prefetch" href="/assets/js/53.056804be.js"><link rel="prefetch" href="/assets/js/54.5e175738.js"><link rel="prefetch" href="/assets/js/55.7bea9611.js"><link rel="prefetch" href="/assets/js/56.e81be917.js"><link rel="prefetch" href="/assets/js/57.cf28891d.js"><link rel="prefetch" href="/assets/js/58.346b8713.js"><link rel="prefetch" href="/assets/js/59.70b79180.js"><link rel="prefetch" href="/assets/js/6.01c382b0.js"><link rel="prefetch" href="/assets/js/60.94043774.js"><link rel="prefetch" href="/assets/js/61.d678e770.js"><link rel="prefetch" href="/assets/js/62.a978c62f.js"><link rel="prefetch" href="/assets/js/63.146a7ee3.js"><link rel="prefetch" href="/assets/js/64.f95e0801.js"><link rel="prefetch" href="/assets/js/65.8f50d717.js"><link rel="prefetch" href="/assets/js/66.06006e4f.js"><link rel="prefetch" href="/assets/js/67.fbb3b04d.js"><link rel="prefetch" href="/assets/js/68.f3334193.js"><link rel="prefetch" href="/assets/js/69.bfbdee99.js"><link rel="prefetch" href="/assets/js/7.66cf5c8a.js"><link rel="prefetch" href="/assets/js/70.b78e849b.js"><link rel="prefetch" href="/assets/js/71.97da63dc.js"><link rel="prefetch" href="/assets/js/72.ed5c561f.js"><link rel="prefetch" href="/assets/js/73.448f38ec.js"><link rel="prefetch" href="/assets/js/74.82b0b6a4.js"><link rel="prefetch" href="/assets/js/75.840300fb.js"><link rel="prefetch" href="/assets/js/76.1aca1c1b.js"><link rel="prefetch" href="/assets/js/77.5c52ab74.js"><link rel="prefetch" href="/assets/js/78.bf774e87.js"><link rel="prefetch" href="/assets/js/79.c7702bd6.js"><link rel="prefetch" href="/assets/js/8.3b721c95.js"><link rel="prefetch" href="/assets/js/80.2c33fe4d.js"><link rel="prefetch" href="/assets/js/81.820e6160.js"><link rel="prefetch" href="/assets/js/82.f8150889.js"><link rel="prefetch" href="/assets/js/83.40c96bb2.js"><link rel="prefetch" href="/assets/js/9.6546a01f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6f259648.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-1aefc0b4><div data-v-1aefc0b4><div id="loader-wrapper" class="loading-wrapper" data-v-3c97ba04 data-v-1aefc0b4 data-v-1aefc0b4><div class="loader-main" data-v-3c97ba04><div data-v-3c97ba04></div><div data-v-3c97ba04></div><div data-v-3c97ba04></div><div data-v-3c97ba04></div></div> <!----> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-25ba6db2 data-v-1aefc0b4 data-v-1aefc0b4><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>José Luis González</h3> <p class="description" data-v-25ba6db2 data-v-25ba6db2>Web personal de José Luis González Sánchez</p> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><span data-v-25ba6db2>José Luis González</span>
            
          <span data-v-25ba6db2>2021 - </span>
          2025
        </a></span></div></div> <div class="hide" data-v-1aefc0b4><header class="navbar" data-v-1aefc0b4><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="José Luis González" class="logo"> <span class="site-name">JoseLuisGS</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><ul class="color-mode-options"><li class="dark"><span data-icon="bxs:moon" class="iconify"></span></li><li class="auto active"><span data-icon="ic:baseline-brightness-auto" class="iconify"></span></li><li class="light"><span data-icon="bxs:sun" class="iconify"></span></li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link" data-v-20159458><i class="iconfont reco-home" data-v-20159458></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-account"></i>
      Info
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/info/personal/" class="nav-link" data-v-20159458><i class="iconfont reco-theme" data-v-20159458></i>
  Personal
</a></li><li class="dropdown-item"><!----> <a href="/docs/info/investigacion/" class="nav-link" data-v-20159458><i class="iconfont reco-blog" data-v-20159458></i>
  Investigación
</a></li></ul></div></div><div class="nav-item"><a href="/docs/docencia/" class="nav-link" data-v-20159458><i class="iconfont reco-suggestion" data-v-20159458></i>
  Docencia
</a></div><div class="nav-item"><a href="/docs/proyectos/" class="nav-link" data-v-20159458><i class="iconfont reco-api" data-v-20159458></i>
  Proyectos
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Categorías
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Blog/" class="nav-link" data-v-20159458><i class="undefined" data-v-20159458></i>
  Blog
</a></li><li class="dropdown-item"><!----> <a href="/categories/Personal/" class="nav-link" data-v-20159458><i class="undefined" data-v-20159458></i>
  Personal
</a></li><li class="dropdown-item"><!----> <a href="/categories/Docencia/" class="nav-link" data-v-20159458><i class="undefined" data-v-20159458></i>
  Docencia
</a></li><li class="dropdown-item"><!----> <a href="/categories/Proyectos/" class="nav-link" data-v-20159458><i class="undefined" data-v-20159458></i>
  Proyectos
</a></li><li class="dropdown-item"><!----> <a href="/categories/Investigación/" class="nav-link" data-v-20159458><i class="undefined" data-v-20159458></i>
  Investigación
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link" data-v-20159458><i class="iconfont reco-tag" data-v-20159458></i>
  Etiquetas
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link" data-v-20159458><i class="iconfont reco-date" data-v-20159458></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contacto
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://forms.gle/V2m42qiW1s6X4oNt8" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-20159458><i data-icon="mdi:help-circle" class="iconify-inline iconfont" data-v-20159458></i> 
  Ayuda
  <span data-v-20159458><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/joseluisgs" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-20159458><i data-icon="mdi:github" class="iconify-inline iconfont" data-v-20159458></i> 
  GitHub
  <span data-v-20159458><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://x.com/JoseLuisGS_" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-20159458><i data-icon="fa6-brands:x-twitter" class="iconify-inline iconfont" data-v-20159458></i> 
  X-Twitter
  <span data-v-20159458><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.linkedin.com/in/joseluisgonsan" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-20159458><i data-icon="mdi:linkedin" class="iconify-inline iconfont" data-v-20159458></i> 
  LinkedIn
  <span data-v-20159458><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.instagram.com/joseluisgs.dev" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-20159458><i data-icon="mdi:instagram" class="iconify-inline iconfont" data-v-20159458></i> 
  Instagram
  <span data-v-20159458><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://g.dev/joseluisgs" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-20159458><i data-icon="raphael:code" class="iconify-inline iconfont" data-v-20159458></i> 
  Google Dev
  <span data-v-20159458><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.youtube.com/@joseluisgs" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-20159458><i data-icon="mdi:youtube" class="iconify-inline iconfont" data-v-20159458></i> 
  YouTube
  <span data-v-20159458><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-1aefc0b4></div> <aside class="sidebar" data-v-1aefc0b4><div class="personal-info-wrapper" data-v-bb904086 data-v-1aefc0b4><img src="/img/avatar.jpeg" alt="author-avatar" class="personal-img" data-v-bb904086> <h3 class="name" data-v-bb904086>
    José Luis González
  </h3> <h5 class="trabajo" data-v-bb904086>
    PhD - Profesor<br data-v-bb904086>
    Investigador - Desarrollador<br data-v-bb904086>
    Kotlin Trainer certified by Jetbrains<br data-v-bb904086>
    Github Campus Advisor<br data-v-bb904086>
    GitKraken Ambassador<br data-v-bb904086></h5> <ul class="social-links" data-v-bb904086><li class="social-item" data-v-bb904086><a href="https://github.com/joseluisgs" target="_blank" class="social-link" data-v-bb904086><i data-icon="mdi:github" class="iconify-inline social-icon" style="color:#AAA;" data-v-bb904086></i></a></li><li class="social-item" data-v-bb904086><a href="https://x.com/JoseLuisGS_" target="_blank" class="social-link" data-v-bb904086><i data-icon="fa6-brands:x-twitter" class="iconify-inline social-icon" style="color:#888;" data-v-bb904086></i></a></li><li class="social-item" data-v-bb904086><a href="https://www.linkedin.com/in/joseluisgonsan" target="_blank" class="social-link" data-v-bb904086><i data-icon="mdi:linkedin" class="iconify-inline social-icon" style="color:#0077B5;" data-v-bb904086></i></a></li><li class="social-item" data-v-bb904086><a href="https://www.instagram.com/joseluisgs.dev" target="_blank" class="social-link" data-v-bb904086><i data-icon="mdi:instagram" class="iconify-inline social-icon" style="color:#e56969;" data-v-bb904086></i></a></li><li class="social-item" data-v-bb904086><a href="https://g.dev/joseluisgs" target="_blank" class="social-link" data-v-bb904086><i data-icon="raphael:code" class="iconify-inline social-icon" style="color:#e81055;" data-v-bb904086></i></a></li><li class="social-item" data-v-bb904086><a href="https://www.youtube.com/@joseluisgs" target="_blank" class="social-link" data-v-bb904086><i data-icon="mdi:youtube" class="iconify-inline social-icon" style="color:#E62117;" data-v-bb904086></i></a></li></ul> <div class="num" data-v-bb904086><div data-v-bb904086><h3 data-v-bb904086>69</h3> <h6 data-v-bb904086>Artículos</h6></div> <div data-v-bb904086><h3 data-v-bb904086>30</h3> <h6 data-v-bb904086>Etiquetas</h6></div></div> <hr data-v-bb904086></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link" data-v-20159458><i class="iconfont reco-home" data-v-20159458></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-account"></i>
      Info
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/info/personal/" class="nav-link" data-v-20159458><i class="iconfont reco-theme" data-v-20159458></i>
  Personal
</a></li><li class="dropdown-item"><!----> <a href="/docs/info/investigacion/" class="nav-link" data-v-20159458><i class="iconfont reco-blog" data-v-20159458></i>
  Investigación
</a></li></ul></div></div><div class="nav-item"><a href="/docs/docencia/" class="nav-link" data-v-20159458><i class="iconfont reco-suggestion" data-v-20159458></i>
  Docencia
</a></div><div class="nav-item"><a href="/docs/proyectos/" class="nav-link" data-v-20159458><i class="iconfont reco-api" data-v-20159458></i>
  Proyectos
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Categorías
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Blog/" class="nav-link" data-v-20159458><i class="undefined" data-v-20159458></i>
  Blog
</a></li><li class="dropdown-item"><!----> <a href="/categories/Personal/" class="nav-link" data-v-20159458><i class="undefined" data-v-20159458></i>
  Personal
</a></li><li class="dropdown-item"><!----> <a href="/categories/Docencia/" class="nav-link" data-v-20159458><i class="undefined" data-v-20159458></i>
  Docencia
</a></li><li class="dropdown-item"><!----> <a href="/categories/Proyectos/" class="nav-link" data-v-20159458><i class="undefined" data-v-20159458></i>
  Proyectos
</a></li><li class="dropdown-item"><!----> <a href="/categories/Investigación/" class="nav-link" data-v-20159458><i class="undefined" data-v-20159458></i>
  Investigación
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link" data-v-20159458><i class="iconfont reco-tag" data-v-20159458></i>
  Etiquetas
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link" data-v-20159458><i class="iconfont reco-date" data-v-20159458></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contacto
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://forms.gle/V2m42qiW1s6X4oNt8" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-20159458><i data-icon="mdi:help-circle" class="iconify-inline iconfont" data-v-20159458></i> 
  Ayuda
  <span data-v-20159458><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/joseluisgs" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-20159458><i data-icon="mdi:github" class="iconify-inline iconfont" data-v-20159458></i> 
  GitHub
  <span data-v-20159458><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://x.com/JoseLuisGS_" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-20159458><i data-icon="fa6-brands:x-twitter" class="iconify-inline iconfont" data-v-20159458></i> 
  X-Twitter
  <span data-v-20159458><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.linkedin.com/in/joseluisgonsan" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-20159458><i data-icon="mdi:linkedin" class="iconify-inline iconfont" data-v-20159458></i> 
  LinkedIn
  <span data-v-20159458><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.instagram.com/joseluisgs.dev" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-20159458><i data-icon="mdi:instagram" class="iconify-inline iconfont" data-v-20159458></i> 
  Instagram
  <span data-v-20159458><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://g.dev/joseluisgs" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-20159458><i data-icon="raphael:code" class="iconify-inline iconfont" data-v-20159458></i> 
  Google Dev
  <span data-v-20159458><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.youtube.com/@joseluisgs" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-20159458><i data-icon="mdi:youtube" class="iconify-inline iconfont" data-v-20159458></i> 
  YouTube
  <span data-v-20159458><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-25ba6db2 data-v-1aefc0b4><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>Crea tu API REST reactiva con Kotlin y Ktor Parte II</h3> <!----> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><span data-v-25ba6db2>José Luis González</span>
            
          <span data-v-25ba6db2>2021 - </span>
          2025
        </a></span></div></div> <div data-v-1aefc0b4><main class="page"><div class="page-title"><h1 class="title">Crea tu API REST reactiva con Kotlin y Ktor Parte II</h1> <div data-v-4ed97042><i class="iconfont reco-account" data-v-4ed97042><span data-v-4ed97042>José Luis González</span></i> <div class="page-info" data-v-4ed97042><i class="iconfont reco-date" data-v-4ed97042><span data-v-4ed97042>19/6/2023</span></i> <i class="iconfont reco-eye" data-v-4ed97042><span data-v-4ed97042>30 min.</span></i></div> <i class="tags iconfont reco-tag" data-v-4ed97042><span class="tag-item" data-v-4ed97042>Proyectos</span><span class="tag-item" data-v-4ed97042>Blog</span><span class="tag-item" data-v-4ed97042>Docencia</span><span class="tag-item" data-v-4ed97042>Kotlin</span><span class="tag-item" data-v-4ed97042>Ktor</span></i></div> <img src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*0f7cDW-SPHD23LtnVi2Bgw.png" alt="Image noticia"></div> <div class="theme-reco-content content__default"><p>Continuamos con nuestro tutorial de cómo  crear una API REST Reactiva y cómo asentar las bases de este paradigma en el desarrollo de servicios como ya vimos en la <a href="/blogs/2023/2023-05-29-reactive-api-rest-pt-i.html">primera parte</a>. Te recuerdo que esta serie de artículos forman parte de mis actividades con <a href="https://hyperskill.org/" target="_blank" rel="noopener noreferrer">Hyperskill<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> de <a href="https://lp.jetbrains.com/jba-students/" target="_blank" rel="noopener noreferrer">Jetbrains Academy<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Se basan en la traducción de lo publicado Medium. Recomiendo que leáis el original en inglés y votéis para que sigan saliendo más partes: <a href="https://medium.com/p/7b6b087f61e7" target="_blank" rel="noopener noreferrer">Creating Your Reactive REST API with Kotlin and Ktor Part II<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <div class="custom-block warning"><p class="title">Sobre la traducción</p><p>Lamentablemente no tengo tiempo para traducir todos los artículos que escribo, para continuar con la primera parte he usado ChatGPT y pulido los errores que me he encontrado. De nuevo te recomiendo la lectura del original en inglés si buscas el 100% de exactitud: <a href="https://medium.com/p/7b6b087f61e7" target="_blank" rel="noopener noreferrer">Creating Your Reactive REST API with Kotlin and Ktor Part II<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p></div><h2 id="introduccion"><a href="#introduccion" class="header-anchor">#</a> Introducción</h2> <p>Estos tutoriales tienen como objetivo mostrarte todo lo que aprenderás a través de los tracks de <a href="https://hyperskill.org/" target="_blank" rel="noopener noreferrer">Hyperskill<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> de <a href="https://lp.jetbrains.com/jba-students/" target="_blank" rel="noopener noreferrer">Jetbrains Academy<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Hyperskill es el lugar perfecto para profundizar, ampliar tus conocimientos y aprender más sobre lo que se presenta en este tutorial. Es la plataforma ideal para aprender tecnologías de Kotlin y utilizar Ktor. Siéntete libre de unirte y continuar tu viaje de aprendizaje. Recuerda que este código es pedagógico y muestra muchos de los contenidos que aprenderás en Hyperskill de manera didáctica y fácil de leer. No tiene la intención de crear el mejor código de producción en entornos reales. Sabemos que muchas cosas se pueden hacer mejor, pero se exageran en el código para que, como estudiante, puedas analizar las posibilidades.</p> <p>Esta parte es un poco larga porque creamos toda la estructura de características increíbles de nuestro servicio. Tómalo con calma y visita Hyperskill para obtener más funciones geniales para tus servicios de Kotlin y Ktor. No dudes en experimentar y modificar lo que pueda mejorar tu auto-codificación con diferentes ejemplos y alcanzar tus objetivos.</p> <p style="text-align:center;"><img loading="lazy" src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*0f7cDW-SPHD23LtnVi2Bgw.png" style="border-radius:0.25rem;"></p> <h2 id="dtos-y-mappers"><a href="#dtos-y-mappers" class="header-anchor">#</a> DTOs y Mappers</h2> <p>Nuestro primer punto es mejorar las solicitudes y respuestas. Para lograr esto, introduciremos un patrón interesante: <a href="https://martinfowler.com/eaaCatalog/dataTransferObject.html" target="_blank" rel="noopener noreferrer">DTO<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (Objeto de Transferencia de Datos). <strong>DTO</strong> (Data Transfer Object) es un patrón de diseño utilizado para transferir datos entre diferentes componentes o capas de una aplicación. Encapsula datos, proporcionando una estructura estandarizada para la comunicación y desacoplando estos datos de los modelos de datos subyacentes. Los DTOs optimizan el rendimiento al reducir la cantidad de datos transferidos y permiten un control detallado sobre la información intercambiada. Mejoran la organización y mantenibilidad del código, y facilitan la evolución de las estructuras de datos.</p> <p style="text-align:center;"><img loading="lazy" src="https://miro.medium.com/v2/resize:fit:640/1*5bs8hF6tXjhyX0PDsqR8yQ.gif" style="border-radius:0.25rem;"></p> <p>Gracias a los DTOs, podemos encapsular las solicitudes y respuestas mapeando entidades o diferentes tipos de datos entre ellos. Por ejemplo, imagina que tienes un formato de fecha específico (bastante común), pero lo almacenas en un formato diferente. Con los DTOs, puedes solicitar la fecha como una cadena y almacenarla en el formato adecuado. Además, puedes validar los datos para garantizar su corrección antes de procesarlos. Es posible que no necesitemos todos los datos de nuestra entidad &quot;Racket&quot; (o POKO, Plain Old Kotlin Object) para crear o actualizarla.</p> <p>Además, tampoco necesariamente tenemos que enviar todos los datos. Cada solicitud y respuesta puede requerir información específica. Aquí es donde los DTOs nos brindan más libertad en el proceso. Aunque no es obligatorio, dependiendo del problema, se recomienda usar DTOs para lograr una mejor flexibilidad y control sobre el proceso de intercambio de datos. Utilizamos DTO como objetos serializables con Kotlin en lugar de nuestra entidad POKO.</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token annotation builtin">@Serializable</span>
<span class="token keyword">data</span> <span class="token keyword">class</span> <span class="token function">RacketRequest</span><span class="token punctuation">(</span>
   <span class="token keyword">val</span> brand<span class="token operator">:</span> String<span class="token punctuation">,</span>
   <span class="token keyword">val</span> model<span class="token operator">:</span> String<span class="token punctuation">,</span>
   <span class="token keyword">val</span> price<span class="token operator">:</span> Double<span class="token punctuation">,</span>
   <span class="token keyword">val</span> numberTenisPlayers<span class="token operator">:</span> Int <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
   <span class="token keyword">val</span> image<span class="token operator">:</span> String <span class="token operator">=</span> DEFAULT_IMAGE<span class="token punctuation">,</span>
<span class="token punctuation">)</span>


<span class="token annotation builtin">@Serializable</span>
<span class="token keyword">data</span> <span class="token keyword">class</span> <span class="token function">RacketResponse</span><span class="token punctuation">(</span>
   <span class="token keyword">val</span> id<span class="token operator">:</span> Long<span class="token punctuation">,</span>
   <span class="token keyword">val</span> brand<span class="token operator">:</span> String<span class="token punctuation">,</span>
   <span class="token keyword">val</span> model<span class="token operator">:</span> String<span class="token punctuation">,</span>
   <span class="token keyword">val</span> price<span class="token operator">:</span> Double<span class="token punctuation">,</span>
   <span class="token keyword">val</span> numberTenisPlayers<span class="token operator">:</span> Int<span class="token punctuation">,</span>
   <span class="token keyword">val</span> image<span class="token operator">:</span> String<span class="token punctuation">,</span>
   <span class="token annotation builtin">@Serializable</span><span class="token punctuation">(</span>with <span class="token operator">=</span> LocalDateTimeSerializer<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span>
   <span class="token keyword">val</span> createdAt<span class="token operator">:</span> LocalDateTime<span class="token punctuation">,</span>
   <span class="token keyword">val</span> updatedAt<span class="token operator">:</span> String<span class="token punctuation">,</span>
   <span class="token keyword">val</span> isDeleted<span class="token operator">:</span> Boolean <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>Si tenemos una clase POKO y varias clases DTO, el siguiente paso es utilizar un mapeador entre ellos. Utilizaremos funciones de extensión que mapean desde RacketRequest a Racket y desde Racket a RacketResponse en un archivo RacketMapper en el paquete Mappers.</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token keyword">fun</span> RacketRequest<span class="token punctuation">.</span><span class="token function">toModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">Racket</span><span class="token punctuation">(</span>
   brand <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>brand<span class="token punctuation">,</span>
   model <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>model<span class="token punctuation">,</span>
   price <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>price<span class="token punctuation">,</span>
   numberTenisPlayers <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>numberTenisPlayers<span class="token punctuation">,</span>
   image <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>image
<span class="token punctuation">)</span>

<span class="token keyword">fun</span> Racket<span class="token punctuation">.</span><span class="token function">toResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">RacketResponse</span><span class="token punctuation">(</span>
   id <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">,</span>
   brand <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>brand<span class="token punctuation">,</span>
   model <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>model<span class="token punctuation">,</span>
   price <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>price<span class="token punctuation">,</span>
   numberTenisPlayers <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>numberTenisPlayers<span class="token punctuation">,</span>
   image <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>image<span class="token punctuation">,</span>
   createdAt <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>createdAt<span class="token punctuation">,</span>
   updatedAt <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>updatedAt<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
   isDeleted <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>isDeleted
<span class="token punctuation">)</span>

<span class="token keyword">fun</span> List<span class="token operator">&lt;</span>Racket<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">toResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> it<span class="token punctuation">.</span><span class="token function">toResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>En este ejemplo, estamos complicando un poco las cosas. Sin embargo, obtenemos flexibilidad para futuras expansiones y la capacidad de adaptar las solicitudes y respuestas a nuestras necesidades. Puedes aprender todos estos detalles en nuestras pistas de Hyperskill.</p> <h2 id="validaciones-y-paginas-de-estado"><a href="#validaciones-y-paginas-de-estado" class="header-anchor">#</a> Validaciones y Páginas de Estado</h2> <p>Uno de nuestros problemas fundamentales es asegurarnos de que la información recibida sea correcta en el dominio del problema o de acuerdo con los requisitos de información. Por ejemplo, no tiene sentido que nuestra raqueta tenga un precio negativo o que tengamos una marca o modelo vacío. Podríamos llenar nuestro código con condicionales para asegurar esta tarea y lanzar excepciones, pero Ktor tiene varios complementos para ayudarnos en esta misión.</p> <p>Para asegurar la corrección de la información entrante, podemos utilizar el complemento <a href="https://ktor.io/docs/request-validation.html" target="_blank" rel="noopener noreferrer">RequestValidation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> en Ktor. Este complemento nos permite validar el cuerpo de las solicitudes entrantes. Ya sea que estemos validando un cuerpo de solicitud sin procesar o propiedades específicas de un objeto de solicitud, el complemento RequestValidation nos cubre. Podemos mejorar aún más nuestras capacidades de validación si también se instala el complemento ContentNegotiation con un serializador. En caso de que falle la validación del cuerpo de la solicitud, el complemento genera una excepción RequestValidationException. Podemos manejar esta excepción utilizando el complemento <a href="https://ktor.io/docs/status-pages.html" target="_blank" rel="noopener noreferrer">StatusPages<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, lo que nos permite manejar los errores de validación de manera elegante en nuestra aplicación.</p> <p>Agregamos las siguientes dependencias en nuestro archivo build.gradle.kts y sincronizamos el proyecto.</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token comment">// Content Validation</span>
<span class="token function">implementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;io.ktor:ktor-server-request-validation:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">ktor_version</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
<span class="token comment">// Server Status Pages</span>
<span class="token function">implementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;io.ktor:ktor-server-status-pages:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">ktor_version</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Ahora configuramos los complementos; en el archivo principal de la aplicación, agregamos dos líneas nuevas:</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token keyword">fun</span> Application<span class="token punctuation">.</span><span class="token function">module</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token function">configureSerialization</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Configure the serialization plugin</span>
   <span class="token function">configureRouting</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Configure the routing plugin</span>
   <span class="token function">configureValidation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Configure the validation plugin</span>
   <span class="token function">configureStatusPages</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Configure the status pages plugin</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>En nuestro paquete de plugins, agregamos lo siguiente: <strong>Validation.kt</strong>.</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token keyword">fun</span> Application<span class="token punctuation">.</span><span class="token function">configureValidation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token function">install</span><span class="token punctuation">(</span>RequestValidation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token function">racketValidation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>En nuestro archivo <strong>StatusPages.kt</strong>:</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token keyword">fun</span> Application<span class="token punctuation">.</span><span class="token function">configureStatusPages</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token function">install</span><span class="token punctuation">(</span>StatusPages<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       exception<span class="token operator">&lt;</span>RequestValidationException<span class="token operator">&gt;</span> <span class="token punctuation">{</span> call<span class="token punctuation">,</span> cause <span class="token operator">-&gt;</span>
           call<span class="token punctuation">.</span><span class="token function">respond</span><span class="token punctuation">(</span>HttpStatusCode<span class="token punctuation">.</span>BadRequest<span class="token punctuation">,</span> cause<span class="token punctuation">.</span>reasons<span class="token punctuation">.</span><span class="token function">joinToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Con el primer complemento, establecemos todas las reglas de validación. En el segundo, definimos cómo responderemos de forma predeterminada para cada excepción que ocurra en Ktor. Para evitar programar todas las reglas de validación en el mismo archivo, crearemos un paquete llamado &quot;Validations&quot; y colocaremos cada validación de entidad en él. De manera similar, podemos hacer lo mismo con las páginas de estado.</p> <p>Presentemos las reglas de validación para la entidad Racket. Si la validación falla, lanzará una RequestValidationException y la respuesta devolverá un código de estado de Solicitud Incorrecta (400), gracias a las páginas de estado.</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token keyword">fun</span> RequestValidationConfig<span class="token punctuation">.</span><span class="token function">racketValidation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   validate<span class="token operator">&lt;</span>RacketRequest<span class="token operator">&gt;</span> <span class="token punctuation">{</span> racket <span class="token operator">-&gt;</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>racket<span class="token punctuation">.</span>brand<span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> racket<span class="token punctuation">.</span>brand<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           ValidationResult<span class="token punctuation">.</span><span class="token function">Invalid</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Brand must be at least 3 characters long&quot;</span></span><span class="token punctuation">)</span>
       <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>racket<span class="token punctuation">.</span>model<span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           ValidationResult<span class="token punctuation">.</span><span class="token function">Invalid</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Model must not be empty&quot;</span></span><span class="token punctuation">)</span>
       <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>racket<span class="token punctuation">.</span>price <span class="token operator">&lt;</span> <span class="token number">0.0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           ValidationResult<span class="token punctuation">.</span><span class="token function">Invalid</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Price must be positive value or zero&quot;</span></span><span class="token punctuation">)</span>
       <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>racket<span class="token punctuation">.</span>numberTenisPlayers <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           ValidationResult<span class="token punctuation">.</span><span class="token function">Invalid</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Number of tennis players must be positive number or zero&quot;</span></span><span class="token punctuation">)</span>
       <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
           <span class="token comment">// Everything is ok!</span>
           ValidationResult<span class="token punctuation">.</span>Valid
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>Ahora podemos mostrar un ejemplo utilizando Postman para probarlo. Ahora podemos ver que una vez que el DTO de solicitud llega a nuestra ruta (endpoint) en una solicitud POST o PUT, el middleware de validación actuará automáticamente. Si alguna de las restricciones especificadas no se cumple, recibiremos una RequestValidationException. Esta excepción será manejada por el sistema de páginas de estado, que recuperará el mensaje de excepción y el código de error indicado.</p> <p style="text-align:center;"><img loading="lazy" src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*9cFmnBiEKZXLct14jzgtCg.png" style="border-radius:0.25rem;"></p> <p>También podemos utilizar esta idea para generar una respuesta de Bad Request cuando el parámetro &quot;id&quot; (para buscar, actualizar o eliminar) no es un número válido.</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token comment">// When we try to convert a string to a number and it fails we respond with a 400 Bad Request</span>
exception<span class="token operator">&lt;</span>NumberFormatException<span class="token operator">&gt;</span> <span class="token punctuation">{</span> call<span class="token punctuation">,</span> cause <span class="token operator">-&gt;</span>
   call<span class="token punctuation">.</span><span class="token function">respond</span><span class="token punctuation">(</span>HttpStatusCode<span class="token punctuation">.</span>BadRequest<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">cause<span class="token punctuation">.</span>message</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">. The input param is not a valid number&quot;</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Y aplicarlo en nuestra ruta. Si se produce una NumberFormatException, será gestionada y la página de estado (Status Page) hará su magia.</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code>call<span class="token punctuation">.</span>parameters<span class="token punctuation">[</span><span class="token string-literal singleline"><span class="token string">&quot;id&quot;</span></span><span class="token punctuation">]</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">toLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">{</span> id <span class="token operator">-&gt;</span>
   racketsService<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p style="text-align:center;"><img loading="lazy" src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lrOW88hgq--TZ8gbrgv8og.png" style="border-radius:0.25rem;"></p> <h2 id="almacenamiento-reactivo-en-la-base-de-datos"><a href="#almacenamiento-reactivo-en-la-base-de-datos" class="header-anchor">#</a> Almacenamiento Reactivo en la Base de Datos</h2> <p>Sabemos que tener un almacenamiento en memoria puede resultar tedioso. Implementemos nuestro repositorio para trabajar con una base de datos reactiva. Ahora, esta es una nueva alternativa; ¿qué nos proporciona?</p> <p>La diferencia principal entre <strong>JDBC</strong> (Java Database Connectivity) y <strong>R2DBC</strong> (Reactive Relational Database Connectivity) radica en su enfoque y funcionamiento.</p> <p>JDBC es una API tradicionalmente utilizada en entornos Java para interactuar de manera síncrona con bases de datos relacionales. Sigue un enfoque de bloqueo, lo que significa que cada operación de la base de datos bloquea el hilo de ejecución hasta que se completa. Esto puede resultar en una escalabilidad limitada, especialmente en aplicaciones que requieren un alto rendimiento y concurrencia.</p> <p>Por otro lado, R2DBC es una API reactiva diseñada para la interacción asíncrona y reactiva con bases de datos relacionales. Permite operaciones de base de datos sin bloqueo, lo que significa que el hilo principal de ejecución no se bloquea. En su lugar, utiliza notificaciones y devoluciones de llamada para manejar eventos de manera eficiente. Esto permite una mejor escalabilidad y un rendimiento mejorado en aplicaciones que requieren una alta capacidad de respuesta y el manejo de múltiples solicitudes concurrentes.</p> <p style="text-align:center;"><img loading="lazy" src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*MMAwbU5H8dRUmTejDC7bAw.png" style="border-radius:0.25rem;"></p> <p>Recuerda, la elección entre JDBC y R2DBC depende de los requisitos específicos de la aplicación y la preferencia por un enfoque síncrono o reactivo. JDBC es una API síncrona que bloquea los hilos de ejecución, mientras que R2DBC es una API reactiva que permite operaciones sin bloqueo y un manejo más eficiente de las solicitudes concurrentes. Sin embargo, esto es una API totalmente reactiva, por lo que seleccionamos un enfoque de base de datos reactivo. Podemos aprender más sobre esta pregunta o alternativa específica en las pistas de Hyperskill.</p> <p>El primer paso es seleccionar una biblioteca que nos ayude a programar con una base de datos reactiva. Utilizaremos <a href="https://ufoss.org/kotysa/kotysa.html" target="_blank" rel="noopener noreferrer">Kotysa<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Kotysa es un ORM ligero que ofrece una forma idiomática de escribir SQL seguro en términos de tipos de Kotlin utilizando el enfoque JDBC o R2DBC. En modo reactivo, proporciona una API de cliente SQL utilizando funciones suspendidas y Flow de kotlinx.coroutines. Lo utilizaremos como base de datos relacional. Utilizaremos H2 porque podemos utilizarlo como una base de datos en memoria para este proceso de desarrollo.</p> <p>Una vez más, agregamos las siguientes dependencias en nuestro archivo build.gradle.kts y sincronizamos el proyecto.</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token function">implementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;org.ufoss.kotysa:kotysa-r2dbc:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">kotysa_version</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
<span class="token function">implementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;io.r2dbc:r2dbc-h2:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">h2_r2dbc_version</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="configuracion-de-la-aplicacion"><a href="#configuracion-de-la-aplicacion" class="header-anchor">#</a> Configuración de la aplicación</h3> <p>Nuestro primer paso es configurar nuestra aplicación para el uso de la base de datos. Para ello, agregaremos opciones a nuestro archivo application.conf para conectarnos a nuestra base de datos, como la URL de conexión, nombre de usuario y contraseña. Incluiremos una clave especial para inicializar los datos en modo de desarrollo.</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>database <span class="token punctuation">{</span>
   driver = <span class="token string">&quot;h2&quot;</span>
   protocol =<span class="token string">&quot;mem&quot;</span>
   user = <span class="token string">&quot;sa&quot;</span>
   user = $<span class="token punctuation">{</span>?DATABASE_USER<span class="token punctuation">}</span>
   password = <span class="token string">&quot;&quot;</span>
   password = $<span class="token punctuation">{</span>?DATABASE_PASSWORD<span class="token punctuation">}</span>
   database = <span class="token string">&quot;r2dbc:h2:mem:///rackets;DB_CLOSE_DELAY=-1&quot;</span>
   database = $<span class="token punctuation">{</span>?DATABASE_NAME<span class="token punctuation">}</span>
   ## Init database data
   initDatabaseData = <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="definiendo-tablas-y-entidades"><a href="#definiendo-tablas-y-entidades" class="header-anchor">#</a> Definiendo Tablas y Entidades</h3> <p>El siguiente paso es definir la estructura de nuestras tablas y la entidad de fila para mapear los datos. Podemos utilizar nuestro modelo de Racket original POKO. Nuevamente, esto es opcional pero recomendado. Al igual que con los DTOs, esto nos permite mapear los datos entre nuestro modelo POKO y nuestra entidad en caso de incompatibilidades de datos. Hemos elegido este enfoque porque no queremos valores nulos en el campo de ID, pero Kotysa los requiere para determinar si debe generar una clave de autoincremento. <a href="https://github.com/ufoss-org/kotysa/issues/136#issuecomment-1561391983" target="_blank" rel="noopener noreferrer">Este comportamiento podría cambiar en futuras versiones<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. En un nuevo paquete llamado Entities, codificamos la Tabla Racket y la Entidad Racket.</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token keyword">object</span> RacketTable <span class="token operator">:</span> H2Table<span class="token operator">&lt;</span>RacketEntity<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// Autoincrement and primary key</span>
   <span class="token keyword">val</span> id <span class="token operator">=</span> <span class="token function">autoIncrementBigInt</span><span class="token punctuation">(</span>RacketEntity<span class="token operator">::</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">primaryKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token comment">// Other fields</span>
   <span class="token keyword">val</span> brand <span class="token operator">=</span> <span class="token function">varchar</span><span class="token punctuation">(</span>RacketEntity<span class="token operator">::</span>brand<span class="token punctuation">)</span>
   <span class="token keyword">val</span> model <span class="token operator">=</span> <span class="token function">varchar</span><span class="token punctuation">(</span>RacketEntity<span class="token operator">::</span>model<span class="token punctuation">)</span>
   <span class="token keyword">val</span> price <span class="token operator">=</span> <span class="token function">doublePrecision</span><span class="token punctuation">(</span>RacketEntity<span class="token operator">::</span>price<span class="token punctuation">)</span>
   <span class="token keyword">val</span> numberTenisPlayers <span class="token operator">=</span> <span class="token function">integer</span><span class="token punctuation">(</span>RacketEntity<span class="token operator">::</span>numberTenisPlayers<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">&quot;number_tenis_players&quot;</span></span><span class="token punctuation">)</span>
   <span class="token keyword">val</span> image <span class="token operator">=</span> <span class="token function">varchar</span><span class="token punctuation">(</span>RacketEntity<span class="token operator">::</span>image<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">&quot;image&quot;</span></span><span class="token punctuation">)</span>
   <span class="token comment">// metadata</span>
   <span class="token keyword">val</span> createdAt <span class="token operator">=</span> <span class="token function">timestamp</span><span class="token punctuation">(</span>RacketEntity<span class="token operator">::</span>createdAt<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">&quot;created_at&quot;</span></span><span class="token punctuation">)</span>
   <span class="token keyword">val</span> updatedAt <span class="token operator">=</span> <span class="token function">timestamp</span><span class="token punctuation">(</span>RacketEntity<span class="token operator">::</span>updatedAt<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">&quot;updated_at&quot;</span></span><span class="token punctuation">)</span>
   <span class="token keyword">val</span> isDeleted <span class="token operator">=</span> <span class="token function">boolean</span><span class="token punctuation">(</span>RacketEntity<span class="token operator">::</span>isDeleted<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">&quot;is_deleted&quot;</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">data</span> <span class="token keyword">class</span> <span class="token function">RacketEntity</span><span class="token punctuation">(</span>
   <span class="token keyword">val</span> id<span class="token operator">:</span> Long<span class="token operator">?</span><span class="token punctuation">,</span>
   <span class="token keyword">val</span> brand<span class="token operator">:</span> String<span class="token punctuation">,</span>
   <span class="token keyword">val</span> model<span class="token operator">:</span> String<span class="token punctuation">,</span>
   <span class="token keyword">val</span> price<span class="token operator">:</span> Double<span class="token punctuation">,</span>
   <span class="token keyword">val</span> numberTenisPlayers<span class="token operator">:</span> Int <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
   <span class="token keyword">val</span> image<span class="token operator">:</span> String <span class="token operator">=</span> DEFAULT_IMAGE<span class="token punctuation">,</span>
   <span class="token keyword">val</span> createdAt<span class="token operator">:</span> LocalDateTime <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
   <span class="token keyword">val</span> updatedAt<span class="token operator">:</span> LocalDateTime <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
   <span class="token keyword">val</span> isDeleted<span class="token operator">:</span> Boolean <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>Y agregamos los siguientes métodos a nuestro Racket Mapper.</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token keyword">fun</span> RacketEntity<span class="token punctuation">.</span><span class="token function">toModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">Racket</span><span class="token punctuation">(</span>
   id <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">?:</span> Racket<span class="token punctuation">.</span>NEW_RACKET<span class="token punctuation">,</span>
   brand <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>brand<span class="token punctuation">,</span>
   model <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>model<span class="token punctuation">,</span>
   price <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>price<span class="token punctuation">,</span>
   numberTenisPlayers <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>numberTenisPlayers<span class="token punctuation">,</span>
   image <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>image<span class="token punctuation">,</span>
   createdAt <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>createdAt<span class="token punctuation">,</span>
   updatedAt <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>updatedAt<span class="token punctuation">,</span>
   isDeleted <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>isDeleted
<span class="token punctuation">)</span>

<span class="token keyword">fun</span> List<span class="token operator">&lt;</span>RacketEntity<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">toModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> it<span class="token punctuation">.</span><span class="token function">toModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>

<span class="token keyword">fun</span> Racket<span class="token punctuation">.</span><span class="token function">toEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">RacketEntity</span><span class="token punctuation">(</span>
   id <span class="token operator">=</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">==</span> Racket<span class="token punctuation">.</span>NEW_RACKET<span class="token punctuation">)</span> <span class="token keyword">null</span> <span class="token keyword">else</span> <span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">,</span>
   brand <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>brand<span class="token punctuation">,</span>
   model <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>model<span class="token punctuation">,</span>
   price <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>price<span class="token punctuation">,</span>
   numberTenisPlayers <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>numberTenisPlayers<span class="token punctuation">,</span>
   image <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>image<span class="token punctuation">,</span>
   createdAt <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>createdAt<span class="token punctuation">,</span>
   updatedAt <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>updatedAt<span class="token punctuation">,</span>
   isDeleted <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>isDeleted
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h3 id="codificando-el-cliente-del-servicio-de-base-de-datos"><a href="#codificando-el-cliente-del-servicio-de-base-de-datos" class="header-anchor">#</a> Codificando el Cliente del Servicio de Base de Datos</h3> <p>En esta versión inicial, crearemos un Cliente de Servicio de Base de Datos que se encargará de crear dicho cliente, crear las tablas e iniciar los datos. Puedes encontrarlo en el paquete: Services -&gt; Database. Este cliente cargará la configuración y los parámetros de la base de datos desde nuestro archivo application.conf, los cuales inyectaremos en el constructor.</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token keyword">class</span> <span class="token function">DataBaseService</span><span class="token punctuation">(</span>
   <span class="token keyword">private</span> <span class="token keyword">val</span> dataBaseConfig<span class="token operator">:</span> ApplicationConfig <span class="token operator">=</span> <span class="token function">ApplicationConfig</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;application.conf&quot;</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>

   <span class="token keyword">private</span> <span class="token keyword">val</span> connectionFactory <span class="token keyword">by</span> lazy <span class="token punctuation">{</span>
       <span class="token keyword">val</span> options <span class="token operator">=</span> ConnectionFactoryOptions<span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
           <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span>ConnectionFactoryOptions<span class="token punctuation">.</span>DRIVER<span class="token punctuation">,</span> dataBaseConfig<span class="token punctuation">.</span><span class="token function">property</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;database.driver&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
           <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span>ConnectionFactoryOptions<span class="token punctuation">.</span>PROTOCOL<span class="token punctuation">,</span> dataBaseConfig<span class="token punctuation">.</span><span class="token function">property</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;database.protocol&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
           <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span>ConnectionFactoryOptions<span class="token punctuation">.</span>USER<span class="token punctuation">,</span> dataBaseConfig<span class="token punctuation">.</span><span class="token function">property</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;database.user&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
           <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span>ConnectionFactoryOptions<span class="token punctuation">.</span>PASSWORD<span class="token punctuation">,</span> dataBaseConfig<span class="token punctuation">.</span><span class="token function">property</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;database.password&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
           <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span>ConnectionFactoryOptions<span class="token punctuation">.</span>DATABASE<span class="token punctuation">,</span> dataBaseConfig<span class="token punctuation">.</span><span class="token function">property</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;database.database&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
           <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       ConnectionFactories<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">private</span> <span class="token keyword">val</span> initDatabaseData <span class="token keyword">by</span> lazy <span class="token punctuation">{</span>
       dataBaseConfig<span class="token punctuation">.</span><span class="token function">propertyOrNull</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;database.initDatabaseData&quot;</span></span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">toBoolean</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?:</span> <span class="token boolean">false</span>
   <span class="token punctuation">}</span>

   <span class="token comment">// Our client</span>
   <span class="token keyword">val</span> client <span class="token operator">=</span> connectionFactory<span class="token punctuation">.</span><span class="token function">coSqlClient</span><span class="token punctuation">(</span><span class="token function">getTables</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

   <span class="token keyword">init</span> <span class="token punctuation">{</span>
       logger<span class="token punctuation">.</span><span class="token function">debug</span> <span class="token punctuation">{</span> <span class="token string-literal singleline"><span class="token string">&quot;Init DataBaseService&quot;</span></span> <span class="token punctuation">}</span>
       <span class="token function">initDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>

   <span class="token comment">// Our tables</span>
   <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">getTables</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> H2Tables <span class="token punctuation">{</span>
       <span class="token comment">// Return tables</span>
       <span class="token keyword">return</span> <span class="token function">tables</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">h2</span><span class="token punctuation">(</span>RacketTable<span class="token punctuation">)</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">fun</span> <span class="token function">initDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> runBlocking <span class="token punctuation">{</span>
       logger<span class="token punctuation">.</span><span class="token function">debug</span> <span class="token punctuation">{</span> <span class="token string-literal singleline"><span class="token string">&quot;Init DatabaseService&quot;</span></span> <span class="token punctuation">}</span>
       <span class="token function">createTables</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token comment">// Init data</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>initDatabaseData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token function">initDataBaseDataDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   <span class="token comment">// demo data</span>
   <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">initDataBaseDataDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token function">clearDataBaseData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token function">initDataBaseData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>

   <span class="token comment">// Create tables if not exists</span>
   <span class="token keyword">private</span> <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">createTables</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       logger<span class="token punctuation">.</span><span class="token function">debug</span> <span class="token punctuation">{</span> <span class="token string-literal singleline"><span class="token string">&quot;Creating the tables...&quot;</span></span> <span class="token punctuation">}</span>
       launch <span class="token punctuation">{</span>
           client createTableIfNotExists RacketTable
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   <span class="token comment">// Clear all data</span>
   <span class="token keyword">private</span> <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">clearDataBaseData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       logger<span class="token punctuation">.</span><span class="token function">debug</span> <span class="token punctuation">{</span> <span class="token string-literal singleline"><span class="token string">&quot;Deleting data...&quot;</span></span> <span class="token punctuation">}</span>
       launch <span class="token punctuation">{</span>
           client deleteAllFrom RacketTable
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   <span class="token comment">// Init data</span>
   <span class="token keyword">private</span> <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">initDataBaseData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       logger<span class="token punctuation">.</span><span class="token function">debug</span> <span class="token punctuation">{</span> <span class="token string-literal singleline"><span class="token string">&quot;Saving rackets demo data...&quot;</span></span> <span class="token punctuation">}</span>
       launch <span class="token punctuation">{</span>
           <span class="token function">racketsDemoData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span> <span class="token punctuation">{</span>
               client insert it<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>id <span class="token operator">=</span> Racket<span class="token punctuation">.</span>NEW_RACKET<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
           <span class="token punctuation">}</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br></div></div><h3 id="actualizando-el-repositorio-para-usar-nuestro-sistema-de-almacenamiento-en-la-base-de-datos"><a href="#actualizando-el-repositorio-para-usar-nuestro-sistema-de-almacenamiento-en-la-base-de-datos" class="header-anchor">#</a> Actualizando el repositorio para usar nuestro sistema de almacenamiento en la base de datos</h3> <p>Por último, actualizamos nuestro repositorio de rackets para utilizar el sistema de almacenamiento en la base de datos. Inyectamos nuestra dependencia de la base de datos en el constructor.</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token keyword">class</span> <span class="token function">RacketsRepositoryImpl</span><span class="token punctuation">(</span>
   <span class="token keyword">private</span> <span class="token keyword">val</span> dataBaseService<span class="token operator">:</span> DataBaseService
<span class="token punctuation">)</span> <span class="token operator">:</span> RacketsRepository <span class="token punctuation">{</span>

   <span class="token keyword">override</span> <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Flow<span class="token operator">&lt;</span>Racket<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       logger<span class="token punctuation">.</span><span class="token function">debug</span> <span class="token punctuation">{</span> <span class="token string-literal singleline"><span class="token string">&quot;findAll&quot;</span></span> <span class="token punctuation">}</span>
       <span class="token keyword">return</span><span class="token label symbol">@withContext</span> <span class="token punctuation">(</span>dataBaseService<span class="token punctuation">.</span>client selectFrom RacketTable<span class="token punctuation">)</span>
           <span class="token punctuation">.</span><span class="token function">fetchAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> it<span class="token punctuation">.</span><span class="token function">toModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">override</span> <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token operator">:</span> Long<span class="token punctuation">)</span><span class="token operator">:</span> Racket<span class="token operator">?</span> <span class="token operator">=</span> <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       logger<span class="token punctuation">.</span><span class="token function">debug</span> <span class="token punctuation">{</span> <span class="token string-literal singleline"><span class="token string">&quot;findById: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">id</span></span><span class="token string">&quot;</span></span> <span class="token punctuation">}</span>
       <span class="token keyword">return</span><span class="token label symbol">@withContext</span> <span class="token punctuation">(</span>dataBaseService<span class="token punctuation">.</span>client selectFrom RacketTable
               <span class="token keyword">where</span> RacketTable<span class="token punctuation">.</span>id eq id<span class="token punctuation">)</span>
           <span class="token punctuation">.</span><span class="token function">fetchFirstOrNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">toModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">override</span> <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">findAllPageable</span><span class="token punctuation">(</span>page<span class="token operator">:</span> Int<span class="token punctuation">,</span> perPage<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> Flow<span class="token operator">&lt;</span>Racket<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       logger<span class="token punctuation">.</span><span class="token function">debug</span> <span class="token punctuation">{</span> <span class="token string-literal singleline"><span class="token string">&quot;findAllPageable: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">page</span></span><span class="token string">, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">perPage</span></span><span class="token string">&quot;</span></span> <span class="token punctuation">}</span>
       <span class="token keyword">val</span> myLimit <span class="token operator">=</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>perPage <span class="token operator">&gt;</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token number">100L</span> <span class="token keyword">else</span> perPage<span class="token punctuation">.</span><span class="token function">toLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token keyword">val</span> myOffset <span class="token operator">=</span> <span class="token punctuation">(</span>page <span class="token operator">*</span> perPage<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token keyword">return</span><span class="token label symbol">@withContext</span> <span class="token punctuation">(</span>dataBaseService<span class="token punctuation">.</span>client selectFrom RacketTable
               limit myLimit offset myOffset<span class="token punctuation">)</span>
           <span class="token punctuation">.</span><span class="token function">fetchAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> it<span class="token punctuation">.</span><span class="token function">toModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">override</span> <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">findByBrand</span><span class="token punctuation">(</span>brand<span class="token operator">:</span> String<span class="token punctuation">)</span><span class="token operator">:</span> Flow<span class="token operator">&lt;</span>Racket<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       logger<span class="token punctuation">.</span><span class="token function">debug</span> <span class="token punctuation">{</span> <span class="token string-literal singleline"><span class="token string">&quot;findByBrand: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">brand</span></span><span class="token string">&quot;</span></span> <span class="token punctuation">}</span>
       <span class="token keyword">return</span><span class="token label symbol">@withContext</span> <span class="token punctuation">(</span>dataBaseService<span class="token punctuation">.</span>client selectFrom RacketTable<span class="token punctuation">)</span>
           <span class="token punctuation">.</span><span class="token function">fetchAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
           <span class="token punctuation">.</span><span class="token function">filter</span> <span class="token punctuation">{</span> it<span class="token punctuation">.</span>brand<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>brand<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
           <span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> it<span class="token punctuation">.</span><span class="token function">toModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">override</span> <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">save</span><span class="token punctuation">(</span>entity<span class="token operator">:</span> Racket<span class="token punctuation">)</span><span class="token operator">:</span> Racket <span class="token operator">=</span> <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       logger<span class="token punctuation">.</span><span class="token function">debug</span> <span class="token punctuation">{</span> <span class="token string-literal singleline"><span class="token string">&quot;save: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">entity</span></span><span class="token string">&quot;</span></span> <span class="token punctuation">}</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>entity<span class="token punctuation">.</span>id <span class="token operator">==</span> Racket<span class="token punctuation">.</span>NEW_RACKET<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token function">create</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span>
       <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
           <span class="token function">update</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">private</span> <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">create</span><span class="token punctuation">(</span>entity<span class="token operator">:</span> Racket<span class="token punctuation">)</span><span class="token operator">:</span> Racket <span class="token punctuation">{</span>
       <span class="token keyword">val</span> newEntity <span class="token operator">=</span> entity<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>createdAt <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> updatedAt <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
           <span class="token punctuation">.</span><span class="token function">toEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       logger<span class="token punctuation">.</span><span class="token function">debug</span> <span class="token punctuation">{</span> <span class="token string-literal singleline"><span class="token string">&quot;create: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">newEntity</span></span><span class="token string">&quot;</span></span> <span class="token punctuation">}</span>
       <span class="token keyword">return</span> <span class="token punctuation">(</span>dataBaseService<span class="token punctuation">.</span>client insertAndReturn newEntity<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">private</span> <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">update</span><span class="token punctuation">(</span>entity<span class="token operator">:</span> Racket<span class="token punctuation">)</span><span class="token operator">:</span> Racket <span class="token punctuation">{</span>
       logger<span class="token punctuation">.</span><span class="token function">debug</span> <span class="token punctuation">{</span> <span class="token string-literal singleline"><span class="token string">&quot;update: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">entity</span></span><span class="token string">&quot;</span></span> <span class="token punctuation">}</span>
       <span class="token keyword">val</span> updateEntity <span class="token operator">=</span> entity<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>updatedAt <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token punctuation">(</span>dataBaseService<span class="token punctuation">.</span>client update RacketTable
               <span class="token keyword">set</span> RacketTable<span class="token punctuation">.</span>brand eq updateEntity<span class="token punctuation">.</span>brand
               <span class="token keyword">set</span> RacketTable<span class="token punctuation">.</span>model eq updateEntity<span class="token punctuation">.</span>model
               <span class="token keyword">set</span> RacketTable<span class="token punctuation">.</span>price eq updateEntity<span class="token punctuation">.</span>price
               <span class="token keyword">set</span> RacketTable<span class="token punctuation">.</span>numberTenisPlayers eq updateEntity<span class="token punctuation">.</span>numberTenisPlayers
               <span class="token keyword">set</span> RacketTable<span class="token punctuation">.</span>image eq updateEntity<span class="token punctuation">.</span>image
               <span class="token keyword">where</span> RacketTable<span class="token punctuation">.</span>id eq entity<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
           <span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token keyword">return</span> updateEntity<span class="token punctuation">.</span><span class="token function">toModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">override</span> <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">delete</span><span class="token punctuation">(</span>entity<span class="token operator">:</span> Racket<span class="token punctuation">)</span><span class="token operator">:</span> Racket <span class="token punctuation">{</span>
       logger<span class="token punctuation">.</span><span class="token function">debug</span> <span class="token punctuation">{</span> <span class="token string-literal singleline"><span class="token string">&quot;delete: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">entity</span></span><span class="token string">&quot;</span></span> <span class="token punctuation">}</span>
       <span class="token punctuation">(</span>dataBaseService<span class="token punctuation">.</span>client deleteFrom RacketTable
               <span class="token keyword">where</span> RacketTable<span class="token punctuation">.</span>id eq entity<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
           <span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token keyword">return</span> entity
   <span class="token punctuation">}</span>

   <span class="token keyword">override</span> <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">deleteAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       logger<span class="token punctuation">.</span><span class="token function">debug</span> <span class="token punctuation">{</span> <span class="token string-literal singleline"><span class="token string">&quot;deleteAll&quot;</span></span> <span class="token punctuation">}</span>
       dataBaseService<span class="token punctuation">.</span>client deleteAllFrom RacketTable
   <span class="token punctuation">}</span>

   <span class="token keyword">override</span> <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">saveAll</span><span class="token punctuation">(</span>entities<span class="token operator">:</span> Iterable<span class="token operator">&lt;</span>Racket<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token operator">:</span> Flow<span class="token operator">&lt;</span>Racket<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
       logger<span class="token punctuation">.</span><span class="token function">debug</span> <span class="token punctuation">{</span> <span class="token string-literal singleline"><span class="token string">&quot;saveAll: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">entities</span></span><span class="token string">&quot;</span></span> <span class="token punctuation">}</span>
       entities<span class="token punctuation">.</span><span class="token function">forEach</span> <span class="token punctuation">{</span> <span class="token function">save</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span> <span class="token punctuation">}</span>
       <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br></div></div><h2 id="codificando-nuestros-servicios"><a href="#codificando-nuestros-servicios" class="header-anchor">#</a> Codificando nuestros servicios.</h2> <p>El siguiente paso es enriquecer el servicio de API, de modo que encapsule nuestro repositorio como un servicio que incluya diferentes funcionalidades además de guardar la información en una base de datos.</p> <h3 id="cache"><a href="#cache" class="header-anchor">#</a> Caché</h3> <p>El sistema de caché es recomendado para servidores por las siguientes razones:</p> <ul><li>Mejora el rendimiento general almacenando datos de acceso frecuente más cerca del procesador, reduciendo la latencia.</li> <li>Ayuda a reducir la carga en la memoria principal del servidor, permitiendo un acceso más rápido a los datos críticos.</li> <li>La caché minimiza el tráfico de red al servir contenido directamente desde la caché, reduciendo la necesidad de solicitudes de datos repetidas.</li> <li>Mejora la escalabilidad al manejar eficientemente un aumento en las solicitudes de los usuarios y optimizar los recursos del servidor.</li></ul> <p>Utilizamos una caché reactiva, <a href="https://medium.com/r/?url=https%3A%2F%2Freactivecircus.github.io%2Fcache4k%2F" target="_blank" rel="noopener noreferrer">Cache4k<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, para agregarlo a nuestro archivo build.gradle.kts y sincronizar el proyecto.</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token comment">// Cache 4K for in-memory cache</span>
<span class="token function">implementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;io.github.reactivecircus.cache4k:cache4k:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">cache_version</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Para utilizar nuestro servicio de caché, crearemos un servicio llamado CacheService con los parámetros obtenidos de application.conf. En nuestra implementación de <strong>RacketService</strong>, utilizaremos el siguiente algoritmo para utilizar nuestra caché: si solicitamos un racket, lo buscamos en la caché y solo si no existe, lo obtenemos de la base de datos (posteriormente lo agregamos a la caché para búsquedas futuras). Si no existe, devolvemos un error. Actualizamos la caché con los nuevos datos si agregamos o modificamos un racket. Y si eliminamos un racket, lo invalidamos en la caché.
Aquí tienes un prototipo de findById, pero necesitaremos agregar más cosas 😉.</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token keyword">override</span> <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token operator">:</span> Long<span class="token punctuation">)</span><span class="token operator">:</span> Racket <span class="token punctuation">{</span>
   logger<span class="token punctuation">.</span><span class="token function">debug</span> <span class="token punctuation">{</span> <span class="token string-literal singleline"><span class="token string">&quot;findById: search racket by id&quot;</span></span> <span class="token punctuation">}</span>
   <span class="token comment">// find in cache if not found find in repository</span>
   <span class="token keyword">return</span> cacheService<span class="token punctuation">.</span>rackets<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">{</span>
       logger<span class="token punctuation">.</span><span class="token function">debug</span> <span class="token punctuation">{</span> <span class="token string-literal singleline"><span class="token string">&quot;findById: found in cache&quot;</span></span> <span class="token punctuation">}</span>
       it
   <span class="token punctuation">}</span> <span class="token operator">?:</span> run <span class="token punctuation">{</span>
       racketsRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">{</span> racket <span class="token operator">-&gt;</span>
           logger<span class="token punctuation">.</span><span class="token function">debug</span> <span class="token punctuation">{</span> <span class="token string-literal singleline"><span class="token string">&quot;findById: found in repository&quot;</span></span> <span class="token punctuation">}</span>
           cacheService<span class="token punctuation">.</span>rackets<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> racket<span class="token punctuation">)</span>
           racket
       <span class="token punctuation">}</span> <span class="token operator">?:</span> <span class="token keyword">throw</span> <span class="token function">RuntimeException</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Racket not found&quot;</span></span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="railway-oriented-programming-rop"><a href="#railway-oriented-programming-rop" class="header-anchor">#</a> Railway Oriented Programming (ROP)</h3> <p><a href="https://medium.com/r/?url=https%3A%2F%2Ffsharpforfunandprofit.com%2Frop%2F" target="_blank" rel="noopener noreferrer">ROP<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> es un concepto de programación funcional para manejar errores y componer operaciones secuenciales. Organiza las operaciones en una secuencia de pasos, donde cada paso puede tener éxito y continuar al siguiente paso en el camino deseado o fallar y dirigirse a un camino de manejo de errores. Las ventajas de ROP son:</p> <ul><li>Manejo de errores mejorado: ROP proporciona un enfoque estructurado para manejar errores, lo que facilita el seguimiento y la predicción de fallas.</li> <li>Componibilidad: ROP permite la composición de múltiples operaciones en una secuencia única, lo que facilita el razonamiento y el mantenimiento del código.</li> <li>Separación de responsabilidades: ROP fomenta la separación de la lógica de negocio del código de manejo de errores, lo que resulta en un código más limpio y más fácil de mantener. ROP proporciona un enfoque estructurado para manejar errores y permite la ramificación explícita basada en el éxito o el fracaso. En contraste, las excepciones pueden manejar casos excepcionales o errores inesperados.</li> <li>Testabilidad: ROP facilita las pruebas unitarias al permitir que cada paso se pruebe individualmente y facilitar el uso de simulaciones o stubs de dependencias.</li></ul> <p style="text-align:center;"><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*5hiy7XMNfKOjhvdhoVJfeA.png" style="border-radius:0.25rem;"></p> <p>Para utilizar esta técnica de programación, agregamos las siguientes líneas a nuestro archivo gradle.build.kts y sincronizamos el proyecto para usar la biblioteca <a href="https://medium.com/r/?url=https%3A%2F%2Fgithub.com%2Fmichaelbull%2Fkotlin-result" target="_blank" rel="noopener noreferrer">kotlin-result<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>:</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token comment">// Result for error handling Railway Oriented Programming</span>
<span class="token function">implementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;com.michael-bull.kotlin-result:kotlin-result:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">result_version</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Creamos la estructura de errores para las operaciones de Racket.</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token keyword">sealed</span> <span class="token keyword">class</span> <span class="token function">RacketError</span><span class="token punctuation">(</span><span class="token keyword">val</span> message<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">class</span> <span class="token function">NotFound</span><span class="token punctuation">(</span>message<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">RacketError</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
   <span class="token keyword">class</span> <span class="token function">BadRequest</span><span class="token punctuation">(</span>message<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">RacketError</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Ahora podemos usarlo en nuestro servicio y ruta. Por ejemplo, tenemos un ejemplo para encontrar una raqueta con nuestro servicio:</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token keyword">override</span> <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token operator">:</span> Long<span class="token punctuation">)</span><span class="token operator">:</span> Result<span class="token operator">&lt;</span>Racket<span class="token punctuation">,</span> RacketError<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
   logger<span class="token punctuation">.</span><span class="token function">debug</span> <span class="token punctuation">{</span> <span class="token string-literal singleline"><span class="token string">&quot;findById: search racket by id&quot;</span></span> <span class="token punctuation">}</span>
   <span class="token comment">// find in cache if not found find in repository</span>
   <span class="token keyword">return</span> cacheService<span class="token punctuation">.</span>rackets<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">{</span>
       logger<span class="token punctuation">.</span><span class="token function">debug</span> <span class="token punctuation">{</span> <span class="token string-literal singleline"><span class="token string">&quot;findById: found in cache&quot;</span></span> <span class="token punctuation">}</span>
       <span class="token function">Ok</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span>
   <span class="token punctuation">}</span> <span class="token operator">?:</span> run <span class="token punctuation">{</span>
       racketsRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">{</span> racket <span class="token operator">-&gt;</span>
           logger<span class="token punctuation">.</span><span class="token function">debug</span> <span class="token punctuation">{</span> <span class="token string-literal singleline"><span class="token string">&quot;findById: found in repository&quot;</span></span> <span class="token punctuation">}</span>
           cacheService<span class="token punctuation">.</span>rackets<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> racket<span class="token punctuation">)</span>
           <span class="token function">Ok</span><span class="token punctuation">(</span>racket<span class="token punctuation">)</span>
       <span class="token punctuation">}</span> <span class="token operator">?:</span> <span class="token function">Err</span><span class="token punctuation">(</span>RacketError<span class="token punctuation">.</span><span class="token function">NotFound</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Racket with id </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">id</span></span><span class="token string"> not found&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>Y como buscar una raqueta por un id en nuestra <strong>ruta</strong>.</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token comment">// Get one racket by id --&gt; GET /api/rackets/{id}</span>
<span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;{id}&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   logger<span class="token punctuation">.</span><span class="token function">debug</span> <span class="token punctuation">{</span> <span class="token string-literal singleline"><span class="token string">&quot;GET BY ID /</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">ENDPOINT</span></span><span class="token string">/{id}&quot;</span></span> <span class="token punctuation">}</span>
   call<span class="token punctuation">.</span>parameters<span class="token punctuation">[</span><span class="token string-literal singleline"><span class="token string">&quot;id&quot;</span></span><span class="token punctuation">]</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">toLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">{</span> id <span class="token operator">-&gt;</span>
       racketsService<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mapBoth</span><span class="token punctuation">(</span>
           success <span class="token operator">=</span> <span class="token punctuation">{</span> call<span class="token punctuation">.</span><span class="token function">respond</span><span class="token punctuation">(</span>HttpStatusCode<span class="token punctuation">.</span>OK<span class="token punctuation">,</span> it<span class="token punctuation">.</span><span class="token function">toResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
           failure <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function">handleRacketErrors</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span> <span class="token punctuation">}</span>
       <span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>Utilizamos <code>mapBoth</code> para separar el resultado exitoso del error. Podemos manejar todos los errores gracias a una función de extensión <code>handleRacketErrors</code>, donde pasamos el error y, en este punto, realizamos la respuesta correcta para cada tipo de error. Así, nuestro código es mucho más limpio en comparación con la primera versión.</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token keyword">private</span> <span class="token keyword">suspend</span> <span class="token keyword">fun</span> PipelineContext<span class="token operator">&lt;</span>Unit<span class="token punctuation">,</span> ApplicationCall<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">handleRacketErrors</span><span class="token punctuation">(</span>
   error<span class="token operator">:</span> RacketError<span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// We can handle the errors in a different way</span>
   <span class="token keyword">when</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token comment">// Racket Errors</span>
       <span class="token keyword">is</span> RacketError<span class="token punctuation">.</span>NotFound <span class="token operator">-&gt;</span> call<span class="token punctuation">.</span><span class="token function">respond</span><span class="token punctuation">(</span>HttpStatusCode<span class="token punctuation">.</span>NotFound<span class="token punctuation">,</span> error<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
       <span class="token keyword">is</span> RacketError<span class="token punctuation">.</span>BadRequest <span class="token operator">-&gt;</span> call<span class="token punctuation">.</span><span class="token function">respond</span><span class="token punctuation">(</span>HttpStatusCode<span class="token punctuation">.</span>BadRequest<span class="token punctuation">,</span> error<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="notificaciones-en-tiempo-real-con-websockets"><a href="#notificaciones-en-tiempo-real-con-websockets" class="header-anchor">#</a> Notificaciones en tiempo real con WebSockets</h3> <p><a href="https://medium.com/r/?url=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FWebSocket" target="_blank" rel="noopener noreferrer">WebSocket<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> es un protocolo de comunicación que proporciona comunicación full-duplex entre un cliente y un servidor a través de una única conexión duradera. Permite la comunicación bidireccional en tiempo real entre los dos puntos finales. Podemos utilizar WebSocket cuando:</p> <ul><li>Se requieren datos en tiempo real: WebSocket es adecuado para aplicaciones que necesitan actualizaciones instantáneas o intercambio frecuente de datos entre el cliente y el servidor.</li> <li>Aplicaciones interactivas: Es ideal para aplicaciones que involucran colaboración en tiempo real, sistemas de chat, juegos o cualquier escenario en el que la comunicación instantánea sea vital.</li> <li>Latencia reducida: WebSocket elimina la necesidad de realizar consultas continuas o solicitudes frecuentes, lo que reduce la sobrecarga de red y mejora la capacidad de respuesta.</li> <li>Utilización eficiente de recursos: Permite conexiones simultáneas y persistentes, reduciendo la sobrecarga de establecer nuevas conexiones para cada interacción y permitiendo una utilización eficiente de los recursos en el servidor.</li></ul> <p>Por lo tanto, implementamos nuestro sistema de notificaciones cuando agregamos, actualizamos o eliminamos una raqueta. Podemos utilizar el <a href="https://medium.com/r/?url=https%3A%2F%2Frefactoring.guru%2Fdesign-patterns%2Fobserver" target="_blank" rel="noopener noreferrer">patrón Observer<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (observador) (consultar los commits del repositorio), pero en este caso, utilizamos un estado reactivo utilizando <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/-state-flow/" target="_blank" rel="noopener noreferrer">StateFlow<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> o <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/-shared-flow/" target="_blank" rel="noopener noreferrer">SharedFlow<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> de Kotlin Coroutines. En la tercera parte del tutorial será un SharedFlow. El patrón Observer es útil para notificaciones en tiempo real a una lista de suscriptores, mientras que StateFlow en Kotlin proporciona un flujo de datos reactivo con notificaciones automáticas de cambios relevantes. El patrón Observer se adapta mejor a listas más pequeñas de suscriptores y cambios poco frecuentes, mientras que StateFlow es ideal para aprovechar las capacidades reactivas de Kotlin y manejar flujos de datos a mayor escala. La elección depende de la complejidad del sistema, el tamaño de la lista de suscriptores, la frecuencia de los cambios y la capacidad de respuesta requerida. Considera tus necesidades específicas al seleccionar el enfoque adecuado.
Entonces, creamos un <strong>DTO de notificación</strong> y en nuestro <strong>servicio de raquetas</strong> creamos el estado reactivo y una función para modificarlo.</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token comment">// Real Time Notifications and WebSockets</span>
<span class="token comment">// We can notify use a reactive system with StateFlow</span>
<span class="token keyword">private</span> <span class="token keyword">val</span> _notificationState<span class="token operator">:</span> MutableStateFlow<span class="token operator">&lt;</span>RacketNotification<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token function">MutableStateFlow</span><span class="token punctuation">(</span>
   <span class="token function">RacketNotification</span><span class="token punctuation">(</span>
       entity <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;&quot;</span></span><span class="token punctuation">,</span>
       type <span class="token operator">=</span> NotificationType<span class="token punctuation">.</span>OTHER<span class="token punctuation">,</span>
       id <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
       <span class="token keyword">data</span> <span class="token operator">=</span> <span class="token keyword">null</span>
   <span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token keyword">override</span> <span class="token keyword">val</span> notificationState<span class="token operator">:</span> StateFlow<span class="token operator">&lt;</span>RacketNotification<span class="token operator">&gt;</span> <span class="token operator">=</span> _notificationState

<span class="token keyword">private</span> <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">onChange</span><span class="token punctuation">(</span>type<span class="token operator">:</span> NotificationType<span class="token punctuation">,</span> id<span class="token operator">:</span> Long<span class="token punctuation">,</span> <span class="token keyword">data</span><span class="token operator">:</span> Racket<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   logger<span class="token punctuation">.</span><span class="token function">debug</span> <span class="token punctuation">{</span> <span class="token string-literal singleline"><span class="token string">&quot;onChange: Notification on Rackets: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">type</span></span><span class="token string">, notification updates to subscribers: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression"><span class="token keyword">data</span></span></span><span class="token string">&quot;</span></span> <span class="token punctuation">}</span>
   <span class="token comment">// update notification state</span>
   _notificationState<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token function">RacketNotification</span><span class="token punctuation">(</span>
       entity <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;RACKET&quot;</span></span><span class="token punctuation">,</span>
       type <span class="token operator">=</span> type<span class="token punctuation">,</span>
       id <span class="token operator">=</span> id<span class="token punctuation">,</span>
       <span class="token keyword">data</span> <span class="token operator">=</span> <span class="token keyword">data</span><span class="token punctuation">.</span><span class="token function">toResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>Por ejemplo, si eliminamos una nueva raqueta en nuestro servicio, podemos actualizar el estado:</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token keyword">override</span> <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">delete</span><span class="token punctuation">(</span>id<span class="token operator">:</span> Long<span class="token punctuation">)</span><span class="token operator">:</span> Result<span class="token operator">&lt;</span>Racket<span class="token punctuation">,</span> RacketError<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
   logger<span class="token punctuation">.</span><span class="token function">debug</span> <span class="token punctuation">{</span> <span class="token string-literal singleline"><span class="token string">&quot;delete: delete racket&quot;</span></span> <span class="token punctuation">}</span>
   <span class="token comment">// find, if exists delete in cache and repository and notify</span>
   <span class="token keyword">return</span> <span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">andThen</span> <span class="token punctuation">{</span>
       <span class="token function">Ok</span><span class="token punctuation">(</span>racketsRepository<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">also</span> <span class="token punctuation">{</span> res <span class="token operator">-&gt;</span>
           cacheService<span class="token punctuation">.</span>rackets<span class="token punctuation">.</span><span class="token function">invalidate</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
           <span class="token function">onChange</span><span class="token punctuation">(</span>NotificationType<span class="token punctuation">.</span>DELETE<span class="token punctuation">,</span> id<span class="token punctuation">,</span> res<span class="token punctuation">)</span>
       <span class="token punctuation">}</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>Pero necesitamos interactuar como un servicio web en nuestra ruta. Incluimos la dependencia en nuestro archivo <strong>build.gradle.kts</strong> y sincronizamos el proyecto.</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token comment">// WebSockets</span>
<span class="token function">implementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;io.ktor:ktor-server-websockets:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">ktor_version</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Hemos configurado el complemento WebSocket (en el paquete Plugins), y necesitamos agregar la configuración al módulo de la aplicación, al igual que los otros complementos. Creamos una ruta para nuestro WebSocket en nuestra ruta principal y reaccionamos al cambio del estado de notificación consumiendo el StateFlow o SharedFlow.</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token comment">// WebSockets Real Time Updates and Notifications</span>
<span class="token function">webSocket</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">ENDPOINT</span></span><span class="token string">/notifications&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token function">sendSerialized</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Notifications WS: Rackets - Rackets API&quot;</span></span><span class="token punctuation">)</span>
   <span class="token keyword">val</span> initTime <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token comment">// Remember it will autoclose the connection, see config</span>
   <span class="token comment">// Now we can listen and react to the changes in the StateFlow</span>
   racketsService<span class="token punctuation">.</span>notificationState
       <span class="token comment">// Sometimes we need to do something when we start</span>
       <span class="token punctuation">.</span><span class="token function">onStart</span> <span class="token punctuation">{</span>
           logger<span class="token punctuation">.</span><span class="token function">debug</span> <span class="token punctuation">{</span> <span class="token string-literal singleline"><span class="token string">&quot;notificationState: onStart to </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression"><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;</span></span> <span class="token punctuation">}</span>
           <span class="token comment">// Sometimes we need to filter any values</span>
       <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">filter</span> <span class="token punctuation">{</span>
           <span class="token comment">// we filter the values: we only send the ones that are not empty and are after the init time</span>
           it<span class="token punctuation">.</span>entity<span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> it<span class="token punctuation">.</span>createdAt<span class="token punctuation">.</span><span class="token function">isAfter</span><span class="token punctuation">(</span>initTime<span class="token punctuation">)</span>
           <span class="token comment">// we collect the values and send them to the client</span>
       <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">collect</span> <span class="token punctuation">{</span>
           logger<span class="token punctuation">.</span><span class="token function">debug</span> <span class="token punctuation">{</span> <span class="token string-literal singleline"><span class="token string">&quot;notificationState: collect </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">it</span></span><span class="token string"> and sent to </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression"><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;</span></span> <span class="token punctuation">}</span>
           <span class="token function">sendSerialized</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span> <span class="token comment">// WS function to send the message to the client</span>
       <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>Ahora podemos probarlo en Postman, gracias a la <a href="https://learning.postman.com/docs/sending-requests/websocket/websocket/" target="_blank" rel="noopener noreferrer">funcionalidad de WebSocket<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>:</p> <p style="text-align:center;"><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*ERmB1f8F4ReCHYRudcM74g.png" style="border-radius:0.25rem;"></p> <h3 id="almacenamiento-de-archivos"><a href="#almacenamiento-de-archivos" class="header-anchor">#</a> Almacenamiento de archivos</h3> <p>La siguiente etapa consiste en crear un servicio de almacenamiento para cargar archivos, como por ejemplo, la imagen de cada raqueta. En el archivo application.conf utilizaremos una clave especial para indicar el directorio de carga donde se guardarán los archivos.
Para ello, programaremos en este servicio dos métodos: uno para guardar una imagen y otro para recuperarla. También crearemos una estructura de errores y utilizaremos Result (ROP) para manejar los resultados.</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token keyword">override</span> <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">saveFile</span><span class="token punctuation">(</span>
   fileName<span class="token operator">:</span> String<span class="token punctuation">,</span>
   fileUrl<span class="token operator">:</span> String<span class="token punctuation">,</span>
   fileBytes<span class="token operator">:</span> ByteArray
<span class="token punctuation">)</span><span class="token operator">:</span> Result<span class="token operator">&lt;</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> String<span class="token operator">&gt;</span><span class="token punctuation">,</span> StorageError<span class="token operator">&gt;</span> <span class="token operator">=</span>
   <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       logger<span class="token punctuation">.</span><span class="token function">debug</span> <span class="token punctuation">{</span> <span class="token string-literal singleline"><span class="token string">&quot;Saving file in: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">fileName</span></span><span class="token string">&quot;</span></span> <span class="token punctuation">}</span>
       <span class="token keyword">return</span><span class="token label symbol">@withContext</span> <span class="token keyword">try</span> <span class="token punctuation">{</span>
           <span class="token function">File</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">uploadDir</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">fileName</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span>fileBytes<span class="token punctuation">)</span>
           <span class="token function">Ok</span><span class="token punctuation">(</span>
               <span class="token function">mapOf</span><span class="token punctuation">(</span>
                   <span class="token string-literal singleline"><span class="token string">&quot;fileName&quot;</span></span> <span class="token keyword">to</span> fileName<span class="token punctuation">,</span>
                   <span class="token string-literal singleline"><span class="token string">&quot;createdAt&quot;</span></span> <span class="token keyword">to</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                   <span class="token string-literal singleline"><span class="token string">&quot;size&quot;</span></span> <span class="token keyword">to</span> fileBytes<span class="token punctuation">.</span>size<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                   <span class="token string-literal singleline"><span class="token string">&quot;url&quot;</span></span> <span class="token keyword">to</span> fileUrl<span class="token punctuation">,</span>
               <span class="token punctuation">)</span>
           <span class="token punctuation">)</span>
       <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> Exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token function">Err</span><span class="token punctuation">(</span>StorageError<span class="token punctuation">.</span><span class="token function">BadRequest</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Error saving file: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">fileName</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

<span class="token keyword">override</span> <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">getFile</span><span class="token punctuation">(</span>fileName<span class="token operator">:</span> String<span class="token punctuation">)</span><span class="token operator">:</span> Result<span class="token operator">&lt;</span>File<span class="token punctuation">,</span> StorageError<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   logger<span class="token punctuation">.</span><span class="token function">debug</span> <span class="token punctuation">{</span> <span class="token string-literal singleline"><span class="token string">&quot;Get file: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">fileName</span></span><span class="token string">&quot;</span></span> <span class="token punctuation">}</span>
   <span class="token keyword">return</span><span class="token label symbol">@withContext</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">File</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">uploadDir</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">fileName</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token function">Err</span><span class="token punctuation">(</span>StorageError<span class="token punctuation">.</span><span class="token function">NotFound</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;File Not Found in storage: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">fileName</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
       <span class="token function">Ok</span><span class="token punctuation">(</span><span class="token function">File</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">uploadDir</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">fileName</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>Entonces, en nuestra ruta podemos usar una petición de parche para actualizar la imagen de la raqueta usando <a href="https://ktor.io/docs/requests.html#form_data" target="_blank" rel="noopener noreferrer">una solicitud de varias partes<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>:</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token comment">// Update a racket image --&gt; PATCH /api/rackets/{id}</span>
<span class="token function">patch</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;{id}&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   logger<span class="token punctuation">.</span><span class="token function">debug</span> <span class="token punctuation">{</span> <span class="token string-literal singleline"><span class="token string">&quot;PATCH /</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">ENDPOINT</span></span><span class="token string">/{id}&quot;</span></span> <span class="token punctuation">}</span>

   call<span class="token punctuation">.</span>parameters<span class="token punctuation">[</span><span class="token string-literal singleline"><span class="token string">&quot;id&quot;</span></span><span class="token punctuation">]</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">toLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">{</span> id <span class="token operator">-&gt;</span>
       <span class="token keyword">val</span> baseUrl <span class="token operator">=</span>
           call<span class="token punctuation">.</span>request<span class="token punctuation">.</span>origin<span class="token punctuation">.</span>scheme <span class="token operator">+</span> <span class="token string-literal singleline"><span class="token string">&quot;://&quot;</span></span> <span class="token operator">+</span> call<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">host</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string-literal singleline"><span class="token string">&quot;:&quot;</span></span> <span class="token operator">+</span> call<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">port</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string-literal singleline"><span class="token string">&quot;/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">ENDPOINT</span></span><span class="token string">/image/&quot;</span></span>
       <span class="token keyword">val</span> multipartData <span class="token operator">=</span> call<span class="token punctuation">.</span><span class="token function">receiveMultipart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       multipartData<span class="token punctuation">.</span><span class="token function">forEachPart</span> <span class="token punctuation">{</span> part <span class="token operator">-&gt;</span>
           <span class="token keyword">if</span> <span class="token punctuation">(</span>part <span class="token keyword">is</span> PartData<span class="token punctuation">.</span>FileItem<span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token keyword">val</span> fileName <span class="token operator">=</span> part<span class="token punctuation">.</span>originalFileName <span class="token keyword">as</span> String
               <span class="token keyword">val</span> fileBytes <span class="token operator">=</span> part<span class="token punctuation">.</span><span class="token function">streamProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
               <span class="token keyword">val</span> fileExtension <span class="token operator">=</span> fileName<span class="token punctuation">.</span><span class="token function">substringAfterLast</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;.&quot;</span></span><span class="token punctuation">)</span>
               <span class="token keyword">val</span> newFileName <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">fileExtension</span></span><span class="token string">&quot;</span></span>
               <span class="token keyword">val</span> newFileUrl <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">baseUrl</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">newFileName</span></span><span class="token string">&quot;</span></span>
               <span class="token comment">// Save the file</span>
               storageService<span class="token punctuation">.</span><span class="token function">saveFile</span><span class="token punctuation">(</span>newFileName<span class="token punctuation">,</span> newFileUrl<span class="token punctuation">,</span> fileBytes<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">andThen</span> <span class="token punctuation">{</span>
                   <span class="token comment">// Update the racket Image</span>
                   racketsService<span class="token punctuation">.</span><span class="token function">updateImage</span><span class="token punctuation">(</span>
                       id <span class="token operator">=</span> id<span class="token punctuation">,</span>
                       image <span class="token operator">=</span> newFileUrl
                   <span class="token punctuation">)</span>
               <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">mapBoth</span><span class="token punctuation">(</span>
                   success <span class="token operator">=</span> <span class="token punctuation">{</span> call<span class="token punctuation">.</span><span class="token function">respond</span><span class="token punctuation">(</span>HttpStatusCode<span class="token punctuation">.</span>OK<span class="token punctuation">,</span> it<span class="token punctuation">.</span><span class="token function">toResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                   failure <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function">handleRacketErrors</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span> <span class="token punctuation">}</span>
               <span class="token punctuation">)</span>
           <span class="token punctuation">}</span>
           part<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>Ahora podemos probar con Postman para enviar un archivo y actualizar una raqueta u obtener este archivo.</p> <p style="text-align:center;"><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*v6xtIm1wPmsKIkBxd8Cn6g.png" style="border-radius:0.25rem;"></p> <p style="text-align:center;"><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*bbFhSmT59EHQ30bpqg9wwQ.png" style="border-radius:0.25rem;"></p> <h3 id="nuestra-ruta-final"><a href="#nuestra-ruta-final" class="header-anchor">#</a> Nuestra Ruta Final</h3> <p>Finalmente, tenemos nuestra ruta que llama a los servicios que utilizaremos. Destacamos el enfoque de ROP y cómo manejamos todos los errores mediante la creación de un código limpio y legible que concatena opciones basadas en el flujo principal o utiliza websockets con un estado reactivo para implementar un sistema de notificación en tiempo real.</p> <h2 id="testing"><a href="#testing" class="header-anchor">#</a> Testing</h2> <h3 id="testeando-el-repositorio-de-raquetas"><a href="#testeando-el-repositorio-de-raquetas" class="header-anchor">#</a> Testeando el repositorio de raquetas</h3> <p>Ahora entramos en una parte crucial y esencial: probar nuestro código. Para hacer esto, haremos uso de <a href="https://junit.org/junit5/" target="_blank" rel="noopener noreferrer">JUnit<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. JUnit es un ampliamente utilizado marco de pruebas de código abierto para aplicaciones Java. Proporciona una forma simple y conveniente de escribir y ejecutar pruebas unitarias para unidades individuales de código, como métodos o clases. JUnit ofrece varias anotaciones, aserciones y ejecutores de pruebas para facilitar la creación y ejecución de pruebas. Ampliaremos la configuración para usar una biblioteca especial para probar funciones suspendidas. Agregamos las siguientes dependencias en nuestro archivo <strong>build.gradle.kts</strong> y sincronizamos el proyecto.</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token comment">// Testing</span>
<span class="token function">testImplementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;io.ktor:ktor-server-tests-jvm:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">ktor_version</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
<span class="token comment">// testImplementation(&quot;org.jetbrains.kotlin:kotlin-test-junit:$kotlin_version&quot;)</span>
<span class="token comment">// JUnit 5 instead of JUnit 4</span>
<span class="token function">testImplementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;org.junit.jupiter:junit-jupiter-api:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">junit_version</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
<span class="token function">testImplementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;org.junit.jupiter:junit-jupiter-engine:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">junit_version</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
<span class="token comment">// To test coroutines and suspend functions</span>
<span class="token function">testImplementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;org.jetbrains.kotlinx:kotlinx-coroutines-test:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">coroutines_test_version</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>En esta etapa inicial, las pruebas no son las mejores para un repositorio, pero son ilustrativas para lo que queremos. Podemos ver el uso de aserciones para verificar las operaciones CRUD indicadas. En la carpeta de pruebas, puedes encontrar los archivos de prueba.</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token keyword">class</span> RacketsRepositoryImplTest <span class="token punctuation">{</span>
   <span class="token keyword">val</span> dataBaseService <span class="token operator">=</span> <span class="token function">DataBaseService</span><span class="token punctuation">(</span><span class="token function">ApplicationConfig</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;application.conf&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token keyword">val</span> repository <span class="token operator">=</span> <span class="token function">RacketsRepositoryImpl</span><span class="token punctuation">(</span>dataBaseService<span class="token punctuation">)</span>

   <span class="token annotation builtin">@BeforeEach</span>
   <span class="token keyword">fun</span> <span class="token function">setUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> runTest <span class="token punctuation">{</span>
       <span class="token comment">// Clean and restore database with data</span>
       dataBaseService<span class="token punctuation">.</span><span class="token function">initDataBaseDataDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>

   <span class="token annotation builtin">@Test</span>
   <span class="token keyword">fun</span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> runTest <span class="token punctuation">{</span>
       <span class="token keyword">val</span> rackets <span class="token operator">=</span> repository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token function">assertAll</span><span class="token punctuation">(</span>
           <span class="token punctuation">{</span> <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> rackets<span class="token punctuation">.</span>size<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
           <span class="token punctuation">{</span> <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Babolat&quot;</span></span><span class="token punctuation">,</span> rackets<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>brand<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
           <span class="token punctuation">{</span> <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Babolat&quot;</span></span><span class="token punctuation">,</span> rackets<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>brand<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
           <span class="token punctuation">{</span> <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Head&quot;</span></span><span class="token punctuation">,</span> rackets<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>brand<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
           <span class="token punctuation">{</span> <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Wilson&quot;</span></span><span class="token punctuation">,</span> rackets<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>brand<span class="token punctuation">)</span> <span class="token punctuation">}</span>
       <span class="token punctuation">)</span>
   <span class="token punctuation">}</span>

   <span class="token annotation builtin">@Test</span>
   <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> runTest <span class="token punctuation">{</span>
       <span class="token keyword">val</span> racket <span class="token operator">=</span> repository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">!!</span>
       <span class="token function">assertAll</span><span class="token punctuation">(</span>
           <span class="token punctuation">{</span> <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> racket<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
           <span class="token punctuation">{</span> <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Babolat&quot;</span></span><span class="token punctuation">,</span> racket<span class="token punctuation">.</span>brand<span class="token punctuation">)</span> <span class="token punctuation">}</span>
       <span class="token punctuation">)</span>
   <span class="token punctuation">}</span>

   <span class="token annotation builtin">@Test</span>
   <span class="token keyword">fun</span> <span class="token function">findByIdNotFound</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> runTest <span class="token punctuation">{</span>
       <span class="token keyword">val</span> racket <span class="token operator">=</span> repository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">100</span><span class="token punctuation">)</span>
       <span class="token function">assertNull</span><span class="token punctuation">(</span>racket<span class="token punctuation">)</span>
   <span class="token punctuation">}</span>

   <span class="token comment">// . . .</span>

   <span class="token annotation builtin">@Test</span>
   <span class="token keyword">fun</span> <span class="token function">saveNewRacket</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> runTest <span class="token punctuation">{</span>
       <span class="token keyword">val</span> racket <span class="token operator">=</span> <span class="token function">Racket</span><span class="token punctuation">(</span>brand <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;Test Brand&quot;</span></span><span class="token punctuation">,</span> model <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;Test Model&quot;</span></span><span class="token punctuation">,</span> price <span class="token operator">=</span> <span class="token number">100.0</span><span class="token punctuation">)</span>
       <span class="token keyword">val</span> newRacket <span class="token operator">=</span> repository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>racket<span class="token punctuation">)</span>
       <span class="token function">assertAll</span><span class="token punctuation">(</span>
           <span class="token punctuation">{</span> <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Test Brand&quot;</span></span><span class="token punctuation">,</span> newRacket<span class="token punctuation">.</span>brand<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
           <span class="token punctuation">{</span> <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Test Model&quot;</span></span><span class="token punctuation">,</span> newRacket<span class="token punctuation">.</span>model<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
           <span class="token punctuation">{</span> <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token number">100.0</span><span class="token punctuation">,</span> newRacket<span class="token punctuation">.</span>price<span class="token punctuation">)</span> <span class="token punctuation">}</span>
       <span class="token punctuation">)</span>
   <span class="token punctuation">}</span>

   <span class="token comment">// . . .</span>
   
   <span class="token annotation builtin">@Test</span>
   <span class="token keyword">fun</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> runTest <span class="token punctuation">{</span>
       <span class="token comment">// Save a new racket</span>
       <span class="token keyword">val</span> racket <span class="token operator">=</span> <span class="token function">Racket</span><span class="token punctuation">(</span>brand <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;Test Brand&quot;</span></span><span class="token punctuation">,</span> model <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;Test Model&quot;</span></span><span class="token punctuation">,</span> price <span class="token operator">=</span> <span class="token number">100.0</span><span class="token punctuation">)</span>
       <span class="token keyword">val</span> newRacket <span class="token operator">=</span> repository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>racket<span class="token punctuation">)</span>
       <span class="token keyword">val</span> deleted <span class="token operator">=</span> repository<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>newRacket<span class="token punctuation">)</span>
       <span class="token keyword">val</span> exists <span class="token operator">=</span> repository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>newRaquet<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
       <span class="token function">assertAll</span><span class="token punctuation">(</span>
           <span class="token punctuation">{</span> <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Test Brand&quot;</span></span><span class="token punctuation">,</span> deleted<span class="token punctuation">.</span>brand<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
           <span class="token punctuation">{</span> <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Test Model&quot;</span></span><span class="token punctuation">,</span> deleted<span class="token punctuation">.</span>model<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
           <span class="token punctuation">{</span> <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token number">100.0</span><span class="token punctuation">,</span> deleted<span class="token punctuation">.</span>price<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
           <span class="token punctuation">{</span> <span class="token function">assertNull</span><span class="token punctuation">(</span>exists<span class="token punctuation">)</span> <span class="token punctuation">}</span>
       <span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br></div></div><p>Ejecutando nuestras pruebas obtenemos:</p> <p style="text-align:center;"><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*0o9PKNEVzIXTB8eUHc_wPw.png" style="border-radius:0.25rem;"></p> <h3 id="testeando-el-servicio-de-raquetas"><a href="#testeando-el-servicio-de-raquetas" class="header-anchor">#</a> Testeando el servicio de raquetas</h3> <p>Para probar nuestro servicio, utilizaremos pruebas con &quot;mocks&quot;. Las pruebas con &quot;mocks&quot; implican la creación de objetos simulados que imitan el comportamiento de las dependencias reales. Estos objetos simulados están programados para responder a las llamadas a métodos y permiten establecer expectativas sobre sus interacciones. Utilizando &quot;mocks&quot;, los desarrolladores pueden aislar el código que se está probando, controlar el comportamiento de las dependencias, simular diversos escenarios y verificar las interacciones con el código probado.</p> <p>Utilizaremos la biblioteca <a href="https://mockk.io/" target="_blank" rel="noopener noreferrer">MockK<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, por lo que debemos agregar la siguiente dependencia a nuestro proyecto en el archivo build.gradle.kts y sincronizar nuestro proyecto:</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token comment">// MockK para pruebas con &quot;mocks&quot;</span>
<span class="token function">testImplementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;io.mockk:mockk:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">mockk_version</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Crearemos una clase para probar los métodos del servicio. Extendemos la clase con @ExtendWith(MockKExtension::class) para realizar las pruebas con JUnit y creamos los &quot;mocks&quot; con las anotaciones <code>@MockK</code> e <code>@InjectMockK</code> para inyectar el &quot;mock&quot; como dependencia de la clase que se está probando.</p> <p>A continuación, creamos cada prueba donde simulamos el comportamiento del &quot;mock&quot; para responder a las llamadas a métodos y permitir expectativas para probar los métodos del servicio con JUnit. Podemos verificar el número de llamadas a una dependencia.</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token annotation builtin">@ExtendWith</span><span class="token punctuation">(</span>MockKExtension<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> RacketsServiceImplTest <span class="token punctuation">{</span>

   <span class="token annotation builtin">@MockK</span>
   <span class="token keyword">lateinit</span> <span class="token keyword">var</span> repository<span class="token operator">:</span> RacketsRepositoryImpl
   <span class="token annotation builtin">@MockK</span>
   <span class="token keyword">lateinit</span> <span class="token keyword">var</span> cache<span class="token operator">:</span> CacheService
   <span class="token annotation builtin">@InjectMockKs</span>
   <span class="token keyword">lateinit</span> <span class="token keyword">var</span> service<span class="token operator">:</span> RacketsServiceImpl

   <span class="token keyword">val</span> rackets <span class="token operator">=</span> <span class="token function">racketsDemoData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values

   <span class="token annotation builtin">@Test</span>
   <span class="token keyword">fun</span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> runTest <span class="token punctuation">{</span>
       <span class="token comment">// Given</span>
       coEvery <span class="token punctuation">{</span> repository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> returns <span class="token function">flowOf</span><span class="token punctuation">(</span>rackets<span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
       <span class="token comment">// When</span>
       <span class="token keyword">val</span> result <span class="token operator">=</span> service<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token comment">// Then</span>
       <span class="token function">assertAll</span><span class="token punctuation">(</span>
           <span class="token punctuation">{</span> <span class="token function">assertNotNull</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
           <span class="token punctuation">{</span> <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>size<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
           <span class="token punctuation">{</span> <span class="token function">assertEquals</span><span class="token punctuation">(</span>rackets<span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
       <span class="token punctuation">)</span>
       <span class="token comment">// Verifications</span>
       <span class="token function">coVerify</span><span class="token punctuation">(</span>exactly <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> repository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

  <span class="token comment">// ...</span>

   <span class="token annotation builtin">@Test</span>
   <span class="token keyword">fun</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> runTest <span class="token punctuation">{</span>
       <span class="token comment">// Given</span>
       coEvery <span class="token punctuation">{</span> repository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> returns rackets<span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       coEvery <span class="token punctuation">{</span> cache<span class="token punctuation">.</span>rackets<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rackets<span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> just runs <span class="token comment">// returns Unit</span>
       <span class="token comment">// When</span>
       <span class="token keyword">val</span> result <span class="token operator">=</span> service<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>rackets<span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
       <span class="token comment">// Then</span>
       <span class="token function">assertAll</span><span class="token punctuation">(</span>
           <span class="token punctuation">{</span> <span class="token function">assertNotNull</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
           <span class="token punctuation">{</span> <span class="token function">assertEquals</span><span class="token punctuation">(</span>rackets<span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
       <span class="token punctuation">)</span>
       <span class="token comment">// Verifications</span>
       coVerify <span class="token punctuation">{</span> repository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
       coVerify <span class="token punctuation">{</span> cache<span class="token punctuation">.</span>rackets<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rackets<span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

  <span class="token comment">// ...</span>

   <span class="token annotation builtin">@Test</span>
   <span class="token keyword">fun</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> runTest <span class="token punctuation">{</span>
       <span class="token comment">// Given</span>
       coEvery <span class="token punctuation">{</span> cache<span class="token punctuation">.</span>rackets<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> returns <span class="token keyword">null</span>
       coEvery <span class="token punctuation">{</span> repository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> returns rackets<span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       coEvery <span class="token punctuation">{</span> cache<span class="token punctuation">.</span>rackets<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rackets<span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> just runs
       coEvery <span class="token punctuation">{</span> repository<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> returns rackets<span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       coEvery <span class="token punctuation">{</span> cache<span class="token punctuation">.</span>rackets<span class="token punctuation">.</span><span class="token function">invalidate</span><span class="token punctuation">(</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> returns Unit
       <span class="token comment">// When</span>
       <span class="token keyword">val</span> result <span class="token operator">=</span> service<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
       <span class="token comment">// Then</span>
       <span class="token function">assertAll</span><span class="token punctuation">(</span>
           <span class="token punctuation">{</span> <span class="token function">assertNotNull</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
           <span class="token punctuation">{</span> <span class="token function">assertEquals</span><span class="token punctuation">(</span>rackets<span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
       <span class="token punctuation">)</span>
       <span class="token comment">// Verifications</span>
       coVerify <span class="token punctuation">{</span> cache<span class="token punctuation">.</span>rackets<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
       coVerify <span class="token punctuation">{</span> repository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
       coVerify <span class="token punctuation">{</span> cache<span class="token punctuation">.</span>rackets<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rackets<span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
       coVerify <span class="token punctuation">{</span> repository<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
       coVerify <span class="token punctuation">{</span> cache<span class="token punctuation">.</span>rackets<span class="token punctuation">.</span><span class="token function">invalidate</span><span class="token punctuation">(</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
  
   <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br></div></div><p>De nuevo ejecutando nuestros tests:</p> <p style="text-align:center;"><img loading="lazy" src="https://cdn-images-1.medium.com/max/800/1*Kf9JSpbxgEF5a8YbopBWXg.png" style="border-radius:0.25rem;"></p> <h2 id="¿que-sigue"><a href="#¿que-sigue" class="header-anchor">#</a> ¿Qué sigue?</h2> <p>Puedes probar con Postman y, por qué no, probar nuestro proceso de validación. Puedes seguir los mensajes o el registro para entender la secuencia o los métodos.</p> <p>Hemos continuado nuestros tutoriales para poder programar nuestra API REST reactiva, comprendiendo gradualmente cada uno de sus componentes. Pero aún nos queda mucho por hacer en el tutorial final. Por favor, no dejes de seguir el resto de las publicaciones de Hyperskill en Medium, donde veremos más detalles de lo que puedes aprender en nuestras pistas. Codificaremos este ejemplo:</p> <ul><li>Usar Koin para inyectar nuestras dependencias.</li> <li>Conexiones seguras con SSL.</li> <li>Autenticación y autorización con JWT.</li> <li>Prueba de nuestros puntos finales (endpoints).</li> <li>Documentación de nuestro servicio con Swagger y OpenAPI.</li> <li>Despliegue con Docker.</li></ul> <p>Tienes el código de este proyecto en https://github.com/joseluisgs/ktor-reactive-rest-hyperskill. El código de esta parte está en este enlace: https://github.com/joseluisgs/ktor-reactive-rest-hyperskill/releases. Por favor, no olvides dar una estrella o seguirme para estar al tanto de nuevos tutoriales y noticias.</p> <p><strong>Puedes seguirlo commit por commit y usar el archivo de respaldo de Postman para probarlo</strong>.</p> <p>Recuerda que este no es un código para usar en un entorno real o de producción. Es un proyecto didáctico para que puedas experimentar, analizar, mejorar o adaptar a tu forma de programar. Se trata de presentar conceptos y ver cómo funcionan. Cualquier sugerencia o propuesta que tengas, puedes hacer un &quot;issue&quot; o una solicitud de extracción (pull request).</p> <p>Sin embargo, todavía tenemos muchas secciones por cubrir y contenido para que profundices y refuerces en <a href="https://hyperskill.org" target="_blank" rel="noopener noreferrer">Hyperskill<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> a través de diferentes temas y tareas que te ayudarán a mejorar como desarrollador en tecnologías Kotlin. Las siguientes pistas ofrecidas por JetBrains Academy en Hyperskill pueden ser un punto de partida perfecto. Toda la información y explicación de conceptos y técnicas se muestran en estos artículos. ¡No te los pierdas!</p> <ul><li><a href="https://hyperskill.org/tracks/3?category=4&amp;utm_source=medium_hs&amp;utm_medium=social&amp;utm_campaign=ktor&amp;utm_term=16.05.2023" target="_blank" rel="noopener noreferrer">Desarrollador Kotlin<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://hyperskill.org/tracks/45?category=20&amp;utm_source=medium_hs&amp;utm_medium=social&amp;utm_campaign=ktor&amp;utm_term=16.05.2023" target="_blank" rel="noopener noreferrer">Desarrollador Backend Kotlin (Ktor)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>Estas pistas te brindarán experiencia práctica utilizando herramientas de vanguardia y te enseñarán cómo construir aplicaciones del lado del servidor, asegurar el almacenamiento persistente de datos en bases de datos y probar de manera efectiva la funcionalidad de tus aplicaciones utilizando herramientas modernas.</p> <p>Te animamos a dejar cualquier pregunta o comentario en la sección de comentarios debajo de esta publicación del blog. Además, puedes seguirnos en plataformas de redes sociales como en <a href="https://www.reddit.com/r/Hyperskill/" target="_blank" rel="noopener noreferrer">Reddit<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, <a href="https://twitter.com/yourhyperskill" target="_blank" rel="noopener noreferrer">Twitter<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, <a href="https://www.linkedin.com/company/hyperskill" target="_blank" rel="noopener noreferrer">LinkedIn<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> y <a href="https://www.facebook.com/myhyperskill" target="_blank" rel="noopener noreferrer">Facebook<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> para estar informado sobre nuestros últimos artículos y proyectos.</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span data-icon="clarity:note-edit-line" class="prefix iconify"></span> <span class="prefix">Actualizado: </span> <span class="time">27/10/2023, 12:20:24. </span> <span class="time"><a href="https://forms.gle/V2m42qiW1s6X4oNt8" target="_blank"><span data-icon="fluent:comment-error-16-regular" class="iconify"></span> ¿Algún
            error?</a></span></div> <div class="giscus"><giscus-widget id="comentarios" repo="joseluisgs/joseluisgs.github.io" repoid="MDEwOlJlcG9zaXRvcnkzMjg3NzQ4OTU=" category="General" categoryid="DIC_kwDOE5i0784CTUPm" mapping="og:title" reactionsenabled="1" emitmetadata="0" inputposition="bottom" theme="light" lang="es" crossorigin="anonymous" loading="lazy"></giscus-widget></div></footer> <!----> <div class="footer-wrapper footer" data-v-2518b7c2><span data-v-2518b7c2><span data-icon="fluent:code-circle-20-filled" class="iconify-inline iconfont" data-v-2518b7c2></span> <a href="/docs/info/personal/" data-v-2518b7c2><span data-v-2518b7c2>José Luis González
        </span> 
      <span data-v-2518b7c2>
        2025
      </span></a></span> <span data-v-2518b7c2><a target="blank" href="https://github.com/joseluisgs" data-v-2518b7c2><span data-icon="mdi:github" class="iconify-inline iconfont" data-v-2518b7c2></span></a> <a target="blank" href="https://twitter.com/JoseLuisGS_" data-v-2518b7c2><span data-icon="mdi:twitter" class="iconify-inline iconfont" data-v-2518b7c2></span></a> <a target="blank" href="https://linkedin.com/in/joseluisgonsan" data-v-2518b7c2><span data-icon="mdi:linkedin" class="iconify-inline iconfont" data-v-2518b7c2></span></a> <a target="blank" href="https://g.dev/joseluisgs" data-v-2518b7c2><span data-icon="raphael:code" class="iconify-inline iconfont" data-v-2518b7c2></span></a> <a target="blank" href="https://www.youtube.com/@joseluisgs" data-v-2518b7c2><span data-icon="mdi:youtube" class="iconify-inline iconfont" data-v-2518b7c2></span></a></span> <span data-v-2518b7c2><!---->
       
    <!----></span></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-cb1513f6><li class="level-2" data-v-cb1513f6><a href="/blogs/2023/2023-06-19-reactive-api-rest-pt-ii.html#introduccion" class="sidebar-link reco-side-introduccion" data-v-cb1513f6>Introducción</a></li><li class="level-2" data-v-cb1513f6><a href="/blogs/2023/2023-06-19-reactive-api-rest-pt-ii.html#dtos-y-mappers" class="sidebar-link reco-side-dtos-y-mappers" data-v-cb1513f6>DTOs y Mappers</a></li><li class="level-2" data-v-cb1513f6><a href="/blogs/2023/2023-06-19-reactive-api-rest-pt-ii.html#validaciones-y-paginas-de-estado" class="sidebar-link reco-side-validaciones-y-paginas-de-estado" data-v-cb1513f6>Validaciones y Páginas de Estado</a></li><li class="level-2" data-v-cb1513f6><a href="/blogs/2023/2023-06-19-reactive-api-rest-pt-ii.html#almacenamiento-reactivo-en-la-base-de-datos" class="sidebar-link reco-side-almacenamiento-reactivo-en-la-base-de-datos" data-v-cb1513f6>Almacenamiento Reactivo en la Base de Datos</a></li><li class="level-3" data-v-cb1513f6><a href="/blogs/2023/2023-06-19-reactive-api-rest-pt-ii.html#configuracion-de-la-aplicacion" class="sidebar-link reco-side-configuracion-de-la-aplicacion" data-v-cb1513f6>Configuración de la aplicación</a></li><li class="level-3" data-v-cb1513f6><a href="/blogs/2023/2023-06-19-reactive-api-rest-pt-ii.html#definiendo-tablas-y-entidades" class="sidebar-link reco-side-definiendo-tablas-y-entidades" data-v-cb1513f6>Definiendo Tablas y Entidades</a></li><li class="level-3" data-v-cb1513f6><a href="/blogs/2023/2023-06-19-reactive-api-rest-pt-ii.html#codificando-el-cliente-del-servicio-de-base-de-datos" class="sidebar-link reco-side-codificando-el-cliente-del-servicio-de-base-de-datos" data-v-cb1513f6>Codificando el Cliente del Servicio de Base de Datos</a></li><li class="level-3" data-v-cb1513f6><a href="/blogs/2023/2023-06-19-reactive-api-rest-pt-ii.html#actualizando-el-repositorio-para-usar-nuestro-sistema-de-almacenamiento-en-la-base-de-datos" class="sidebar-link reco-side-actualizando-el-repositorio-para-usar-nuestro-sistema-de-almacenamiento-en-la-base-de-datos" data-v-cb1513f6>Actualizando el repositorio para usar nuestro sistema de almacenamiento en la base de datos</a></li><li class="level-2" data-v-cb1513f6><a href="/blogs/2023/2023-06-19-reactive-api-rest-pt-ii.html#codificando-nuestros-servicios" class="sidebar-link reco-side-codificando-nuestros-servicios" data-v-cb1513f6>Codificando nuestros servicios.</a></li><li class="level-3" data-v-cb1513f6><a href="/blogs/2023/2023-06-19-reactive-api-rest-pt-ii.html#cache" class="sidebar-link reco-side-cache" data-v-cb1513f6>Caché</a></li><li class="level-3" data-v-cb1513f6><a href="/blogs/2023/2023-06-19-reactive-api-rest-pt-ii.html#railway-oriented-programming-rop" class="sidebar-link reco-side-railway-oriented-programming-rop" data-v-cb1513f6>Railway Oriented Programming (ROP)</a></li><li class="level-3" data-v-cb1513f6><a href="/blogs/2023/2023-06-19-reactive-api-rest-pt-ii.html#notificaciones-en-tiempo-real-con-websockets" class="sidebar-link reco-side-notificaciones-en-tiempo-real-con-websockets" data-v-cb1513f6>Notificaciones en tiempo real con WebSockets</a></li><li class="level-3" data-v-cb1513f6><a href="/blogs/2023/2023-06-19-reactive-api-rest-pt-ii.html#almacenamiento-de-archivos" class="sidebar-link reco-side-almacenamiento-de-archivos" data-v-cb1513f6>Almacenamiento de archivos</a></li><li class="level-3" data-v-cb1513f6><a href="/blogs/2023/2023-06-19-reactive-api-rest-pt-ii.html#nuestra-ruta-final" class="sidebar-link reco-side-nuestra-ruta-final" data-v-cb1513f6>Nuestra Ruta Final</a></li><li class="level-2" data-v-cb1513f6><a href="/blogs/2023/2023-06-19-reactive-api-rest-pt-ii.html#testing" class="sidebar-link reco-side-testing" data-v-cb1513f6>Testing</a></li><li class="level-3" data-v-cb1513f6><a href="/blogs/2023/2023-06-19-reactive-api-rest-pt-ii.html#testeando-el-repositorio-de-raquetas" class="sidebar-link reco-side-testeando-el-repositorio-de-raquetas" data-v-cb1513f6>Testeando el repositorio de raquetas</a></li><li class="level-3" data-v-cb1513f6><a href="/blogs/2023/2023-06-19-reactive-api-rest-pt-ii.html#testeando-el-servicio-de-raquetas" class="sidebar-link reco-side-testeando-el-servicio-de-raquetas" data-v-cb1513f6>Testeando el servicio de raquetas</a></li><li class="level-2" data-v-cb1513f6><a href="/blogs/2023/2023-06-19-reactive-api-rest-pt-ii.html#¿que-sigue" class="sidebar-link reco-side-¿que-sigue" data-v-cb1513f6>¿Qué sigue?</a></li></ul></main> <!----> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.6f62f259.js" defer></script><script src="/assets/js/3.33813761.js" defer></script><script src="/assets/js/1.35f3822e.js" defer></script><script src="/assets/js/50.bb80fe18.js" defer></script>
  </body>
</html>
