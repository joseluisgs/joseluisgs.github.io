<!DOCTYPE html>
<html lang="es-ES">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Crea tu API REST reactiva con Kotlin y Ktor Parte III | José Luis González</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="favicon.png">
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-103H05W8P8"></script>
    <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
      
          gtag('config', 'G-103H05W8P8');
    </script>
    <script async="true" src="https://code.iconify.design/2/2.2.1/iconify.min.js"></script>
    <script type="module" async="true" src="https://unpkg.com/giscus?module"></script>
    <meta name="description" content="Cómo crear un servicio REST aplicando reactividad y consideraciones a tener en cuenta para ello">
    <meta property="og:image" content="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MNYTHm0fGgHP_UUalJuCUg.png">
    <meta property="og:image:type">
    <meta property="og:image:width">
    <meta property="og:image:height">
    <meta property="og:image:alt">
    <meta name="twitter:image" content="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MNYTHm0fGgHP_UUalJuCUg.png">
    <meta itemprop="image" content="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MNYTHm0fGgHP_UUalJuCUg.png">
    <meta property="og:description" content="Cómo crear un servicio REST aplicando reactividad y consideraciones a tener en cuenta para ello">
    <meta name="twitter:description" content="Cómo crear un servicio REST aplicando reactividad y consideraciones a tener en cuenta para ello">
    <meta itemprop="description" content="Cómo crear un servicio REST aplicando reactividad y consideraciones a tener en cuenta para ello">
    <meta property="og:url" content="https://joseluisgs.dev/blogs/2023/2023-07-10-reactive-api-rest-pt-iii.html">
    <meta name="twitter:url" content="https://joseluisgs.dev/blogs/2023/2023-07-10-reactive-api-rest-pt-iii.html">
    <meta property="og:title" content="Crea tu API REST reactiva con Kotlin y Ktor Parte III">
    <meta name="twitter:title" content="Crea tu API REST reactiva con Kotlin y Ktor Parte III">
    <meta itemprop="name" content="Crea tu API REST reactiva con Kotlin y Ktor Parte III">
    <meta property="og:type" content="article">
    <meta name="twitter:card" content="summary_large_image">
    <meta property="og:site_name" content="José Luis González - Web">
    <meta name="twitter:creator" content="@JoseLuisGS_">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta name="author" content="José Luis González Sánchez">
    <meta name="application-name" content="José Luis González Sánchez. Web Personal">
    <meta name="keywords" content="José Luis González Sánchez, Profesor, Formador, Desarrollador, Investigador, Desarrollo de Aplicaciones, Web, Multiplataforma, FP, Formación Profesional, Kotlin, Trainer, Certificación, Jetbrains, Embajador, GIT, GitKraken, Vuejs, móvil, jetbrains, intellij, hyperskill, docker, mongodb, nodejs, node, android, compose, backend, java, spring, springboot, instituto, test, pruebas, calidad, Luis Vives, Leganés, Madrid, Universidad de Granada, Jugabilidad, Videojuegos">
    <meta name="google-site-verification" content="6faOYM6NoaSKvkuz4Qexps8JgYe65lIQukYB5eScb90">
    
    <link rel="preload" href="/assets/css/0.styles.0693de81.css" as="style"><link rel="preload" href="/assets/js/app.39fd9e7d.js" as="script"><link rel="preload" href="/assets/js/3.a10607c3.js" as="script"><link rel="preload" href="/assets/js/1.65d7671f.js" as="script"><link rel="preload" href="/assets/js/52.cdf939fe.js" as="script"><link rel="prefetch" href="/assets/js/10.c10d33a9.js"><link rel="prefetch" href="/assets/js/11.681bda01.js"><link rel="prefetch" href="/assets/js/12.9ad81fbc.js"><link rel="prefetch" href="/assets/js/13.09788d32.js"><link rel="prefetch" href="/assets/js/14.b84cc3c1.js"><link rel="prefetch" href="/assets/js/15.ed86afeb.js"><link rel="prefetch" href="/assets/js/16.b12f967d.js"><link rel="prefetch" href="/assets/js/17.ae21afbf.js"><link rel="prefetch" href="/assets/js/18.e278aafe.js"><link rel="prefetch" href="/assets/js/19.4c94578f.js"><link rel="prefetch" href="/assets/js/20.8111dbeb.js"><link rel="prefetch" href="/assets/js/21.5b7737d7.js"><link rel="prefetch" href="/assets/js/22.3f27c70d.js"><link rel="prefetch" href="/assets/js/23.c879ae4e.js"><link rel="prefetch" href="/assets/js/24.53750a2c.js"><link rel="prefetch" href="/assets/js/25.08af0341.js"><link rel="prefetch" href="/assets/js/26.fc75dde1.js"><link rel="prefetch" href="/assets/js/27.2d5ac114.js"><link rel="prefetch" href="/assets/js/28.f1a0df9c.js"><link rel="prefetch" href="/assets/js/29.7867fdb3.js"><link rel="prefetch" href="/assets/js/30.1cbfb936.js"><link rel="prefetch" href="/assets/js/31.b649fc5d.js"><link rel="prefetch" href="/assets/js/32.587f56d2.js"><link rel="prefetch" href="/assets/js/33.d8c6f6ad.js"><link rel="prefetch" href="/assets/js/34.ba2e914d.js"><link rel="prefetch" href="/assets/js/35.586d670f.js"><link rel="prefetch" href="/assets/js/36.fb4feefd.js"><link rel="prefetch" href="/assets/js/37.60ed081e.js"><link rel="prefetch" href="/assets/js/38.40c291df.js"><link rel="prefetch" href="/assets/js/39.c1c95346.js"><link rel="prefetch" href="/assets/js/4.7e08d87f.js"><link rel="prefetch" href="/assets/js/40.bccb35d9.js"><link rel="prefetch" href="/assets/js/41.04af8ed9.js"><link rel="prefetch" href="/assets/js/42.2409ece7.js"><link rel="prefetch" href="/assets/js/43.d8256da8.js"><link rel="prefetch" href="/assets/js/44.adc2504e.js"><link rel="prefetch" href="/assets/js/45.1a9d0800.js"><link rel="prefetch" href="/assets/js/46.050dba12.js"><link rel="prefetch" href="/assets/js/47.e50ba0cc.js"><link rel="prefetch" href="/assets/js/48.510fbb32.js"><link rel="prefetch" href="/assets/js/49.8dac9c10.js"><link rel="prefetch" href="/assets/js/5.510cc1f2.js"><link rel="prefetch" href="/assets/js/50.991bfdad.js"><link rel="prefetch" href="/assets/js/51.84fab53e.js"><link rel="prefetch" href="/assets/js/53.87959f7e.js"><link rel="prefetch" href="/assets/js/54.399f2ef5.js"><link rel="prefetch" href="/assets/js/55.9ecdd43d.js"><link rel="prefetch" href="/assets/js/56.8806a60f.js"><link rel="prefetch" href="/assets/js/57.cf28891d.js"><link rel="prefetch" href="/assets/js/58.346b8713.js"><link rel="prefetch" href="/assets/js/59.70b79180.js"><link rel="prefetch" href="/assets/js/6.1c4e1a81.js"><link rel="prefetch" href="/assets/js/60.b09ea619.js"><link rel="prefetch" href="/assets/js/61.9e4cd62d.js"><link rel="prefetch" href="/assets/js/62.17799dbb.js"><link rel="prefetch" href="/assets/js/63.e1f2a138.js"><link rel="prefetch" href="/assets/js/64.e97d0956.js"><link rel="prefetch" href="/assets/js/65.de92a8b6.js"><link rel="prefetch" href="/assets/js/66.1117fa85.js"><link rel="prefetch" href="/assets/js/67.fbb3b04d.js"><link rel="prefetch" href="/assets/js/68.7e7f438f.js"><link rel="prefetch" href="/assets/js/69.028defd9.js"><link rel="prefetch" href="/assets/js/7.7c2b0889.js"><link rel="prefetch" href="/assets/js/70.9c147bb3.js"><link rel="prefetch" href="/assets/js/71.467e593f.js"><link rel="prefetch" href="/assets/js/72.acdcf567.js"><link rel="prefetch" href="/assets/js/73.4ba590bd.js"><link rel="prefetch" href="/assets/js/74.03fb1f55.js"><link rel="prefetch" href="/assets/js/75.a2f334b3.js"><link rel="prefetch" href="/assets/js/76.68d810be.js"><link rel="prefetch" href="/assets/js/77.26a4d97d.js"><link rel="prefetch" href="/assets/js/78.3e3bb57c.js"><link rel="prefetch" href="/assets/js/79.58ac8ddb.js"><link rel="prefetch" href="/assets/js/8.3b721c95.js"><link rel="prefetch" href="/assets/js/80.35af7faf.js"><link rel="prefetch" href="/assets/js/81.566e03b0.js"><link rel="prefetch" href="/assets/js/82.3d67079e.js"><link rel="prefetch" href="/assets/js/9.6546a01f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.0693de81.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-1aefc0b4><div data-v-1aefc0b4><div id="loader-wrapper" class="loading-wrapper" data-v-3c97ba04 data-v-1aefc0b4 data-v-1aefc0b4><div class="loader-main" data-v-3c97ba04><div data-v-3c97ba04></div><div data-v-3c97ba04></div><div data-v-3c97ba04></div><div data-v-3c97ba04></div></div> <!----> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-25ba6db2 data-v-1aefc0b4 data-v-1aefc0b4><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>José Luis González</h3> <p class="description" data-v-25ba6db2 data-v-25ba6db2>Web personal de José Luis González Sánchez</p> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><span data-v-25ba6db2>José Luis González</span>
            
          <span data-v-25ba6db2>2021 - </span>
          2025
        </a></span></div></div> <div class="hide" data-v-1aefc0b4><header class="navbar" data-v-1aefc0b4><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="José Luis González" class="logo"> <span class="site-name">JoseLuisGS</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><ul class="color-mode-options"><li class="dark"><span data-icon="bxs:moon" class="iconify"></span></li><li class="auto active"><span data-icon="ic:baseline-brightness-auto" class="iconify"></span></li><li class="light"><span data-icon="bxs:sun" class="iconify"></span></li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link" data-v-20159458><i class="iconfont reco-home" data-v-20159458></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-account"></i>
      Info
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/info/personal/" class="nav-link" data-v-20159458><i class="iconfont reco-theme" data-v-20159458></i>
  Personal
</a></li><li class="dropdown-item"><!----> <a href="/docs/info/investigacion/" class="nav-link" data-v-20159458><i class="iconfont reco-blog" data-v-20159458></i>
  Investigación
</a></li></ul></div></div><div class="nav-item"><a href="/docs/docencia/" class="nav-link" data-v-20159458><i class="iconfont reco-suggestion" data-v-20159458></i>
  Docencia
</a></div><div class="nav-item"><a href="/docs/proyectos/" class="nav-link" data-v-20159458><i class="iconfont reco-api" data-v-20159458></i>
  Proyectos
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Categorías
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Blog/" class="nav-link" data-v-20159458><i class="undefined" data-v-20159458></i>
  Blog
</a></li><li class="dropdown-item"><!----> <a href="/categories/Personal/" class="nav-link" data-v-20159458><i class="undefined" data-v-20159458></i>
  Personal
</a></li><li class="dropdown-item"><!----> <a href="/categories/Docencia/" class="nav-link" data-v-20159458><i class="undefined" data-v-20159458></i>
  Docencia
</a></li><li class="dropdown-item"><!----> <a href="/categories/Proyectos/" class="nav-link" data-v-20159458><i class="undefined" data-v-20159458></i>
  Proyectos
</a></li><li class="dropdown-item"><!----> <a href="/categories/Investigación/" class="nav-link" data-v-20159458><i class="undefined" data-v-20159458></i>
  Investigación
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link" data-v-20159458><i class="iconfont reco-tag" data-v-20159458></i>
  Etiquetas
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link" data-v-20159458><i class="iconfont reco-date" data-v-20159458></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contacto
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://forms.gle/V2m42qiW1s6X4oNt8" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-20159458><i data-icon="mdi:help-circle" class="iconify-inline iconfont" data-v-20159458></i> 
  Ayuda
  <span data-v-20159458><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/joseluisgs" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-20159458><i data-icon="mdi:github" class="iconify-inline iconfont" data-v-20159458></i> 
  GitHub
  <span data-v-20159458><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://x.com/JoseLuisGS_" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-20159458><i data-icon="fa6-brands:x-twitter" class="iconify-inline iconfont" data-v-20159458></i> 
  X-Twitter
  <span data-v-20159458><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.linkedin.com/in/joseluisgonsan" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-20159458><i data-icon="mdi:linkedin" class="iconify-inline iconfont" data-v-20159458></i> 
  LinkedIn
  <span data-v-20159458><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.instagram.com/joseluisgs.dev" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-20159458><i data-icon="mdi:instagram" class="iconify-inline iconfont" data-v-20159458></i> 
  Instagram
  <span data-v-20159458><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://g.dev/joseluisgs" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-20159458><i data-icon="raphael:code" class="iconify-inline iconfont" data-v-20159458></i> 
  Google Dev
  <span data-v-20159458><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.youtube.com/@joseluisgs" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-20159458><i data-icon="mdi:youtube" class="iconify-inline iconfont" data-v-20159458></i> 
  YouTube
  <span data-v-20159458><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-1aefc0b4></div> <aside class="sidebar" data-v-1aefc0b4><div class="personal-info-wrapper" data-v-bb904086 data-v-1aefc0b4><img src="/img/avatar.jpeg" alt="author-avatar" class="personal-img" data-v-bb904086> <h3 class="name" data-v-bb904086>
    José Luis González
  </h3> <h5 class="trabajo" data-v-bb904086>
    PhD - Profesor<br data-v-bb904086>
    Investigador - Desarrollador<br data-v-bb904086>
    Kotlin Trainer certified by Jetbrains<br data-v-bb904086>
    Github Campus Advisor<br data-v-bb904086>
    GitKraken Ambassador<br data-v-bb904086></h5> <ul class="social-links" data-v-bb904086><li class="social-item" data-v-bb904086><a href="https://github.com/joseluisgs" target="_blank" class="social-link" data-v-bb904086><i data-icon="mdi:github" class="iconify-inline social-icon" style="color:#AAA;" data-v-bb904086></i></a></li><li class="social-item" data-v-bb904086><a href="https://x.com/JoseLuisGS_" target="_blank" class="social-link" data-v-bb904086><i data-icon="fa6-brands:x-twitter" class="iconify-inline social-icon" style="color:#888;" data-v-bb904086></i></a></li><li class="social-item" data-v-bb904086><a href="https://www.linkedin.com/in/joseluisgonsan" target="_blank" class="social-link" data-v-bb904086><i data-icon="mdi:linkedin" class="iconify-inline social-icon" style="color:#0077B5;" data-v-bb904086></i></a></li><li class="social-item" data-v-bb904086><a href="https://www.instagram.com/joseluisgs.dev" target="_blank" class="social-link" data-v-bb904086><i data-icon="mdi:instagram" class="iconify-inline social-icon" style="color:#e56969;" data-v-bb904086></i></a></li><li class="social-item" data-v-bb904086><a href="https://g.dev/joseluisgs" target="_blank" class="social-link" data-v-bb904086><i data-icon="raphael:code" class="iconify-inline social-icon" style="color:#e81055;" data-v-bb904086></i></a></li><li class="social-item" data-v-bb904086><a href="https://www.youtube.com/@joseluisgs" target="_blank" class="social-link" data-v-bb904086><i data-icon="mdi:youtube" class="iconify-inline social-icon" style="color:#E62117;" data-v-bb904086></i></a></li></ul> <div class="num" data-v-bb904086><div data-v-bb904086><h3 data-v-bb904086>68</h3> <h6 data-v-bb904086>Artículos</h6></div> <div data-v-bb904086><h3 data-v-bb904086>30</h3> <h6 data-v-bb904086>Etiquetas</h6></div></div> <hr data-v-bb904086></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link" data-v-20159458><i class="iconfont reco-home" data-v-20159458></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-account"></i>
      Info
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/info/personal/" class="nav-link" data-v-20159458><i class="iconfont reco-theme" data-v-20159458></i>
  Personal
</a></li><li class="dropdown-item"><!----> <a href="/docs/info/investigacion/" class="nav-link" data-v-20159458><i class="iconfont reco-blog" data-v-20159458></i>
  Investigación
</a></li></ul></div></div><div class="nav-item"><a href="/docs/docencia/" class="nav-link" data-v-20159458><i class="iconfont reco-suggestion" data-v-20159458></i>
  Docencia
</a></div><div class="nav-item"><a href="/docs/proyectos/" class="nav-link" data-v-20159458><i class="iconfont reco-api" data-v-20159458></i>
  Proyectos
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Categorías
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Blog/" class="nav-link" data-v-20159458><i class="undefined" data-v-20159458></i>
  Blog
</a></li><li class="dropdown-item"><!----> <a href="/categories/Personal/" class="nav-link" data-v-20159458><i class="undefined" data-v-20159458></i>
  Personal
</a></li><li class="dropdown-item"><!----> <a href="/categories/Docencia/" class="nav-link" data-v-20159458><i class="undefined" data-v-20159458></i>
  Docencia
</a></li><li class="dropdown-item"><!----> <a href="/categories/Proyectos/" class="nav-link" data-v-20159458><i class="undefined" data-v-20159458></i>
  Proyectos
</a></li><li class="dropdown-item"><!----> <a href="/categories/Investigación/" class="nav-link" data-v-20159458><i class="undefined" data-v-20159458></i>
  Investigación
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link" data-v-20159458><i class="iconfont reco-tag" data-v-20159458></i>
  Etiquetas
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link" data-v-20159458><i class="iconfont reco-date" data-v-20159458></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contacto
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://forms.gle/V2m42qiW1s6X4oNt8" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-20159458><i data-icon="mdi:help-circle" class="iconify-inline iconfont" data-v-20159458></i> 
  Ayuda
  <span data-v-20159458><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/joseluisgs" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-20159458><i data-icon="mdi:github" class="iconify-inline iconfont" data-v-20159458></i> 
  GitHub
  <span data-v-20159458><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://x.com/JoseLuisGS_" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-20159458><i data-icon="fa6-brands:x-twitter" class="iconify-inline iconfont" data-v-20159458></i> 
  X-Twitter
  <span data-v-20159458><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.linkedin.com/in/joseluisgonsan" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-20159458><i data-icon="mdi:linkedin" class="iconify-inline iconfont" data-v-20159458></i> 
  LinkedIn
  <span data-v-20159458><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.instagram.com/joseluisgs.dev" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-20159458><i data-icon="mdi:instagram" class="iconify-inline iconfont" data-v-20159458></i> 
  Instagram
  <span data-v-20159458><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://g.dev/joseluisgs" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-20159458><i data-icon="raphael:code" class="iconify-inline iconfont" data-v-20159458></i> 
  Google Dev
  <span data-v-20159458><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.youtube.com/@joseluisgs" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-20159458><i data-icon="mdi:youtube" class="iconify-inline iconfont" data-v-20159458></i> 
  YouTube
  <span data-v-20159458><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-25ba6db2 data-v-1aefc0b4><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>Crea tu API REST reactiva con Kotlin y Ktor Parte III</h3> <!----> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><span data-v-25ba6db2>José Luis González</span>
            
          <span data-v-25ba6db2>2021 - </span>
          2025
        </a></span></div></div> <div data-v-1aefc0b4><main class="page"><div class="page-title"><h1 class="title">Crea tu API REST reactiva con Kotlin y Ktor Parte III</h1> <div data-v-7b53e9f2><i class="iconfont reco-account" data-v-7b53e9f2><span data-v-7b53e9f2>José Luis González</span></i> <div class="page-info" data-v-7b53e9f2><i class="iconfont reco-date" data-v-7b53e9f2><span data-v-7b53e9f2>10/7/2023</span></i> <i class="iconfont reco-eye" data-v-7b53e9f2><span data-v-7b53e9f2>29 min.</span></i></div> <i class="tags iconfont reco-tag" data-v-7b53e9f2><span class="tag-item" data-v-7b53e9f2>Proyectos</span><span class="tag-item" data-v-7b53e9f2>Blog</span><span class="tag-item" data-v-7b53e9f2>Docencia</span><span class="tag-item" data-v-7b53e9f2>Kotlin</span><span class="tag-item" data-v-7b53e9f2>Ktor</span></i></div> <img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MNYTHm0fGgHP_UUalJuCUg.png" alt="Image noticia"></div> <div class="theme-reco-content content__default"><p>Continuamos y finalizamos nuestro tutorial con esta tercera parte de cómo  crear una API REST Reactiva, siguiendo lo aprendido en la <a href="/blogs/2023/2023-05-29-reactive-api-rest-pt-i.html">primera parte</a> y en la <a href="/blogs/2023/2023-06-19-reactive-api-rest-pt-ii.html">segunda parte</a>. Te recuerdo que esta serie de artículos forman parte de mis actividades con <a href="https://hyperskill.org/" target="_blank" rel="noopener noreferrer">Hyperskill<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> de <a href="https://lp.jetbrains.com/jba-students/" target="_blank" rel="noopener noreferrer">Jetbrains Academy<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Se basan en la traducción de lo publicado Medium. Recomiendo que leáis el original en inglés y votéis para que sigan saliendo más partes: <a href="https://link.medium.com/QjZf0pNLjBb" target="_blank" rel="noopener noreferrer">Creating Your Reactive REST API with Kotlin and Ktor Part III<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <div class="custom-block warning"><p class="title">Sobre la traducción</p><p>Lamentablemente no tengo tiempo para traducir todos los artículos que escribo, para continuar con la primera parte he usado ChatGPT y pulido los errores que me he encontrado. De nuevo te recomiendo la lectura del original en inglés si buscas el 100% de exactitud: <a href="https://link.medium.com/QjZf0pNLjBb" target="_blank" rel="noopener noreferrer">Creating Your Reactive REST API with Kotlin and Ktor Part III<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p></div><h2 id="introduccion"><a href="#introduccion" class="header-anchor">#</a> Introducción</h2> <p>Ahora es el momento de la tercera y última parte de este tutorial sobre la creación de un servicio REST reactivo.</p> <p>En la <a href="/blogs/2023/2023-05-29-reactive-api-rest-pt-i.html">primera parte</a>, discutimos los beneficios de aplicar la reactividad en nuestros servicios y creamos nuestro primer punto final utilizando Ktor. En la <a href="/blogs/2023/2023-06-19-reactive-api-rest-pt-ii.html">segunda parte</a>, implementamos algunos servicios: WebSockets, caché, almacenamiento y utilizamos la programación orientada al ferrocarril para gestionar nuestros errores y realizar pruebas utilizando mocks.</p> <p>En la parte final, nos centraremos en mejorar la inyección de dependencias, proporcionar mecanismos de autenticación y autorización, documentar y desplegar nuestro servicio en un contenedor. Por favor, visita los tutoriales anteriores primero para entender algunos de los pasos tomados aquí y dados por sentado, o para ver cómo se ha organizado el código.</p> <p>Como en otros tutoriales, el objetivo es mostrarte todo lo que aprenderás a través de las pistas en <a href="https://hyperskill.org/tracks?utm_source=medium_hs&amp;utm_medium=social&amp;utm_campaign=ktor3&amp;utm_term=27.07.2023" target="_blank" rel="noopener noreferrer">Hyperskill<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. <strong>Hyperskill es el lugar perfecto para profundizar, ampliar tus conocimientos y aprender más sobre lo que se presenta en este tutorial. Es la plataforma ideal para aprender tecnologías de Kotlin y utilizar Ktor. No dudes en unirte y continuar tu viaje de aprendizaje</strong>. Recuerda que este código es pedagógico y muestra muchos de los contenidos que aprenderás de manera didáctica y fácil de leer. No está destinado a crear el mejor código de producción en entornos reales. Sabemos que muchas cosas se pueden hacer mejor, pero se exageran en el código para que, como estudiante, puedas analizar las posibilidades. Tómatelo con calma y consulta Hyperskill para obtener más características geniales para tus servicios de Kotlin y Ktor. Por favor, siéntete libre de experimentar y modificar lo que pueda mejorar tu auto-codificación con diferentes ejemplos y alcanzar tus objetivos.</p> <p style="text-align:center;"><img loading="lazy" src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MNYTHm0fGgHP_UUalJuCUg.png" style="border-radius:0.25rem;"></p> <h2 id="inyeccion-de-dependencias-con-koin"><a href="#inyeccion-de-dependencias-con-koin" class="header-anchor">#</a> Inyección de dependencias con Koin</h2> <p>La inyección de dependencias es un patrón de diseño utilizado en el desarrollo de software para lograr un acoplamiento flexible y promover un código modular y reutilizable. En este patrón, las dependencias (objetos externos o servicios) requeridas por una clase se proporcionan en lugar de que la clase las cree o administre ellas mismas. Hay varias razones por las que deberías usar la inyección de dependencias:</p> <ul><li>Desacoplamiento: Al inyectar dependencias, una clase no necesita saber cómo crear o administrarlas. Esto desacopla la clase de las implementaciones específicas de sus dependencias, lo que facilita el mantenimiento, las pruebas y las modificaciones futuras.</li> <li>Reutilización: Con la inyección de dependencias, las dependencias se pueden reutilizar en múltiples clases o módulos. Promueve la reutilización de código, ya que la misma dependencia se puede inyectar en diferentes clases sin duplicar código o crear dependencias fuertes.</li> <li>Testabilidad: La inyección de dependencias facilita las pruebas unitarias al permitir que las dependencias se simulen o se reemplacen fácilmente con objetos de prueba. Esto permite pruebas aisladas de componentes individuales sin configuraciones complejas o dependencia de recursos externos.</li> <li>Flexibilidad: La inyección de dependencias facilita el intercambio o cambio de dependencias sin modificar las clases que dependen de ellas. Esta flexibilidad permite una adaptación más sencilla a los requisitos cambiantes o la integración de nuevas funcionalidades.</li></ul> <p>En nuestro servicio, utilizamos <a href="https://insert-koin.io/" target="_blank" rel="noopener noreferrer">Koin<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Koin es un marco de inyección de dependencias ligero y multiplataforma para Kotlin. Proporciona una forma simple y concisa de manejar dependencias en tus proyectos de Kotlin. Con Koin, puedes definir e inyectar dependencias fácilmente sin necesidad de una configuración compleja o código redundante. Ofrece un <a href="https://insert-koin.io/docs/reference/koin-core/dsl/" target="_blank" rel="noopener noreferrer">DSL<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (Lenguaje Específico del Dominio) que te permite declarar y resolver dependencias de forma legible e intuitiva. Podemos usar <a href="https://insert-koin.io/docs/setup/annotations" target="_blank" rel="noopener noreferrer">anotaciones<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> o una versión especial para <a href="https://insert-koin.io/docs/reference/koin-ktor/ktor" target="_blank" rel="noopener noreferrer">Ktor<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Me encanta Koin porque se adapta a lo que necesitas en cualquier situación.</p> <p style="text-align:center;"><img loading="lazy" src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*F4dBIOwBb3mfOb7z28hOtg.png" style="border-radius:0.25rem;"></p> <p>Añadimos las siguientes dependencias en nuestro archivo build.gradle.kts y sincronizamos el proyecto. Utilizaremos anotaciones porque si eres nuevo en Koin, el objetivo final es facilitar la inyección de dependencias y no aprender todo el DSL u otras opciones que ofrece Koin, por lo que necesitamos agregar el complemento ksp y opciones con Koin.</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code>plugins <span class="token punctuation">{</span>
    <span class="token function">kotlin</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;jvm&quot;</span></span><span class="token punctuation">)</span> version <span class="token string-literal singleline"><span class="token string">&quot;1.8.21&quot;</span></span>
    <span class="token function">id</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;io.ktor.plugin&quot;</span></span><span class="token punctuation">)</span> version <span class="token string-literal singleline"><span class="token string">&quot;2.3.1&quot;</span></span>
    <span class="token function">id</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;org.jetbrains.kotlin.plugin.serialization&quot;</span></span><span class="token punctuation">)</span> version <span class="token string-literal singleline"><span class="token string">&quot;1.8.21&quot;</span></span>
    <span class="token comment">// KSP for Koin Annotations</span>
    <span class="token function">id</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;com.google.devtools.ksp&quot;</span></span><span class="token punctuation">)</span> version <span class="token string-literal singleline"><span class="token string">&quot;1.8.21-1.0.11&quot;</span></span>
<span class="token punctuation">}</span>

<span class="token comment">//...</span>
dependencies <span class="token punctuation">{</span>
<span class="token comment">// ...</span>
<span class="token comment">// Koin for Dependency Injection</span>
  <span class="token function">implementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;io.insert-koin:koin-ktor:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">koin_ktor_version</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span> <span class="token comment">// Koin for Ktor</span>
  <span class="token function">implementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;io.insert-koin:koin-logger-slf4j:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">koin_ktor_version</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span> <span class="token comment">// Koin Logger</span>
  <span class="token function">implementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;io.insert-koin:koin-annotations:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">koin_ksp_version</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span> <span class="token comment">// Koin Annotations for KSP</span>
  <span class="token function">ksp</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;io.insert-koin:koin-ksp-compiler:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">koin_ksp_version</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span> <span class="token comment">// Koin KSP Compiler for KSP</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="configuracion-de-koin"><a href="#configuracion-de-koin" class="header-anchor">#</a> Configuración de Koin</h3> <p>Antes de continuar, necesitamos configurar Koin en Ktor. Gracias a su funcionalidad para Ktor, esto es una tarea sencilla. Una vez más, crearemos un complemento llamado &quot;Koin&quot;. Dado que utilizaremos Koin con anotaciones, no es necesario definir nada más explícitamente. Todas las dependencias se definirán utilizando anotaciones, creando automáticamente un módulo predeterminado con todas las dependencias precalculadas. Es sencillo y directo. Por último, como hemos hecho anteriormente, cargaremos este complemento en nuestra aplicación. Te recomiendo cargarlo como el primer complemento, ya que estas dependencias serán necesarias desde el principio.</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token keyword">fun</span> Application<span class="token punctuation">.</span><span class="token function">configureKoin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">install</span><span class="token punctuation">(</span>Koin<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">slf4jLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Logger</span>
  <span class="token function">defaultModule</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Default module with Annotations</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token keyword">fun</span> Application<span class="token punctuation">.</span><span class="token function">module</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">configureKoin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Configure the Koin plugin to inject dependencies</span>
  <span class="token function">configureWebSockets</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Configure the websockets plugin</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="inyeccion-de-la-configuracion"><a href="#inyeccion-de-la-configuracion" class="header-anchor">#</a> Inyección de la configuración</h3> <p>Creemos una clase de configuración para encapsular los ajustes de nuestro servicio. De esta manera, podemos utilizar diferentes archivos de configuración si es necesario. Al hacer esto, podemos inyectar fácilmente esta configuración. Utilizaremos la anotación @Singleton para asegurarnos de que solo haya una instancia de ella.</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token annotation builtin">@Singleton</span>
<span class="token keyword">class</span> AppConfig <span class="token punctuation">{</span>
  <span class="token keyword">val</span> applicationConfiguration<span class="token operator">:</span> ApplicationConfig <span class="token operator">=</span> <span class="token function">ApplicationConfig</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;application.conf&quot;</span></span><span class="token punctuation">)</span>
  <span class="token comment">// We can set here all the configuration we want from application.conf or from other sources</span>
  <span class="token comment">// val applicationName: String = applicationConfiguration.property(&quot;ktor.application.name&quot;).getString()</span>
  <span class="token comment">// val applicationPort: Int = applicationConfiguration.property(&quot;ktor.application.port&quot;).getString().toInt()</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="preparando-el-repositorio-y-los-servicios"><a href="#preparando-el-repositorio-y-los-servicios" class="header-anchor">#</a> Preparando el Repositorio y los Servicios</h3> <p>Utilizamos la anotación @Singleton en nuestro repositorio y servicios.</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token annotation builtin">@Singleton</span>
<span class="token keyword">class</span> <span class="token function">RacketsRepositoryImpl</span><span class="token punctuation">(</span>
  <span class="token keyword">private</span> <span class="token keyword">val</span> dataBaseService<span class="token operator">:</span> DataBaseService
<span class="token punctuation">)</span> <span class="token operator">:</span> RacketsRepository <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
<span class="token punctuation">}</span>

<span class="token annotation builtin">@Singleton</span>
<span class="token keyword">class</span> <span class="token function">DataBaseService</span><span class="token punctuation">(</span>
  <span class="token keyword">private</span> <span class="token keyword">val</span> myConfig<span class="token operator">:</span> AppConfig<span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
<span class="token punctuation">}</span>

<span class="token annotation builtin">@Singleton</span>
<span class="token keyword">class</span> <span class="token function">CacheService</span><span class="token punctuation">(</span>
  <span class="token keyword">private</span> <span class="token keyword">val</span> myConfig<span class="token operator">:</span> AppConfig<span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
<span class="token punctuation">}</span>

<span class="token annotation builtin">@Singleton</span>
<span class="token keyword">class</span> <span class="token function">StorageServiceImpl</span><span class="token punctuation">(</span>
  <span class="token keyword">private</span> <span class="token keyword">val</span> myConfig<span class="token operator">:</span> AppConfig
<span class="token punctuation">)</span> <span class="token operator">:</span> StorageService <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
<span class="token punctuation">}</span>

<span class="token annotation builtin">@Singleton</span>
<span class="token keyword">class</span> <span class="token function">RacketsServiceImpl</span><span class="token punctuation">(</span>
  <span class="token keyword">private</span> <span class="token keyword">val</span> racketsRepository<span class="token operator">:</span> RacketsRepository<span class="token punctuation">,</span>
  <span class="token keyword">private</span> <span class="token keyword">val</span> cacheService<span class="token operator">:</span> CacheService
<span class="token punctuation">)</span> <span class="token operator">:</span> RacketsService <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h3 id="inyectando-dependencias-en-las-rutas"><a href="#inyectando-dependencias-en-las-rutas" class="header-anchor">#</a> Inyectando dependencias en las rutas</h3> <p>Ahora es el momento de inyectar dependencias en las rutas. Para hacer esto, podemos usar get, que nos proporciona una inyección inmediata, o lazy, que nos proporciona una inyección perezosa, lo que significa que las dependencias se inyectarán cuando las necesitemos. En nuestro caso, recuperaremos el repositorio utilizando get para tenerlo disponible de inmediato. Sin embargo, el almacenamiento será lazy porque solo es necesario cuando se carga una imagen. Es importante tener en cuenta que esto puede variar según el problema o las necesidades específicas. Como podemos ver fácilmente, Koin inyectará las dependencias que necesitamos donde las necesitemos, casi como por arte de magia. ¡No es maravilloso!</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token comment">// Dependency injection by Koin</span>
<span class="token keyword">val</span> racketsService<span class="token operator">:</span> RacketsService <span class="token operator">=</span> <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">val</span> storageService<span class="token operator">:</span> StorageService <span class="token keyword">by</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="autenticacion-y-autorizacion-con-jwt"><a href="#autenticacion-y-autorizacion-con-jwt" class="header-anchor">#</a> Autenticación y autorización con JWT</h2> <p>La autenticación verifica la identidad de un usuario o entidad, mientras que la autorización implica conceder o denegar acceso en función de los privilegios del usuario. JWT (JSON Web Token) es un mecanismo de autenticación y autorización basado en tokens en aplicaciones web. JWT es un token compacto y autocontenido que consta de tres partes: el encabezado, la carga útil y la firma. Transporta de manera segura información sobre la identidad y los permisos del usuario.</p> <p style="text-align:center;"><img loading="lazy" src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*Gsx2qgoi8OgzFBVaQ9-I5w.png" style="border-radius:0.25rem;"></p> <p>El token es generado por el servidor después de una autenticación exitosa y se incluye en las solicitudes posteriores para autorización. Cuando se recibe una solicitud con un JWT, el servidor verifica la autenticidad del token utilizando una clave secreta. Extrae la información necesaria de la carga útil y determina si el usuario tiene los permisos necesarios para acceder a los recursos solicitados. Al utilizar JWT, los desarrolladores pueden implementar un sistema de autenticación y autorización seguro y escalable para servicios sin necesidad de mantener un estado de sesión en el lado del servidor. Simplifica la gestión de sesiones de usuario y permite la comunicación sin estado entre el cliente y el servidor.</p> <p style="text-align:center;"><img loading="lazy" src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*STlfA5M6VAQfET7zXoWGHA.png" style="border-radius:0.25rem;"></p> <h3 id="anadiendo-dependencias"><a href="#anadiendo-dependencias" class="header-anchor">#</a> Añadiendo dependencias</h3> <p>El primer paso es agregar las dependencias necesarias para manejar JWT. Además, utilizaremos Bcrypt para cifrar las contraseñas de los usuarios. Agrega las siguientes dependencias a nuestro archivo build.gradle.kts y sincroniza el proyecto.</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token comment">// Auth JWT</span>
<span class="token function">implementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;io.ktor:ktor-server-auth-jvm:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">ktor_version</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
<span class="token function">implementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;io.ktor:ktor-server-auth-jwt-jvm:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">ktor_version</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
<span class="token function">implementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;io.ktor:ktor-server-host-common-jvm:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">ktor_version</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
<span class="token comment">// BCrypt</span>
<span class="token function">implementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;com.ToxicBakery.library.bcrypt:bcrypt:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">bcrypt_version</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="configuracion-del-token"><a href="#configuracion-del-token" class="header-anchor">#</a> Configuración del token</h3> <p>Añadamos nuestra configuración de token a nuestro archivo application.conf.</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code># JWT
jwt <span class="token punctuation">{</span>
  secret = <span class="token string">&quot;IL0v3L34rn1ngKt0rWithJ0s3Lu1sGS4ndHyp3r$k1ll&quot;</span>
  realm = <span class="token string">&quot;rackets-ktor&quot;</span>
  ## Expiration time<span class="token operator">:</span> 3600s (<span class="token number">1</span> hour)
  expiration = <span class="token string">&quot;3600&quot;</span>
  issuer = <span class="token string">&quot;rackets-ktor&quot;</span>
  audience = <span class="token string">&quot;rackets-ktor-auth&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="servicio-de-tokens"><a href="#servicio-de-tokens" class="header-anchor">#</a> Servicio de tokens</h3> <p>El siguiente paso es crear un servicio que genere los tokens y nos permita verificarlos.</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token keyword">sealed</span> <span class="token keyword">class</span> <span class="token function">TokenException</span><span class="token punctuation">(</span>message<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">RuntimeException</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">class</span> <span class="token function">InvalidTokenException</span><span class="token punctuation">(</span>message<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">TokenException</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token annotation builtin">@Single</span>
<span class="token keyword">class</span> <span class="token function">TokensService</span><span class="token punctuation">(</span>
    <span class="token keyword">private</span> <span class="token keyword">val</span> myConfig<span class="token operator">:</span> AppConfig
<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">val</span> audience <span class="token keyword">by</span> lazy <span class="token punctuation">{</span>
        myConfig<span class="token punctuation">.</span>applicationConfiguration<span class="token punctuation">.</span><span class="token function">propertyOrNull</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;jwt.audience&quot;</span></span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?:</span> <span class="token string-literal singleline"><span class="token string">&quot;jwt-audience&quot;</span></span>
    <span class="token punctuation">}</span>
    <span class="token keyword">val</span> realm <span class="token keyword">by</span> lazy <span class="token punctuation">{</span>
        myConfig<span class="token punctuation">.</span>applicationConfiguration<span class="token punctuation">.</span><span class="token function">propertyOrNull</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;jwt.realm&quot;</span></span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?:</span> <span class="token string-literal singleline"><span class="token string">&quot;jwt-realm&quot;</span></span>
    <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token keyword">val</span> issuer <span class="token keyword">by</span> lazy <span class="token punctuation">{</span>
        myConfig<span class="token punctuation">.</span>applicationConfiguration<span class="token punctuation">.</span><span class="token function">propertyOrNull</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;jwt.issuer&quot;</span></span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?:</span> <span class="token string-literal singleline"><span class="token string">&quot;jwt-issuer&quot;</span></span>
    <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token keyword">val</span> expiresIn <span class="token keyword">by</span> lazy <span class="token punctuation">{</span>
        myConfig<span class="token punctuation">.</span>applicationConfiguration<span class="token punctuation">.</span><span class="token function">propertyOrNull</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;jwt.tiempo&quot;</span></span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">toLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?:</span> <span class="token number">3600</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token keyword">val</span> secret <span class="token keyword">by</span> lazy <span class="token punctuation">{</span>
        myConfig<span class="token punctuation">.</span>applicationConfiguration<span class="token punctuation">.</span><span class="token function">propertyOrNull</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;jwt.secret&quot;</span></span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?:</span> <span class="token string-literal singleline"><span class="token string">&quot;jwt-secret&quot;</span></span>
    <span class="token punctuation">}</span>

    <span class="token keyword">init</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">debug</span> <span class="token punctuation">{</span> <span class="token string-literal singleline"><span class="token string">&quot;Init tokens service with audience: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">audience</span></span><span class="token string">&quot;</span></span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">fun</span> <span class="token function">generateJWT</span><span class="token punctuation">(</span>user<span class="token operator">:</span> User<span class="token punctuation">)</span><span class="token operator">:</span> String <span class="token punctuation">{</span>
        <span class="token keyword">return</span> JWT<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">withAudience</span><span class="token punctuation">(</span>audience<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">withIssuer</span><span class="token punctuation">(</span>issuer<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">withSubject</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Authentication&quot;</span></span><span class="token punctuation">)</span>
            <span class="token comment">// user claims and other data to store</span>
            <span class="token punctuation">.</span><span class="token function">withClaim</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;username&quot;</span></span><span class="token punctuation">,</span> user<span class="token punctuation">.</span>username<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">withClaim</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;usermail&quot;</span></span><span class="token punctuation">,</span> user<span class="token punctuation">.</span>email<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">withClaim</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;userId&quot;</span></span><span class="token punctuation">,</span> user<span class="token punctuation">.</span>id<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment">// expiration time from currentTimeMillis + (tiempo times in seconds) * 1000 (to millis)</span>
            <span class="token punctuation">.</span><span class="token function">withExpiresAt</span><span class="token punctuation">(</span><span class="token function">Date</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> expiresIn <span class="token operator">*</span> <span class="token number">1000L</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment">// sign with secret</span>
            <span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>
                Algorithm<span class="token punctuation">.</span><span class="token function">HMAC512</span><span class="token punctuation">(</span>secret<span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">fun</span> <span class="token function">verifyJWT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> JWTVerifier <span class="token punctuation">{</span>

        <span class="token keyword">return</span> <span class="token keyword">try</span> <span class="token punctuation">{</span>
            JWT<span class="token punctuation">.</span><span class="token function">require</span><span class="token punctuation">(</span>Algorithm<span class="token punctuation">.</span><span class="token function">HMAC512</span><span class="token punctuation">(</span>secret<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withAudience</span><span class="token punctuation">(</span>audience<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withIssuer</span><span class="token punctuation">(</span>issuer<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> Exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> TokenException<span class="token punctuation">.</span><span class="token function">InvalidTokenException</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Invalid token&quot;</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br></div></div><h3 id="repositorio-de-usuarios"><a href="#repositorio-de-usuarios" class="header-anchor">#</a> Repositorio de usuarios</h3> <p>Ahora necesitamos un repositorio de usuarios, por lo que necesitamos nuestro modelo de usuario.</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token keyword">data</span> <span class="token keyword">class</span> <span class="token function">User</span><span class="token punctuation">(</span>
    <span class="token keyword">val</span> id<span class="token operator">:</span> Long <span class="token operator">=</span> NEW_USER<span class="token punctuation">,</span>
    <span class="token keyword">val</span> name<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword">val</span> email<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword">val</span> username<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword">val</span> password<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword">val</span> avatar<span class="token operator">:</span> String <span class="token operator">=</span> DEFAULT_IMAGE<span class="token punctuation">,</span>
    <span class="token keyword">val</span> role<span class="token operator">:</span> Role <span class="token operator">=</span> USER<span class="token punctuation">,</span>
    <span class="token keyword">val</span> createdAt<span class="token operator">:</span> LocalDateTime <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">val</span> updatedAt<span class="token operator">:</span> LocalDateTime <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">val</span> deleted<span class="token operator">:</span> Boolean <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">companion</span> <span class="token keyword">object</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token keyword">val</span> NEW_USER <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1L</span>
        <span class="token keyword">const</span> <span class="token keyword">val</span> DEFAULT_IMAGE <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;https://i.imgur.com/fIgch2x.png&quot;</span></span>
    <span class="token punctuation">}</span>

    <span class="token keyword">enum</span> <span class="token keyword">class</span> Role <span class="token punctuation">{</span>
        USER<span class="token punctuation">,</span> ADMIN
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>También necesitamos nuestras tablas y entidades y sus mapeadores para almacenarlos en la base de datos.</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token keyword">object</span> UserTable <span class="token operator">:</span> H2Table<span class="token operator">&lt;</span>UserEntity<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;users&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Autoincrement and primary key</span>
    <span class="token keyword">val</span> id <span class="token operator">=</span> <span class="token function">autoIncrementBigInt</span><span class="token punctuation">(</span>UserEntity<span class="token operator">::</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">primaryKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// Other fields</span>
    <span class="token keyword">val</span> name <span class="token operator">=</span> <span class="token function">varchar</span><span class="token punctuation">(</span>UserEntity<span class="token operator">::</span>name<span class="token punctuation">)</span>
    <span class="token keyword">val</span> email <span class="token operator">=</span> <span class="token function">varchar</span><span class="token punctuation">(</span>UserEntity<span class="token operator">::</span>email<span class="token punctuation">)</span>
    <span class="token keyword">val</span> username <span class="token operator">=</span> <span class="token function">varchar</span><span class="token punctuation">(</span>UserEntity<span class="token operator">::</span>username<span class="token punctuation">)</span>
    <span class="token keyword">val</span> password <span class="token operator">=</span> <span class="token function">varchar</span><span class="token punctuation">(</span>UserEntity<span class="token operator">::</span>password<span class="token punctuation">)</span>
    <span class="token keyword">val</span> avatar <span class="token operator">=</span> <span class="token function">varchar</span><span class="token punctuation">(</span>UserEntity<span class="token operator">::</span>avatar<span class="token punctuation">)</span>
    <span class="token keyword">val</span> role <span class="token operator">=</span> <span class="token function">varchar</span><span class="token punctuation">(</span>UserEntity<span class="token operator">::</span>role<span class="token punctuation">)</span>

    <span class="token comment">// metadata</span>
    <span class="token keyword">val</span> createdAt <span class="token operator">=</span> <span class="token function">timestamp</span><span class="token punctuation">(</span>UserEntity<span class="token operator">::</span>createdAt<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">&quot;created_at&quot;</span></span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> updatedAt <span class="token operator">=</span> <span class="token function">timestamp</span><span class="token punctuation">(</span>UserEntity<span class="token operator">::</span>updatedAt<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">&quot;updated_at&quot;</span></span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> deleted <span class="token operator">=</span> <span class="token function">boolean</span><span class="token punctuation">(</span>UserEntity<span class="token operator">::</span>deleted<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">data</span> <span class="token keyword">class</span> <span class="token function">UserEntity</span><span class="token punctuation">(</span>
    <span class="token comment">// Id</span>
    <span class="token keyword">val</span> id<span class="token operator">:</span> Long<span class="token operator">?</span><span class="token punctuation">,</span> <span class="token comment">//</span>

    <span class="token comment">// data</span>
    <span class="token keyword">val</span> name<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword">val</span> email<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword">val</span> username<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword">val</span> password<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword">val</span> avatar<span class="token operator">:</span> String <span class="token operator">=</span> User<span class="token punctuation">.</span>DEFAULT_IMAGE<span class="token punctuation">,</span>
    <span class="token keyword">val</span> role<span class="token operator">:</span> String <span class="token operator">=</span> User<span class="token punctuation">.</span>Role<span class="token punctuation">.</span>USER<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
    <span class="token keyword">val</span> createdAt<span class="token operator">:</span> LocalDateTime <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">val</span> updatedAt<span class="token operator">:</span> LocalDateTime <span class="token operator">=</span> LocalDateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">val</span> deleted<span class="token operator">:</span> Boolean <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>Finalmente, agregaremos algunos datos de ejemplo utilizando BCrypt para tener algunos usuarios disponibles. En nuestro servicio de base de datos, instruiremos a crear las tablas de usuario y cargar estos datos, como en tutoriales anteriores. Necesitamos Bcrypt para cifrar las contraseñas, ya que proporciona un algoritmo de cifrado seguro y computacionalmente costoso que ayuda a proteger las contraseñas de los usuarios de ser comprometidas o descifradas fácilmente por posibles atacantes, y almacenamos las contraseñas cifradas en nuestra base de datos.</p> <p>Es hora de codificar nuestro repositorio para manejar usuarios e implementar las operaciones CRUD correspondientes.</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token annotation builtin">@Singleton</span>
<span class="token keyword">class</span> <span class="token function">UsersRepositoryImpl</span><span class="token punctuation">(</span>
  <span class="token keyword">private</span> <span class="token keyword">val</span> dataBaseService<span class="token operator">:</span> DataBaseService
<span class="token punctuation">)</span> <span class="token operator">:</span> UsersRepository <span class="token punctuation">{</span>


  <span class="token keyword">override</span> <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Flow<span class="token operator">&lt;</span>User<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    logger<span class="token punctuation">.</span><span class="token function">debug</span> <span class="token punctuation">{</span> <span class="token string-literal singleline"><span class="token string">&quot;findAll&quot;</span></span> <span class="token punctuation">}</span>
  
    <span class="token keyword">return</span><span class="token label symbol">@withContext</span> <span class="token punctuation">(</span>dataBaseService<span class="token punctuation">.</span>client selectFrom UserTable<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fetchAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> it<span class="token punctuation">.</span><span class="token function">toModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// . . .</span>
  
  
  <span class="token keyword">override</span> <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">checkUserNameAndPassword</span><span class="token punctuation">(</span>username<span class="token operator">:</span> String<span class="token punctuation">,</span> password<span class="token operator">:</span> String<span class="token punctuation">)</span><span class="token operator">:</span> User<span class="token operator">?</span> <span class="token operator">=</span>
  <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> user <span class="token operator">=</span> <span class="token function">findByUsername</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span>
    <span class="token keyword">return</span><span class="token label symbol">@withContext</span> user<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Bcrypt<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>password<span class="token punctuation">,</span> user<span class="token punctuation">.</span>password<span class="token punctuation">.</span><span class="token function">encodeToByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span><span class="token label symbol">@withContext</span> user
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span><span class="token label symbol">@withContext</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// . . .</span>
  <span class="token keyword">override</span> <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token operator">:</span> Long<span class="token punctuation">)</span><span class="token operator">:</span> User<span class="token operator">?</span> <span class="token operator">=</span> <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    logger<span class="token punctuation">.</span><span class="token function">debug</span> <span class="token punctuation">{</span> <span class="token string-literal singleline"><span class="token string">&quot;findById: Buscando usuario con id: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">id</span></span><span class="token string">&quot;</span></span> <span class="token punctuation">}</span>
  
    <span class="token keyword">return</span><span class="token label symbol">@withContext</span> <span class="token punctuation">(</span>dataBaseService<span class="token punctuation">.</span>client selectFrom UserTable
      <span class="token keyword">where</span> UserTable<span class="token punctuation">.</span>id eq id
      <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fetchFirstOrNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">toModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
  <span class="token comment">// . . .</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h3 id="servicio-de-usuarios"><a href="#servicio-de-usuarios" class="header-anchor">#</a> Servicio de usuarios</h3> <p>Ahora es el momento de nuestro servicio, donde también podemos implementar el almacenamiento en caché para usuarios y seguir un enfoque similar al que hicimos en el tutorial anterior con raquetas con Railway Oriented Programming (UserErrors).</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token annotation builtin">@Singleton</span>
<span class="token keyword">class</span> <span class="token function">UsersServiceImpl</span><span class="token punctuation">(</span>
  <span class="token keyword">private</span> <span class="token keyword">val</span> usersRepository<span class="token operator">:</span> UsersRepository<span class="token punctuation">,</span>
  <span class="token keyword">private</span> <span class="token keyword">val</span> cacheService<span class="token operator">:</span> CacheService
<span class="token punctuation">)</span> <span class="token operator">:</span> UsersService <span class="token punctuation">{</span>

  <span class="token keyword">override</span> <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Flow<span class="token operator">&lt;</span>User<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    logger<span class="token punctuation">.</span><span class="token function">debug</span> <span class="token punctuation">{</span> <span class="token string-literal singleline"><span class="token string">&quot;findAll: search all users&quot;</span></span> <span class="token punctuation">}</span>
    <span class="token keyword">return</span> usersRepository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">override</span> <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token operator">:</span> Long<span class="token punctuation">)</span><span class="token operator">:</span> Result<span class="token operator">&lt;</span>User<span class="token punctuation">,</span> UserError<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    logger<span class="token punctuation">.</span><span class="token function">debug</span> <span class="token punctuation">{</span> <span class="token string-literal singleline"><span class="token string">&quot;findById: search user by id&quot;</span></span> <span class="token punctuation">}</span>

    <span class="token comment">// find in cache if not found in repository</span>
    <span class="token keyword">return</span> cacheService<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">debug</span> <span class="token punctuation">{</span> <span class="token string-literal singleline"><span class="token string">&quot;findById: found in cache&quot;</span></span> <span class="token punctuation">}</span>
        <span class="token function">Ok</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token operator">?:</span> run <span class="token punctuation">{</span>
        usersRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">{</span> user <span class="token operator">-&gt;</span>
            logger<span class="token punctuation">.</span><span class="token function">debug</span> <span class="token punctuation">{</span> <span class="token string-literal singleline"><span class="token string">&quot;findById: found in repository&quot;</span></span> <span class="token punctuation">}</span>
            cacheService<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> user<span class="token punctuation">)</span>
            <span class="token function">Ok</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token operator">?:</span> <span class="token function">Err</span><span class="token punctuation">(</span>UserError<span class="token punctuation">.</span><span class="token function">NotFound</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;User with id </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">id</span></span><span class="token string"> not found&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">override</span> <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">findByUsername</span><span class="token punctuation">(</span>username<span class="token operator">:</span> String<span class="token punctuation">)</span><span class="token operator">:</span> Result<span class="token operator">&lt;</span>User<span class="token punctuation">,</span> UserError<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    logger<span class="token punctuation">.</span><span class="token function">debug</span> <span class="token punctuation">{</span> <span class="token string-literal singleline"><span class="token string">&quot;findById: search user by username&quot;</span></span> <span class="token punctuation">}</span>
    <span class="token comment">// find in cache if not found in repository</span>
    <span class="token keyword">return</span> usersRepository<span class="token punctuation">.</span><span class="token function">findByUsername</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">{</span> user <span class="token operator">-&gt;</span>
      logger<span class="token punctuation">.</span><span class="token function">debug</span> <span class="token punctuation">{</span> <span class="token string-literal singleline"><span class="token string">&quot;findById: found in repository&quot;</span></span> <span class="token punctuation">}</span>
      cacheService<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>id<span class="token punctuation">,</span> user<span class="token punctuation">)</span>
      <span class="token function">Ok</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token operator">?:</span> <span class="token function">Err</span><span class="token punctuation">(</span>UserError<span class="token punctuation">.</span><span class="token function">NotFound</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;User with username: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">username</span></span><span class="token string"> not found&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// . . .</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><h3 id="configurar-el-plugin-jwt"><a href="#configurar-el-plugin-jwt" class="header-anchor">#</a> Configurar el plugin JWT</h3> <p>Antes de continuar, debemos configurar el <a href="https://ktor.io/docs/jwt.html" target="_blank" rel="noopener noreferrer">complemento JWT<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. De esta manera, podemos interceptar los tokens JWT utilizando nuestro servicio de tokens para analizar su validez. En el complemento <strong>Security.kt</strong>.</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token keyword">fun</span> Application<span class="token punctuation">.</span><span class="token function">configureSecurity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Inject the token service</span>
  <span class="token keyword">val</span> jwtService<span class="token operator">:</span> TokensService <span class="token keyword">by</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  authentication <span class="token punctuation">{</span>
      jwt <span class="token punctuation">{</span>
          <span class="token comment">// Load the token verification config</span>
          <span class="token function">verifier</span><span class="token punctuation">(</span>jwtService<span class="token punctuation">.</span><span class="token function">verifyJWT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token comment">// With realm we can get the token from the request</span>
          realm <span class="token operator">=</span> jwtService<span class="token punctuation">.</span>realm
          validate <span class="token punctuation">{</span> credential <span class="token operator">-&gt;</span>
              <span class="token comment">// If the token is valid, it also has the indicated audience,</span>
              <span class="token comment">// and has the user's field to compare it with the one we want</span>
              <span class="token comment">// return the JWTPrincipal, otherwise return null</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span>credential<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>audience<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>jwtService<span class="token punctuation">.</span>audience<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
                  credential<span class="token punctuation">.</span>payload<span class="token punctuation">.</span><span class="token function">getClaim</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;username&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">asString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
              <span class="token punctuation">)</span>
                  <span class="token function">JWTPrincipal</span><span class="token punctuation">(</span>credential<span class="token punctuation">.</span>payload<span class="token punctuation">)</span>
              <span class="token keyword">else</span> <span class="token keyword">null</span>
          <span class="token punctuation">}</span>

          challenge <span class="token punctuation">{</span> defaultScheme<span class="token punctuation">,</span> realm <span class="token operator">-&gt;</span>
              <span class="token keyword">throw</span> TokenException<span class="token punctuation">.</span><span class="token function">InvalidTokenException</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Invalid or expired token&quot;</span></span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>También podemos utilizar <strong>StatusPages</strong> para devolver automáticamente respuestas de error al encontrarnos con tokens JWT inválidos o expirados.</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token comment">// Token is not valid or expired</span>
exception<span class="token operator">&lt;</span>TokenException<span class="token punctuation">.</span>InvalidTokenException<span class="token operator">&gt;</span> <span class="token punctuation">{</span> call<span class="token punctuation">,</span> cause <span class="token operator">-&gt;</span>
  call<span class="token punctuation">.</span><span class="token function">respond</span><span class="token punctuation">(</span>HttpStatusCode<span class="token punctuation">.</span>Unauthorized<span class="token punctuation">,</span> cause<span class="token punctuation">.</span>message<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="rutas-de-usuarios"><a href="#rutas-de-usuarios" class="header-anchor">#</a> Rutas de usuarios</h3> <p>Ahora es el momento de crear las rutas para permitir que los usuarios se registren, inicien sesión o realicen operaciones específicas en función de sus roles. Vamos a inyectar las dependencias que necesitamos.</p> <p>Podemos utilizar el método <a href="https://ktor.io/docs/authentication.html#authenticate-route" target="_blank" rel="noopener noreferrer">authenticate<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> para indicar que esas rutas o solicitudes deben estar autenticadas. Además, podemos obtener los datos del token utilizando <strong>JWTPrincipal</strong>.</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code>authenticate <span class="token punctuation">{</span>
  <span class="token comment">// Get the user info --&gt; GET /api/users/me (with token)</span>
  <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;/me&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      logger<span class="token punctuation">.</span><span class="token function">debug</span> <span class="token punctuation">{</span> <span class="token string-literal singleline"><span class="token string">&quot;GET Me /</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">ENDPOINT</span></span><span class="token string">/me&quot;</span></span> <span class="token punctuation">}</span>

      <span class="token comment">// Token came with principal (authenticated) user in its claims</span>
      <span class="token comment">// Be careful, it comes with quotes!!!</span>
      <span class="token keyword">val</span> userId <span class="token operator">=</span> call<span class="token punctuation">.</span>principal<span class="token operator">&lt;</span>JWTPrincipal<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token operator">?</span><span class="token punctuation">.</span>payload<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">getClaim</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;userId&quot;</span></span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;\&quot;&quot;</span></span><span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">&quot;&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

      usersService<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">mapBoth</span><span class="token punctuation">(</span>
              success <span class="token operator">=</span> <span class="token punctuation">{</span> call<span class="token punctuation">.</span><span class="token function">respond</span><span class="token punctuation">(</span>HttpStatusCode<span class="token punctuation">.</span>OK<span class="token punctuation">,</span> it<span class="token punctuation">.</span><span class="token function">toDto</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
              failure <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function">handleUserError</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span> <span class="token punctuation">}</span>
          <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// Get all users --&gt; GET /api/users/list (with token and only if you are admin)</span>
  <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;/list&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      logger<span class="token punctuation">.</span><span class="token function">debug</span> <span class="token punctuation">{</span> <span class="token string-literal singleline"><span class="token string">&quot;GET Users /</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">ENDPOINT</span></span><span class="token string">/list&quot;</span></span> <span class="token punctuation">}</span>

      <span class="token keyword">val</span> userId <span class="token operator">=</span> call<span class="token punctuation">.</span>principal<span class="token operator">&lt;</span>JWTPrincipal<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token operator">?</span><span class="token punctuation">.</span>payload<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">getClaim</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;userId&quot;</span></span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;\&quot;&quot;</span></span><span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">&quot;&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

      usersService<span class="token punctuation">.</span><span class="token function">isAdmin</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">onSuccess</span> <span class="token punctuation">{</span>
              usersService<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                  <span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> it<span class="token punctuation">.</span><span class="token function">toDto</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
                  <span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">{</span> call<span class="token punctuation">.</span><span class="token function">respond</span><span class="token punctuation">(</span>HttpStatusCode<span class="token punctuation">.</span>OK<span class="token punctuation">,</span> it<span class="token punctuation">)</span> <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">onFailure</span> <span class="token punctuation">{</span>
              <span class="token function">handleUserError</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//..</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>Ahora, con Postman, podemos usar nuestros tokens para hacer solicitudes. Puedes obtener una respuesta 401 si no estás autorizado o un código 403 Prohibido si no eres administrador.</p> <p style="text-align:center;"><img loading="lazy" src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*2b8FdCILdVYtp0tPuoAOqA.png" style="border-radius:0.25rem;"></p> <p style="text-align:center;"><img loading="lazy" src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*WCG3T3UjGkbOFLz6jMVSFw.png" style="border-radius:0.25rem;"></p> <p style="text-align:center;"><img loading="lazy" src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*S4Kc9smHLvqsphosKBL4_A.png" style="border-radius:0.25rem;"></p> <p style="text-align:center;"><img loading="lazy" src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*zLWjGhkTtyQB7FdkEdKWHg.png" style="border-radius:0.25rem;"></p> <h2 id="ssl-tsl-y-https"><a href="#ssl-tsl-y-https" class="header-anchor">#</a> SSL/TSL y HTTPS</h2> <p>Tenemos un problema, y puedes ver que nuestra contraseña al iniciar sesión necesita estar encriptada de extremo a extremo. SSL/TLS (Secure Sockets Layer/Transport Layer Security) es crucial en un servicio por las siguientes razones:</p> <ul><li>Cifrado: SSL/TLS garantiza una comunicación segura mediante la encriptación de la transmisión de datos y previene el acceso no autorizado a información sensible.</li> <li>Integridad de datos: SSL/TLS verifica que los datos no se modifiquen durante la transmisión, evitando la manipulación o modificación por parte de actores maliciosos.</li> <li>Autenticación: SSL/TLS permite la autenticación del servidor, validando la identidad del servidor para establecer confianza con los clientes y evitar suplantaciones.</li> <li>Confianza y credibilidad: Implementar SSL/TLS genera confianza y credibilidad con los usuarios, asegurándoles que sus datos están protegidos y fomentando una experiencia de usuario positiva.</li> <li>Cumplimiento: A menudo, se requiere SSL/TLS para el cumplimiento normativo, garantizando la protección de datos sensibles y el cumplimiento de estándares y regulaciones de la industria.</li></ul> <p><strong>En este ejemplo, utilizaremos certificados autofirmados, pero no los utilices en producción. Solo lo hacemos para demostrar cómo asegurar nuestras comunicaciones.</strong></p> <p>Creemos una carpeta llamada cert y, con este script, generaremos nuestro almacén de claves (keystore) que contiene la clave privada y pública del servidor y su certificado para mostrarlo a los clientes.</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token shebang important">#!/usr/bin/env bash</span>
<span class="token comment">## Server KeyStore: Private Key + Public Certificate (PKCS12)</span>
keytool -genkeypair -alias serverKeyPair -keyalg RSA -keysize <span class="token number">4096</span> -validity <span class="token number">365</span> -storetype PKCS12 -keystore server_keystore.p12 -storepass <span class="token number">1234567</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="anadiendo-dependencias-2"><a href="#anadiendo-dependencias-2" class="header-anchor">#</a> Añadiendo dependencias</h3> <p>Agregamos las siguientes dependencias en nuestro archivo build.gradle.kts y sincronizamos el proyecto.</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token comment">// SSL/TLS</span>
<span class="token function">implementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;io.ktor:ktor-network-tls-certificates:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">ktor_version</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="configurar-ssl-tls"><a href="#configurar-ssl-tls" class="header-anchor">#</a> Configurar SSL/TLS</h3> <p>Ahora es el momento de configurar el <a href="https://ktor.io/docs/ssl.html" target="_blank" rel="noopener noreferrer">servicio<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Agregaremos esta opción en nuestro archivo de configuración application.conf con el puerto seguro y las opciones de SSL.</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>ktor <span class="token punctuation">{</span>
    deployment <span class="token punctuation">{</span>
        port = <span class="token number">8080</span>
        port = $<span class="token punctuation">{</span>?PORT<span class="token punctuation">}</span>
        ## SSL<span class="token punctuation">,</span> you need to enable it
        sslPort = <span class="token number">8083</span>
        sslPort = $<span class="token punctuation">{</span>?SSL_PORT<span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    # Configure the main module
    application <span class="token punctuation">{</span>
        modules = <span class="token punctuation">[</span> joseluisgs.dev.ApplicationKt.module <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>

    ## Development mode
    # Enable development mode. Recommended to set it via -Dktor.deployment.environment=development
    # development = <span class="token boolean">true</span>
    deployment <span class="token punctuation">{</span>
        ## Watch for changes in this directory and automatically reload the application if any file changes.
        watch = <span class="token punctuation">[</span> classes<span class="token punctuation">,</span> resources <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>

    ## Modo de ejecución
    environment = dev
    environment = $<span class="token punctuation">{</span>?KTOR_ENV<span class="token punctuation">}</span>

    ## To enable SSL<span class="token punctuation">,</span> you need to generate a certificate and configure it here
    security <span class="token punctuation">{</span>
        ssl <span class="token punctuation">{</span>
           keyStore = cert/server_keystore.p12
           keyAlias = <span class="token string">&quot;serverKeyPair&quot;</span>
           keyStorePassword = <span class="token string">&quot;1234567&quot;</span>
           privateKeyPassword = <span class="token string">&quot;1234567&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>A partir de ahora, todas las solicitudes al puerto seguro con Postman estarán encriptadas.</p> <p style="text-align:center;"><img loading="lazy" src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*9uy87-i-QYG-J0fb7Sh5ug.png" style="border-radius:0.25rem;"></p> <h2 id="documentar-nuestro-servicio"><a href="#documentar-nuestro-servicio" class="header-anchor">#</a> Documentar nuestro servicio</h2> <p>Es hora de documentar nuestro servicio. Utilizaremos Dokka para generar la documentación del código Kotlin y Swagger para la documentación de la API.</p> <p>Dokka es un motor de documentación para Kotlin. Permite a los desarrolladores generar una documentación completa para su código, incluyendo clases, funciones, propiedades y más. Dokka analiza el código fuente y genera documentación en formato HTML u otros formatos que los desarrolladores pueden navegar y acceder fácilmente.</p> <p>Swagger es un marco de trabajo de código abierto y una herramienta poderosa para diseñar, construir, documentar y consumir APIs RESTful. Proporciona un conjunto de herramientas que permiten a los desarrolladores definir especificaciones de API utilizando la especificación OpenAPI (OAS), anteriormente conocida como Swagger Specification. Con Swagger, los desarrolladores pueden crear documentación interactiva de la API que incluye detalles sobre los endpoints, formatos de solicitud/respuesta, parámetros, requisitos de autenticación y más. También permite probar y explorar las API directamente desde la documentación.</p> <h3 id="anadiendo-dependencias-3"><a href="#anadiendo-dependencias-3" class="header-anchor">#</a> Añadiendo dependencias</h3> <p>Agregamos las siguientes dependencias en nuestro archivo <strong>build.gradle.kts</strong> y sincronizamos el proyecto. Para Dokka, agregamos el plugin.</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token comment">// Dokka for documentation</span>
<span class="token function">id</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;org.jetbrains.dokka&quot;</span></span><span class="token punctuation">)</span> version <span class="token string-literal singleline"><span class="token string">&quot;1.8.10&quot;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Utilizaremos la siguiente biblioteca para Swagger: Ktor Swagger, que ofrece una función de extensión para documentar nuestras rutas.</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code>repositories <span class="token punctuation">{</span>
  <span class="token function">mavenCentral</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">maven</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;https://jitpack.io&quot;</span></span><span class="token punctuation">)</span> <span class="token comment">// For Swagger UI</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Necesitaremos opciones de CORS</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token comment">// CORS</span>
<span class="token function">implementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;io.ktor:ktor-server-cors:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">ktor_version</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
<span class="token comment">// To generate Swagger UI</span>
<span class="token function">implementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;io.github.smiley4:ktor-swagger-ui:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">ktor_swagger_ui_version</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="configurar-los-plugins"><a href="#configurar-los-plugins" class="header-anchor">#</a> Configurar los plugins</h3> <p>Necesitamos configurar el <strong>plugin CORS</strong>. CORS (Cross-Origin Resource Sharing) es un mecanismo de seguridad implementado en los navegadores web que controla el acceso a recursos desde diferentes orígenes. Permite o restringe las solicitudes de origen cruzado, ayudando a prevenir el acceso no autorizado y proteger los datos del usuario. Aquí tienes un ejemplo.</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token keyword">fun</span> Application<span class="token punctuation">.</span><span class="token function">configureCors</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">install</span><span class="token punctuation">(</span>CORS<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">anyHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Allow from any host</span>
    <span class="token function">allowHeader</span><span class="token punctuation">(</span>HttpHeaders<span class="token punctuation">.</span>ContentType<span class="token punctuation">)</span> <span class="token comment">// Allow Content-Type header</span>
    <span class="token function">allowHeader</span><span class="token punctuation">(</span>HttpHeaders<span class="token punctuation">.</span>Authorization<span class="token punctuation">)</span>
    <span class="token function">allowHost</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;client-host&quot;</span></span><span class="token punctuation">)</span> <span class="token comment">// Allow requests from client-host</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>Ahora configuramos el <strong>plugin Swagger</strong> para establecer las opciones globales y detectar los endpoints.</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token keyword">fun</span> Application<span class="token punctuation">.</span><span class="token function">configureSwagger</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// https://github.com/SMILEY4/ktor-swagger-ui/wiki/Configuration</span>
  <span class="token comment">// http://xxx/swagger/</span>
  <span class="token function">install</span><span class="token punctuation">(</span>SwaggerUI<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      swagger <span class="token punctuation">{</span>
          swaggerUrl <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;swagger&quot;</span></span>
          forwardRoot <span class="token operator">=</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>
      info <span class="token punctuation">{</span>
          title <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;Ktor Hyperskill Reactive API REST&quot;</span></span>
          version <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;latest&quot;</span></span>
          description <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;Example of a Ktor API REST using Kotlin and Ktor&quot;</span></span>
          contact <span class="token punctuation">{</span>
              name <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;José Luis González Sánchez&quot;</span></span>
              url <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;https://github.com/joseluisgs&quot;</span></span>
          <span class="token punctuation">}</span>
          license <span class="token punctuation">{</span>
              name <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;Creative Commons Attribution-ShareAlike 4.0 International License&quot;</span></span>
              url <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;https://joseluisgs.dev/docs/license/&quot;</span></span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      schemasInComponentSection <span class="token operator">=</span> <span class="token boolean">true</span>
      examplesInComponentSection <span class="token operator">=</span> <span class="token boolean">true</span>
      automaticTagGenerator <span class="token operator">=</span> <span class="token punctuation">{</span> url <span class="token operator">-&gt;</span> url<span class="token punctuation">.</span><span class="token function">firstOrNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
      <span class="token comment">// We can filter paths and methods</span>
      pathFilter <span class="token operator">=</span> <span class="token punctuation">{</span> method<span class="token punctuation">,</span> url <span class="token operator">-&gt;</span>
          url<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;rackets&quot;</span></span><span class="token punctuation">)</span>
          <span class="token comment">//(method == HttpMethod.Get &amp;&amp; url.firstOrNull() == &quot;api&quot;)</span>
          <span class="token comment">// || url.contains(&quot;test&quot;)</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// We can add security</span>
      <span class="token function">securityScheme</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;JWT-Auth&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          type <span class="token operator">=</span> AuthType<span class="token punctuation">.</span>HTTP
          scheme <span class="token operator">=</span> AuthScheme<span class="token punctuation">.</span>BEARER
          bearerFormat <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;jwt&quot;</span></span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><p>Agregamos estos plugins a nuestro <strong>módulo de la aplicación</strong>:</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token keyword">fun</span> Application<span class="token punctuation">.</span><span class="token function">module</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">configureKoin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Configure the Koin plugin to inject dependencies</span>
  <span class="token function">configureSecurity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Configure the security plugin with JWT</span>
  <span class="token function">configureWebSockets</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Configure the websockets plugin</span>
  <span class="token function">configureSerialization</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Configure the serialization plugin</span>
  <span class="token function">configureRouting</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Configure the routing plugin</span>
  <span class="token function">configureValidation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Configure the validation plugin</span>
  <span class="token function">configureStatusPages</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Configure the status pages plugin</span>
  <span class="token function">configureCompression</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Configure the compression plugin</span>
  <span class="token function">configureCors</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Configure the CORS plugin</span>
  <span class="token function">configureSwagger</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Configure the Swagger plugin</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="documentar-con-dokka"><a href="#documentar-con-dokka" class="header-anchor">#</a> Documentar con Dokka</h3> <p>Para documentar con Dokka, podemos utilizar sus <a href="https://kotlinlang.org/docs/kotlin-doc.html" target="_blank" rel="noopener noreferrer">anotaciones<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token comment">/**
* Find by ID, if not exists return null
* @param id Long ID
* @return Racket? Racket or null
*/</span>
<span class="token keyword">override</span> <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token operator">:</span> Long<span class="token punctuation">)</span><span class="token operator">:</span> Racket<span class="token operator">?</span> <span class="token operator">=</span> <span class="token function">withContext</span><span class="token punctuation">(</span>Dispatchers<span class="token punctuation">.</span>IO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  logger<span class="token punctuation">.</span><span class="token function">debug</span> <span class="token punctuation">{</span> <span class="token string-literal singleline"><span class="token string">&quot;findById: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">id</span></span><span class="token string">&quot;</span></span> <span class="token punctuation">}</span>

  <span class="token keyword">return</span><span class="token label symbol">@withContext</span> <span class="token punctuation">(</span>dataBaseService<span class="token punctuation">.</span>client selectFrom RacketTable
  <span class="token keyword">where</span> RacketTable<span class="token punctuation">.</span>id eq id<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">fetchFirstOrNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">toModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>Ahora con Gradle → Documentation, puedes generar la documentación de Dokka.</p> <p style="text-align:center;"><img loading="lazy" src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*FGHW0Kz2fo5ybGw1K7nGcA.png" style="border-radius:0.25rem;"></p> <h3 id="documentar-con-swagger"><a href="#documentar-con-swagger" class="header-anchor">#</a> Documentar con Swagger</h3> <p>Para documentar con Swagger, podemos completar nuestras rutas y peticiones con opciones de documentación.</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code>routing <span class="token punctuation">{</span>
  <span class="token function">route</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">ENDPOINT</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

      <span class="token comment">// Get all racket --&gt; GET /api/rackets</span>
      <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          description <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;Get All Rackets&quot;</span></span>
          request <span class="token punctuation">{</span>
              queryParameter<span class="token operator">&lt;</span>Int<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;page&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  description <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;page number&quot;</span></span>
                  required <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token comment">// Optional</span>
              <span class="token punctuation">}</span>
              queryParameter<span class="token operator">&lt;</span>Int<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;perPage&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  description <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;number of elements per page&quot;</span></span>
                  required <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token comment">// Optional</span>
              <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
          response <span class="token punctuation">{</span>
              default <span class="token punctuation">{</span>
                  description <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;List of Rackets&quot;</span></span>
              <span class="token punctuation">}</span>
              HttpStatusCode<span class="token punctuation">.</span>OK <span class="token keyword">to</span> <span class="token punctuation">{</span>
                  description <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;List of Rackets&quot;</span></span>
                  body<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>RacketResponse<span class="token operator">&gt;</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span> description <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;List of Rackets&quot;</span></span> <span class="token punctuation">}</span>
              <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// QueryParams: rackets?page=1&amp;perPage=10</span>
          call<span class="token punctuation">.</span>request<span class="token punctuation">.</span>queryParameters<span class="token punctuation">[</span><span class="token string-literal singleline"><span class="token string">&quot;page&quot;</span></span><span class="token punctuation">]</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">toIntOrNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">{</span>
              <span class="token keyword">val</span> page <span class="token operator">=</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>it <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> it <span class="token keyword">else</span> <span class="token number">0</span>
              <span class="token keyword">val</span> perPage <span class="token operator">=</span> call<span class="token punctuation">.</span>request<span class="token punctuation">.</span>queryParameters<span class="token punctuation">[</span><span class="token string-literal singleline"><span class="token string">&quot;perPage&quot;</span></span><span class="token punctuation">]</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">toIntOrNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?:</span> <span class="token number">10</span>

              logger<span class="token punctuation">.</span><span class="token function">debug</span> <span class="token punctuation">{</span> <span class="token string-literal singleline"><span class="token string">&quot;GET ALL /</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">ENDPOINT</span></span><span class="token string">?page=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">page</span></span><span class="token string">&amp;perPage=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">perPage</span></span><span class="token string">&quot;</span></span> <span class="token punctuation">}</span>

              racketsService<span class="token punctuation">.</span><span class="token function">findAllPageable</span><span class="token punctuation">(</span>page<span class="token punctuation">,</span> perPage<span class="token punctuation">)</span>
                  <span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                  <span class="token punctuation">.</span><span class="token function">run</span> <span class="token punctuation">{</span>
                      call<span class="token punctuation">.</span><span class="token function">respond</span><span class="token punctuation">(</span>HttpStatusCode<span class="token punctuation">.</span>OK<span class="token punctuation">,</span> <span class="token function">RacketPage</span><span class="token punctuation">(</span>page<span class="token punctuation">,</span> perPage<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">toResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                  <span class="token punctuation">}</span>

          <span class="token punctuation">}</span> <span class="token operator">?:</span> run <span class="token punctuation">{</span>
              logger<span class="token punctuation">.</span><span class="token function">debug</span> <span class="token punctuation">{</span> <span class="token string-literal singleline"><span class="token string">&quot;GET ALL /</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">ENDPOINT</span></span><span class="token string">&quot;</span></span> <span class="token punctuation">}</span>

              racketsService<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                  <span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                  <span class="token punctuation">.</span><span class="token function">run</span> <span class="token punctuation">{</span> call<span class="token punctuation">.</span><span class="token function">respond</span><span class="token punctuation">(</span>HttpStatusCode<span class="token punctuation">.</span>OK<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">toResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// Get one racket by id --&gt; GET /api/rackets/{id}</span>
      <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;{id}&quot;</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
          description <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;Get Racket by ID&quot;</span></span>
          request <span class="token punctuation">{</span>
              pathParameter<span class="token operator">&lt;</span>Long<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;id&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  description <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;Racket ID&quot;</span></span>
              <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
          response <span class="token punctuation">{</span>
              HttpStatusCode<span class="token punctuation">.</span>OK <span class="token keyword">to</span> <span class="token punctuation">{</span>
                  description <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;Racket&quot;</span></span>
                  body<span class="token operator">&lt;</span>RacketResponse<span class="token operator">&gt;</span> <span class="token punctuation">{</span> description <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;Racket&quot;</span></span> <span class="token punctuation">}</span>
              <span class="token punctuation">}</span>
              HttpStatusCode<span class="token punctuation">.</span>NotFound <span class="token keyword">to</span> <span class="token punctuation">{</span>
                  description <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;Racket not found&quot;</span></span>
                  body<span class="token operator">&lt;</span>RacketError<span class="token punctuation">.</span>NotFound<span class="token operator">&gt;</span> <span class="token punctuation">{</span> description <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;Racket not found&quot;</span></span> <span class="token punctuation">}</span>
              <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          logger<span class="token punctuation">.</span><span class="token function">debug</span> <span class="token punctuation">{</span> <span class="token string-literal singleline"><span class="token string">&quot;GET BY ID /</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">ENDPOINT</span></span><span class="token string">/{id}&quot;</span></span> <span class="token punctuation">}</span>

          call<span class="token punctuation">.</span>parameters<span class="token punctuation">[</span><span class="token string-literal singleline"><span class="token string">&quot;id&quot;</span></span><span class="token punctuation">]</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">toLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">{</span> id <span class="token operator">-&gt;</span>
              racketsService<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mapBoth</span><span class="token punctuation">(</span>
                  success <span class="token operator">=</span> <span class="token punctuation">{</span> call<span class="token punctuation">.</span><span class="token function">respond</span><span class="token punctuation">(</span>HttpStatusCode<span class="token punctuation">.</span>OK<span class="token punctuation">,</span> it<span class="token punctuation">.</span><span class="token function">toResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                  failure <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function">handleRacketErrors</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span> <span class="token punctuation">}</span>
              <span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
<span class="token comment">//...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br></div></div><p>Ahora podemos ver la documentación de Swagger en http://0.0.0.0:8080/swagger.</p> <p style="text-align:center;"><img loading="lazy" src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*7OF1d1p_t8zB9qOJ-KCOyw.png" style="border-radius:0.25rem;"></p> <h2 id="test-de-las-rutas"><a href="#test-de-las-rutas" class="header-anchor">#</a> Test de las rutas</h2> <p>En tutoriales anteriores, hemos aprendido cómo probar nuestros repositorios o servicios, ya sea a través de pruebas unitarias o pruebas con dobles utilizando mocks. Ahora es el momento de probar nuestros endpoints. Hemos utilizado Postman, que es excelente para estos escenarios y se puede optimizar para realizar pruebas eficientes de los endpoints. Sin embargo, Ktor proporciona un motor de pruebas especial que no crea un servidor web, no se vincula a sockets y no realiza ninguna solicitud HTTP real. En su lugar, se conecta directamente a los mecanismos internos y procesa una llamada de aplicación. Esto resulta en una ejecución de pruebas más rápida en comparación con ejecutar un servidor web completo para las pruebas. Saber cómo utilizar estas herramientas para mejorar nuestras implementaciones y optimizar las pruebas es excelente.</p> <h3 id="anaadir-dependencias"><a href="#anaadir-dependencias" class="header-anchor">#</a> Añaadir dependencias</h3> <p>Agrega las siguientes dependencias en nuestro archivo <strong>build.gradle.kts</strong> y sincroniza el proyecto.</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token comment">// Ktor Test</span>
<span class="token function">testImplementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;io.ktor:ktor-server-test-host:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">ktor_version</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
<span class="token function">implementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;io.ktor:ktor-client-content-negotiation:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">ktor_version</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span> <span class="token comment">// For testing with Ktor Client JSON</span>
<span class="token function">implementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;io.ktor:ktor-client-auth:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">ktor_version</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span> <span class="token comment">// For testing with Ktor Client Auth JWT</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="pruebas"><a href="#pruebas" class="header-anchor">#</a> Pruebas</h3> <p>Ahora podemos probar las rutas deseadas de forma rápida y eficiente utilizando este método. Puedes pasar tokens como encabezados o procesar solicitudes multipart para subir imágenes.</p> <p>Un ejemplo con raquetas</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token keyword">private</span> <span class="token keyword">val</span> json <span class="token operator">=</span> Json <span class="token punctuation">{</span> ignoreUnknownKeys <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>

<span class="token annotation builtin">@TestInstance</span><span class="token punctuation">(</span>TestInstance<span class="token punctuation">.</span>Lifecycle<span class="token punctuation">.</span>PER_CLASS<span class="token punctuation">)</span>
<span class="token annotation builtin">@TestMethodOrder</span><span class="token punctuation">(</span>MethodOrderer<span class="token punctuation">.</span>OrderAnnotation<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> RacketsRoutesKtTest <span class="token punctuation">{</span>
  <span class="token comment">// Load configuration from application.conf</span>
  <span class="token keyword">private</span> <span class="token keyword">val</span> config <span class="token operator">=</span> <span class="token function">ApplicationConfig</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;application.conf&quot;</span></span><span class="token punctuation">)</span>

  <span class="token keyword">val</span> racket <span class="token operator">=</span> <span class="token function">RacketRequest</span><span class="token punctuation">(</span>
      brand <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;Test&quot;</span></span><span class="token punctuation">,</span>
      model <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;Test&quot;</span></span><span class="token punctuation">,</span>
      price <span class="token operator">=</span> <span class="token number">10.0</span><span class="token punctuation">,</span>
      numberTenisPlayers <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span>

  <span class="token comment">// New we can user it to test routes with Ktor</span>
  <span class="token annotation builtin">@Test</span>
  <span class="token annotation builtin">@Order</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token keyword">fun</span> <span class="token function">testGetAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> testApplication <span class="token punctuation">{</span>
      <span class="token comment">// Set up the test environment</span>
      environment <span class="token punctuation">{</span> config <span class="token punctuation">}</span>

      <span class="token comment">// Launch the test</span>
      <span class="token keyword">val</span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;/api/rackets&quot;</span></span><span class="token punctuation">)</span>

      <span class="token comment">// Check the response and the content</span>
      <span class="token function">assertEquals</span><span class="token punctuation">(</span>HttpStatusCode<span class="token punctuation">.</span>OK<span class="token punctuation">,</span> response<span class="token punctuation">.</span>status<span class="token punctuation">)</span>
      <span class="token comment">// Check the content if we want</span>
      <span class="token comment">// val result = response.bodyAsText()</span>
      <span class="token comment">// val list = json.decodeFromString&lt;List&lt;RacketResponse&gt;&gt;(result)</span>
      <span class="token comment">// ....</span>

  <span class="token punctuation">}</span>
<span class="token comment">//...</span>
  <span class="token annotation builtin">@Test</span>
  <span class="token annotation builtin">@Order</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
  <span class="token keyword">fun</span> <span class="token function">testPut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> testApplication <span class="token punctuation">{</span>
      environment <span class="token punctuation">{</span> config <span class="token punctuation">}</span>
  
      <span class="token keyword">val</span> client <span class="token operator">=</span> createClient <span class="token punctuation">{</span>
          <span class="token function">install</span><span class="token punctuation">(</span>ContentNegotiation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
  
      <span class="token comment">// Create</span>
      <span class="token keyword">var</span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;/api/rackets&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">contentType</span><span class="token punctuation">(</span>ContentType<span class="token punctuation">.</span>Application<span class="token punctuation">.</span>Json<span class="token punctuation">)</span>
          <span class="token function">setBody</span><span class="token punctuation">(</span>racket<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
  
      <span class="token comment">// Take the id of the result</span>
      <span class="token keyword">var</span> dto <span class="token operator">=</span> json<span class="token punctuation">.</span>decodeFromString<span class="token operator">&lt;</span>RacketResponse<span class="token operator">&gt;</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">bodyAsText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  
      <span class="token comment">// Update</span>
      response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;/api/rackets/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">dto<span class="token punctuation">.</span>id</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">contentType</span><span class="token punctuation">(</span>ContentType<span class="token punctuation">.</span>Application<span class="token punctuation">.</span>Json<span class="token punctuation">)</span>
          <span class="token function">setBody</span><span class="token punctuation">(</span>racket<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>brand <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;TestBrand2&quot;</span></span><span class="token punctuation">,</span> model <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;TestModel2&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
  
      <span class="token comment">// Check that the response and the content is correct</span>
      <span class="token function">assertEquals</span><span class="token punctuation">(</span>HttpStatusCode<span class="token punctuation">.</span>OK<span class="token punctuation">,</span> response<span class="token punctuation">.</span>status<span class="token punctuation">)</span>
      <span class="token keyword">val</span> result <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">bodyAsText</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      dto <span class="token operator">=</span> json<span class="token punctuation">.</span>decodeFromString<span class="token operator">&lt;</span>RacketResponse<span class="token operator">&gt;</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
      <span class="token function">assertAll</span><span class="token punctuation">(</span>
          <span class="token punctuation">{</span> <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;TestBrand2&quot;</span></span><span class="token punctuation">,</span> dto<span class="token punctuation">.</span>brand<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span> <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;TestModel2&quot;</span></span><span class="token punctuation">,</span> dto<span class="token punctuation">.</span>model<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span> <span class="token function">assertEquals</span><span class="token punctuation">(</span>racket<span class="token punctuation">.</span>price<span class="token punctuation">,</span> dto<span class="token punctuation">.</span>price<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span> <span class="token function">assertEquals</span><span class="token punctuation">(</span>racket<span class="token punctuation">.</span>numberTenisPlayers<span class="token punctuation">,</span> dto<span class="token punctuation">.</span>numberTenisPlayers<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token annotation builtin">@Test</span>
  <span class="token annotation builtin">@Order</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
  <span class="token keyword">fun</span> <span class="token function">testPutNotFound</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> testApplication <span class="token punctuation">{</span>
      environment <span class="token punctuation">{</span> config <span class="token punctuation">}</span>
  
      <span class="token keyword">val</span> client <span class="token operator">=</span> createClient <span class="token punctuation">{</span>
          <span class="token function">install</span><span class="token punctuation">(</span>ContentNegotiation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
  
      <span class="token keyword">val</span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;/api/rackets/-1&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">contentType</span><span class="token punctuation">(</span>ContentType<span class="token punctuation">.</span>Application<span class="token punctuation">.</span>Json<span class="token punctuation">)</span>
          <span class="token function">setBody</span><span class="token punctuation">(</span>racket<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>brand <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;TestBrand2&quot;</span></span><span class="token punctuation">,</span> model <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;TestModel2&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
  
      <span class="token function">assertEquals</span><span class="token punctuation">(</span>HttpStatusCode<span class="token punctuation">.</span>NotFound<span class="token punctuation">,</span> response<span class="token punctuation">.</span>status<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br></div></div><p>O usando JWT con usuarios</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token keyword">private</span> <span class="token keyword">val</span> json <span class="token operator">=</span> Json <span class="token punctuation">{</span> ignoreUnknownKeys <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>

<span class="token annotation builtin">@TestInstance</span><span class="token punctuation">(</span>TestInstance<span class="token punctuation">.</span>Lifecycle<span class="token punctuation">.</span>PER_CLASS<span class="token punctuation">)</span>
<span class="token annotation builtin">@TestMethodOrder</span><span class="token punctuation">(</span>MethodOrderer<span class="token punctuation">.</span>OrderAnnotation<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> UsersRoutesKtTest <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token keyword">val</span> config <span class="token operator">=</span> <span class="token function">ApplicationConfig</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;application.conf&quot;</span></span><span class="token punctuation">)</span>

  <span class="token keyword">val</span> userDto <span class="token operator">=</span> <span class="token function">UserCreateDto</span><span class="token punctuation">(</span>
      name <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;Test&quot;</span></span><span class="token punctuation">,</span>
      email <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;test@test.com&quot;</span></span><span class="token punctuation">,</span>
      username <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;test&quot;</span></span><span class="token punctuation">,</span>
      password <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;test12345&quot;</span></span><span class="token punctuation">,</span>
      avatar <span class="token operator">=</span> User<span class="token punctuation">.</span>DEFAULT_IMAGE<span class="token punctuation">,</span>
      role <span class="token operator">=</span> User<span class="token punctuation">.</span>Role<span class="token punctuation">.</span>USER
  <span class="token punctuation">)</span>

  <span class="token keyword">val</span> userLoginDto <span class="token operator">=</span> <span class="token function">UserLoginDto</span><span class="token punctuation">(</span>
      username <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;test&quot;</span></span><span class="token punctuation">,</span>
      password <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;test12345&quot;</span></span>
  <span class="token punctuation">)</span>

  <span class="token keyword">val</span> userLoginAdminDto <span class="token operator">=</span> <span class="token function">UserLoginDto</span><span class="token punctuation">(</span>
      username <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;pepe&quot;</span></span><span class="token punctuation">,</span>
      password <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;pepe1234&quot;</span></span>
  <span class="token punctuation">)</span>

  <span class="token annotation builtin">@Test</span>
  <span class="token annotation builtin">@Order</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token keyword">fun</span> <span class="token function">registerUserTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> testApplication <span class="token punctuation">{</span>
      <span class="token comment">// Set up the test environment</span>
      environment <span class="token punctuation">{</span> config <span class="token punctuation">}</span>
      <span class="token keyword">val</span> client <span class="token operator">=</span> createClient <span class="token punctuation">{</span>
          <span class="token function">install</span><span class="token punctuation">(</span>ContentNegotiation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// Launch the test</span>
      <span class="token keyword">val</span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;/api/users/register&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">contentType</span><span class="token punctuation">(</span>ContentType<span class="token punctuation">.</span>Application<span class="token punctuation">.</span>Json<span class="token punctuation">)</span>
          <span class="token function">setBody</span><span class="token punctuation">(</span>userDto<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// Check the response and the content</span>
      <span class="token function">assertEquals</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>status<span class="token punctuation">,</span> HttpStatusCode<span class="token punctuation">.</span>Created<span class="token punctuation">)</span>
      <span class="token keyword">val</span> res <span class="token operator">=</span> json<span class="token punctuation">.</span>decodeFromString<span class="token operator">&lt;</span>UserDto<span class="token operator">&gt;</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">bodyAsText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token function">assertAll</span><span class="token punctuation">(</span>
          <span class="token punctuation">{</span> <span class="token function">assertEquals</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>name<span class="token punctuation">,</span> userDto<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span> <span class="token function">assertEquals</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>email<span class="token punctuation">,</span> userDto<span class="token punctuation">.</span>email<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span> <span class="token function">assertEquals</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>username<span class="token punctuation">,</span> userDto<span class="token punctuation">.</span>username<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span> <span class="token function">assertEquals</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>avatar<span class="token punctuation">,</span> userDto<span class="token punctuation">.</span>avatar<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span> <span class="token function">assertEquals</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>role<span class="token punctuation">,</span> userDto<span class="token punctuation">.</span>role<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>


  <span class="token annotation builtin">@Test</span>
  <span class="token annotation builtin">@Order</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token keyword">fun</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> testApplication <span class="token punctuation">{</span>
      environment <span class="token punctuation">{</span> config <span class="token punctuation">}</span>
      <span class="token keyword">val</span> client <span class="token operator">=</span> createClient <span class="token punctuation">{</span>
          <span class="token function">install</span><span class="token punctuation">(</span>ContentNegotiation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      client<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;/api/users/register&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">contentType</span><span class="token punctuation">(</span>ContentType<span class="token punctuation">.</span>Application<span class="token punctuation">.</span>Json<span class="token punctuation">)</span>
          <span class="token function">setBody</span><span class="token punctuation">(</span>userDto<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">val</span> responseLogin <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;/api/users/login&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">contentType</span><span class="token punctuation">(</span>ContentType<span class="token punctuation">.</span>Application<span class="token punctuation">.</span>Json<span class="token punctuation">)</span>
          <span class="token function">setBody</span><span class="token punctuation">(</span>userLoginDto<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>

      <span class="token function">assertEquals</span><span class="token punctuation">(</span>responseLogin<span class="token punctuation">.</span>status<span class="token punctuation">,</span> HttpStatusCode<span class="token punctuation">.</span>OK<span class="token punctuation">)</span>
      <span class="token keyword">val</span> res <span class="token operator">=</span> json<span class="token punctuation">.</span>decodeFromString<span class="token operator">&lt;</span>UserWithTokenDto<span class="token operator">&gt;</span><span class="token punctuation">(</span>responseLogin<span class="token punctuation">.</span><span class="token function">bodyAsText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token function">assertAll</span><span class="token punctuation">(</span>
          <span class="token punctuation">{</span> <span class="token function">assertEquals</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>user<span class="token punctuation">.</span>name<span class="token punctuation">,</span> userDto<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span> <span class="token function">assertEquals</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>user<span class="token punctuation">.</span>email<span class="token punctuation">,</span> userDto<span class="token punctuation">.</span>email<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span> <span class="token function">assertEquals</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>user<span class="token punctuation">.</span>username<span class="token punctuation">,</span> userDto<span class="token punctuation">.</span>username<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span> <span class="token function">assertEquals</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>user<span class="token punctuation">.</span>avatar<span class="token punctuation">,</span> userDto<span class="token punctuation">.</span>avatar<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span> <span class="token function">assertEquals</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>user<span class="token punctuation">.</span>role<span class="token punctuation">,</span> userDto<span class="token punctuation">.</span>role<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span> <span class="token function">assertNotNull</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>token<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token annotation builtin">@Test</span>
  <span class="token annotation builtin">@Order</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
  <span class="token keyword">fun</span> <span class="token function">meInfoTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> testApplication <span class="token punctuation">{</span>
      environment <span class="token punctuation">{</span> config <span class="token punctuation">}</span>

      <span class="token keyword">var</span> client <span class="token operator">=</span> createClient <span class="token punctuation">{</span>
          <span class="token function">install</span><span class="token punctuation">(</span>ContentNegotiation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">var</span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;/api/users/register&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">contentType</span><span class="token punctuation">(</span>ContentType<span class="token punctuation">.</span>Application<span class="token punctuation">.</span>Json<span class="token punctuation">)</span>
          <span class="token function">setBody</span><span class="token punctuation">(</span>userDto<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>

      response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;/api/users/login&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">contentType</span><span class="token punctuation">(</span>ContentType<span class="token punctuation">.</span>Application<span class="token punctuation">.</span>Json<span class="token punctuation">)</span>
          <span class="token function">setBody</span><span class="token punctuation">(</span>userLoginDto<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>

      <span class="token function">assertEquals</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>status<span class="token punctuation">,</span> HttpStatusCode<span class="token punctuation">.</span>OK<span class="token punctuation">)</span>

      <span class="token keyword">val</span> res <span class="token operator">=</span> json<span class="token punctuation">.</span>decodeFromString<span class="token operator">&lt;</span>UserWithTokenDto<span class="token operator">&gt;</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">bodyAsText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token comment">// token</span>
      client <span class="token operator">=</span> createClient <span class="token punctuation">{</span>
          <span class="token function">install</span><span class="token punctuation">(</span>ContentNegotiation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
          <span class="token function">install</span><span class="token punctuation">(</span>Auth<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              bearer <span class="token punctuation">{</span>
                  loadTokens <span class="token punctuation">{</span>
                      <span class="token comment">// Load tokens from a local storage and return them as the 'BearerTokens' instance</span>
                      <span class="token function">BearerTokens</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>token<span class="token punctuation">,</span> res<span class="token punctuation">.</span>token<span class="token punctuation">)</span>
                  <span class="token punctuation">}</span>
              <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;/api/users/me&quot;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">contentType</span><span class="token punctuation">(</span>ContentType<span class="token punctuation">.</span>Application<span class="token punctuation">.</span>Json<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>

      <span class="token function">assertEquals</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>status<span class="token punctuation">,</span> HttpStatusCode<span class="token punctuation">.</span>OK<span class="token punctuation">)</span>
      <span class="token keyword">val</span> resUser <span class="token operator">=</span> json<span class="token punctuation">.</span>decodeFromString<span class="token operator">&lt;</span>UserDto<span class="token operator">&gt;</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">bodyAsText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token function">assertAll</span><span class="token punctuation">(</span>
          <span class="token punctuation">{</span> <span class="token function">assertEquals</span><span class="token punctuation">(</span>resUser<span class="token punctuation">.</span>name<span class="token punctuation">,</span> userDto<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span> <span class="token function">assertEquals</span><span class="token punctuation">(</span>resUser<span class="token punctuation">.</span>email<span class="token punctuation">,</span> userDto<span class="token punctuation">.</span>email<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span> <span class="token function">assertEquals</span><span class="token punctuation">(</span>resUser<span class="token punctuation">.</span>username<span class="token punctuation">,</span> userDto<span class="token punctuation">.</span>username<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span> <span class="token function">assertEquals</span><span class="token punctuation">(</span>resUser<span class="token punctuation">.</span>avatar<span class="token punctuation">,</span> userDto<span class="token punctuation">.</span>avatar<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span> <span class="token function">assertEquals</span><span class="token punctuation">(</span>resUser<span class="token punctuation">.</span>role<span class="token punctuation">,</span> userDto<span class="token punctuation">.</span>role<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br></div></div><h2 id="despliegue-con-docker"><a href="#despliegue-con-docker" class="header-anchor">#</a> Despliegue con Docker</h2> <p>A continuación, vamos a desplegar nuestro servicio. Utilizaremos Docker para desplegarlo. Docker es una plataforma de código abierto que permite a los desarrolladores automatizar el despliegue y la gestión de aplicaciones dentro de contenedores aislados. Los contenedores son entornos ligeros, portátiles y autosuficientes que empaquetan todas las dependencias y componentes necesarios para ejecutar una aplicación. Algunas ventajas de desplegar un servicio con Docker son:</p> <ul><li>Portabilidad: Los contenedores Docker pueden ejecutarse de manera consistente en diferentes entornos, como desarrollo, pruebas y producción, garantizando que la aplicación se comporte de la misma manera en todas partes.</li> <li>Escalabilidad: Docker permite escalar fácilmente los servicios desplegando múltiples contenedores en varias máquinas, utilizando eficientemente los recursos.</li> <li>Aislamiento: Los contenedores proporcionan aislamiento a nivel de proceso, evitando conflictos entre dependencias y permitiendo una mejor asignación de recursos.</li> <li>Versionado y Reversiones: Las imágenes Docker se pueden versionar, lo que permite realizar fácilmente reversiones a versiones anteriores en caso de problemas o errores.</li> <li>Integración con DevOps: Docker se integra bien con las prácticas de DevOps, facilitando la integración continua, la entrega continua (CI/CD) y la automatización de infraestructura.</li></ul> <p>Docker simplifica el proceso de implementación, mejora la portabilidad de las aplicaciones y optimiza la utilización de recursos, lo que lo convierte en una opción popular para desplegar y gestionar servicios.</p> <p>Podemos utilizar el <a href="https://ktor.io/docs/docker.html#configure-plugin" target="_blank" rel="noopener noreferrer">plugin Ktor<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> para crear nuestro contenedor y configurarlo.</p> <div class="language-kotlin line-numbers-mode"><pre class="language-kotlin"><code><span class="token comment">// To generate Docker Image with JRE 17</span>
ktor <span class="token punctuation">{</span>
    docker <span class="token punctuation">{</span>
        localImageName<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;hyperskill-reactive-api-kotlin-ktor&quot;</span></span><span class="token punctuation">)</span>
        imageTag<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;0.0.1-preview&quot;</span></span><span class="token punctuation">)</span>
        jreVersion<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>io<span class="token punctuation">.</span>ktor<span class="token punctuation">.</span>plugin<span class="token punctuation">.</span>features<span class="token punctuation">.</span>JreVersion<span class="token punctuation">.</span>JRE_17<span class="token punctuation">)</span>
        portMappings<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>
            <span class="token function">listOf</span><span class="token punctuation">(</span>
                io<span class="token punctuation">.</span>ktor<span class="token punctuation">.</span>plugin<span class="token punctuation">.</span>features<span class="token punctuation">.</span><span class="token function">DockerPortMapping</span><span class="token punctuation">(</span>
                    <span class="token number">8080</span><span class="token punctuation">,</span>
                    <span class="token number">8080</span><span class="token punctuation">,</span>
                    io<span class="token punctuation">.</span>ktor<span class="token punctuation">.</span>plugin<span class="token punctuation">.</span>features<span class="token punctuation">.</span>DockerPortMappingProtocol<span class="token punctuation">.</span>TCP
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                io<span class="token punctuation">.</span>ktor<span class="token punctuation">.</span>plugin<span class="token punctuation">.</span>features<span class="token punctuation">.</span><span class="token function">DockerPortMapping</span><span class="token punctuation">(</span>
                    <span class="token number">8083</span><span class="token punctuation">,</span>
                    <span class="token number">8083</span><span class="token punctuation">,</span>
                    io<span class="token punctuation">.</span>ktor<span class="token punctuation">.</span>plugin<span class="token punctuation">.</span>features<span class="token punctuation">.</span>DockerPortMappingProtocol<span class="token punctuation">.</span>TCP
                <span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>Sin embargo, en este ejemplo, tenemos certificados y mostraremos cómo hacerlo manualmente. Para este propósito, tenemos un archivo Dockerfile que crea un contenedor exclusivamente para generar un JAR ejecutable y posteriormente crear nuestro contenedor final. Además, podemos resumir este proceso en un archivo Docker Compose.</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token comment"># With this file we create a Docker image that contains the application</span>
<span class="token instruction"><span class="token keyword">FROM</span> gradle:7-jdk17 <span class="token keyword">AS</span> build</span>
<span class="token comment"># We create a directory for the application and copy the build.gradle file</span>
<span class="token instruction"><span class="token keyword">COPY</span> <span class="token options"><span class="token property">--chown</span><span class="token punctuation">=</span><span class="token string">gradle:gradle</span></span> . /home/gradle/src</span>
<span class="token instruction"><span class="token keyword">WORKDIR</span> /home/gradle/src</span>
<span class="token instruction"><span class="token keyword">RUN</span> gradle buildFatJar --no-daemon</span>

<span class="token comment"># We create a new image with the application</span>
<span class="token instruction"><span class="token keyword">FROM</span> openjdk:17-jdk-slim-buster</span>
<span class="token instruction"><span class="token keyword">EXPOSE</span> 8080:8080</span>
<span class="token instruction"><span class="token keyword">EXPOSE</span> 8083:8082</span>
<span class="token comment"># Directory to store the application</span>
<span class="token instruction"><span class="token keyword">RUN</span> mkdir /app</span>
<span class="token comment"># Copy the certificate to the container (if it is necessary)</span>
<span class="token instruction"><span class="token keyword">RUN</span> mkdir /cert</span>
<span class="token instruction"><span class="token keyword">COPY</span> <span class="token options"><span class="token property">--from</span><span class="token punctuation">=</span><span class="token string">build</span></span> /home/gradle/src/cert/* /cert/</span>
<span class="token comment"># Copy the jar file to the container</span>
<span class="token instruction"><span class="token keyword">COPY</span> <span class="token options"><span class="token property">--from</span><span class="token punctuation">=</span><span class="token string">build</span></span> /home/gradle/src/build/libs/ktor-reactive-rest-hyperskill-all.jar /app/ktor-reactive-rest-hyperskill.jar</span>
<span class="token comment"># Run the application</span>
<span class="token instruction"><span class="token keyword">ENTRYPOINT</span> [<span class="token string">&quot;java&quot;</span>,<span class="token string">&quot;-jar&quot;</span>,<span class="token string">&quot;/app/ktor-reactive-rest-hyperskill.jar&quot;</span>]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p style="text-align:center;"><img loading="lazy" src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*ueiFS6nNw0hYEVpJG0QuZA.png" style="border-radius:0.25rem;"></p> <h2 id="¿y-ahora-como-podrias-continuar"><a href="#¿y-ahora-como-podrias-continuar" class="header-anchor">#</a> ¿Y ahora cómo podrías continuar?</h2> <p>Espero que esta serie de tutoriales haya sido interesante y te haya abierto opciones para desarrollarte como programador, creando tus propios servicios. Pero esto es solo la punta del iceberg de las muchas cosas que puedes hacer. El único límite que tendrás eres tú mismo, así que te invito a seguir mejorando y programando tus servicios.</p> <p>Tienes el código de este proyecto en <a href="https://github.com/joseluisgs/ktor-reactive-rest-hyperskill" target="_blank" rel="noopener noreferrer">https://github.com/joseluisgs/ktor-reactive-rest-hyperskill<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. El código de esta parte está en este enlace: <a href="https://github.com/joseluisgs/ktor-reactive-rest-hyperskill/releases" target="_blank" rel="noopener noreferrer">https://github.com/joseluisgs/ktor-reactive-rest-hyperskill/releases<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Por favor, no olvides dar una estrella o seguirme para estar al tanto de nuevos tutoriales y noticias.</p> <p><strong>Puedes seguirlo commit por commit y usar el archivo de respaldo de Postman para probarlo</strong>.</p> <p>Recuerda que este no es un código para usar en un entorno real o de producción. Es un proyecto didáctico para que puedas experimentar, analizar, mejorar o adaptar a tu forma de programar. Se trata de presentar conceptos y ver cómo funcionan. Cualquier sugerencia o propuesta que tengas, puedes hacer un &quot;issue&quot; o una solicitud de extracción (pull request).</p> <p>Sin embargo, todavía tenemos muchas secciones por cubrir y contenido para que profundices y refuerces en <a href="https://hyperskill.org" target="_blank" rel="noopener noreferrer">Hyperskill<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> a través de diferentes temas y tareas que te ayudarán a mejorar como desarrollador en tecnologías Kotlin. Las siguientes pistas ofrecidas por JetBrains Academy en Hyperskill pueden ser un punto de partida perfecto. Toda la información y explicación de conceptos y técnicas se muestran en estos artículos. ¡No te los pierdas!</p> <ul><li><a href="https://hyperskill.org/tracks/3?category=4&amp;utm_source=medium_hs&amp;utm_medium=social&amp;utm_campaign=ktor&amp;utm_term=16.05.2023" target="_blank" rel="noopener noreferrer">Desarrollador Kotlin<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://hyperskill.org/tracks/45?category=20&amp;utm_source=medium_hs&amp;utm_medium=social&amp;utm_campaign=ktor&amp;utm_term=16.05.2023" target="_blank" rel="noopener noreferrer">Desarrollador Backend Kotlin (Ktor)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>Estas pistas te brindarán experiencia práctica utilizando herramientas de vanguardia y te enseñarán cómo construir aplicaciones del lado del servidor, asegurar el almacenamiento persistente de datos en bases de datos y probar de manera efectiva la funcionalidad de tus aplicaciones utilizando herramientas modernas.</p> <p>Te animamos a dejar cualquier pregunta o comentario en la sección de comentarios debajo de esta publicación del blog. Además, puedes seguirnos en plataformas de redes sociales como en <a href="https://www.reddit.com/r/Hyperskill/" target="_blank" rel="noopener noreferrer">Reddit<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, <a href="https://twitter.com/yourhyperskill" target="_blank" rel="noopener noreferrer">Twitter<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, <a href="https://www.linkedin.com/company/hyperskill" target="_blank" rel="noopener noreferrer">LinkedIn<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> y <a href="https://www.facebook.com/myhyperskill" target="_blank" rel="noopener noreferrer">Facebook<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> para estar informado sobre nuestros últimos artículos y proyectos.</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span data-icon="clarity:note-edit-line" class="prefix iconify"></span> <span class="prefix">Actualizado: </span> <span class="time">27/10/2023, 12:20:24. </span> <span class="time"><a href="https://forms.gle/V2m42qiW1s6X4oNt8" target="_blank"><span data-icon="fluent:comment-error-16-regular" class="iconify"></span> ¿Algún
            error?</a></span></div> <div class="giscus"><giscus-widget id="comentarios" repo="joseluisgs/joseluisgs.github.io" repoid="MDEwOlJlcG9zaXRvcnkzMjg3NzQ4OTU=" category="General" categoryid="DIC_kwDOE5i0784CTUPm" mapping="og:title" reactionsenabled="1" emitmetadata="0" inputposition="bottom" theme="light" lang="es" crossorigin="anonymous" loading="lazy"></giscus-widget></div></footer> <!----> <div class="footer-wrapper footer" data-v-6e5e02f6><span data-v-6e5e02f6><span data-icon="fluent:code-circle-20-filled" class="iconify-inline iconfont" data-v-6e5e02f6></span> <a href="/docs/info/personal/" data-v-6e5e02f6><span data-v-6e5e02f6>José Luis González
        </span> 
      <span data-v-6e5e02f6>
        2025
      </span></a></span> <span data-v-6e5e02f6><a target="blank" href="https://github.com/joseluisgs" data-v-6e5e02f6><span data-icon="mdi:github" class="iconify-inline iconfont" data-v-6e5e02f6></span></a> <a target="blank" href="https://x.com/JoseLuisGS_" data-v-6e5e02f6><span data-icon="fa6-brands:x-twitter" class="iconify-inline iconfont" data-v-6e5e02f6></span></a> <a target="blank" href="https://linkedin.com/in/joseluisgonsan" data-v-6e5e02f6><span data-icon="mdi:linkedin" class="iconify-inline iconfont" data-v-6e5e02f6></span></a> <a target="blank" href="https://www.instagram.com/joseluisgs.dev" data-v-6e5e02f6><span data-icon="mdi:instagram" class="iconify-inline iconfont" data-v-6e5e02f6></span></a> <a target="blank" href="https://g.dev/joseluisgs" data-v-6e5e02f6><span data-icon="raphael:code" class="iconify-inline iconfont" data-v-6e5e02f6></span></a> <a target="blank" href="https://www.youtube.com/@joseluisgs" data-v-6e5e02f6><span data-icon="mdi:youtube" class="iconify-inline iconfont" data-v-6e5e02f6></span></a></span> <span data-v-6e5e02f6><!---->
       
    <!----></span></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-cb1513f6><li class="level-2" data-v-cb1513f6><a href="/blogs/2023/2023-07-10-reactive-api-rest-pt-iii.html#introduccion" class="sidebar-link reco-side-introduccion" data-v-cb1513f6>Introducción</a></li><li class="level-2" data-v-cb1513f6><a href="/blogs/2023/2023-07-10-reactive-api-rest-pt-iii.html#inyeccion-de-dependencias-con-koin" class="sidebar-link reco-side-inyeccion-de-dependencias-con-koin" data-v-cb1513f6>Inyección de dependencias con Koin</a></li><li class="level-3" data-v-cb1513f6><a href="/blogs/2023/2023-07-10-reactive-api-rest-pt-iii.html#configuracion-de-koin" class="sidebar-link reco-side-configuracion-de-koin" data-v-cb1513f6>Configuración de Koin</a></li><li class="level-3" data-v-cb1513f6><a href="/blogs/2023/2023-07-10-reactive-api-rest-pt-iii.html#inyeccion-de-la-configuracion" class="sidebar-link reco-side-inyeccion-de-la-configuracion" data-v-cb1513f6>Inyección de la configuración</a></li><li class="level-3" data-v-cb1513f6><a href="/blogs/2023/2023-07-10-reactive-api-rest-pt-iii.html#preparando-el-repositorio-y-los-servicios" class="sidebar-link reco-side-preparando-el-repositorio-y-los-servicios" data-v-cb1513f6>Preparando el Repositorio y los Servicios</a></li><li class="level-3" data-v-cb1513f6><a href="/blogs/2023/2023-07-10-reactive-api-rest-pt-iii.html#inyectando-dependencias-en-las-rutas" class="sidebar-link reco-side-inyectando-dependencias-en-las-rutas" data-v-cb1513f6>Inyectando dependencias en las rutas</a></li><li class="level-2" data-v-cb1513f6><a href="/blogs/2023/2023-07-10-reactive-api-rest-pt-iii.html#autenticacion-y-autorizacion-con-jwt" class="sidebar-link reco-side-autenticacion-y-autorizacion-con-jwt" data-v-cb1513f6>Autenticación y autorización con JWT</a></li><li class="level-3" data-v-cb1513f6><a href="/blogs/2023/2023-07-10-reactive-api-rest-pt-iii.html#anadiendo-dependencias" class="sidebar-link reco-side-anadiendo-dependencias" data-v-cb1513f6>Añadiendo dependencias</a></li><li class="level-3" data-v-cb1513f6><a href="/blogs/2023/2023-07-10-reactive-api-rest-pt-iii.html#configuracion-del-token" class="sidebar-link reco-side-configuracion-del-token" data-v-cb1513f6>Configuración del token</a></li><li class="level-3" data-v-cb1513f6><a href="/blogs/2023/2023-07-10-reactive-api-rest-pt-iii.html#servicio-de-tokens" class="sidebar-link reco-side-servicio-de-tokens" data-v-cb1513f6>Servicio de tokens</a></li><li class="level-3" data-v-cb1513f6><a href="/blogs/2023/2023-07-10-reactive-api-rest-pt-iii.html#repositorio-de-usuarios" class="sidebar-link reco-side-repositorio-de-usuarios" data-v-cb1513f6>Repositorio de usuarios</a></li><li class="level-3" data-v-cb1513f6><a href="/blogs/2023/2023-07-10-reactive-api-rest-pt-iii.html#servicio-de-usuarios" class="sidebar-link reco-side-servicio-de-usuarios" data-v-cb1513f6>Servicio de usuarios</a></li><li class="level-3" data-v-cb1513f6><a href="/blogs/2023/2023-07-10-reactive-api-rest-pt-iii.html#configurar-el-plugin-jwt" class="sidebar-link reco-side-configurar-el-plugin-jwt" data-v-cb1513f6>Configurar el plugin JWT</a></li><li class="level-3" data-v-cb1513f6><a href="/blogs/2023/2023-07-10-reactive-api-rest-pt-iii.html#rutas-de-usuarios" class="sidebar-link reco-side-rutas-de-usuarios" data-v-cb1513f6>Rutas de usuarios</a></li><li class="level-2" data-v-cb1513f6><a href="/blogs/2023/2023-07-10-reactive-api-rest-pt-iii.html#ssl-tsl-y-https" class="sidebar-link reco-side-ssl-tsl-y-https" data-v-cb1513f6>SSL/TSL y HTTPS</a></li><li class="level-3" data-v-cb1513f6><a href="/blogs/2023/2023-07-10-reactive-api-rest-pt-iii.html#anadiendo-dependencias-2" class="sidebar-link reco-side-anadiendo-dependencias-2" data-v-cb1513f6>Añadiendo dependencias</a></li><li class="level-3" data-v-cb1513f6><a href="/blogs/2023/2023-07-10-reactive-api-rest-pt-iii.html#configurar-ssl-tls" class="sidebar-link reco-side-configurar-ssl-tls" data-v-cb1513f6>Configurar SSL/TLS</a></li><li class="level-2" data-v-cb1513f6><a href="/blogs/2023/2023-07-10-reactive-api-rest-pt-iii.html#documentar-nuestro-servicio" class="sidebar-link reco-side-documentar-nuestro-servicio" data-v-cb1513f6>Documentar nuestro servicio</a></li><li class="level-3" data-v-cb1513f6><a href="/blogs/2023/2023-07-10-reactive-api-rest-pt-iii.html#anadiendo-dependencias-3" class="sidebar-link reco-side-anadiendo-dependencias-3" data-v-cb1513f6>Añadiendo dependencias</a></li><li class="level-3" data-v-cb1513f6><a href="/blogs/2023/2023-07-10-reactive-api-rest-pt-iii.html#configurar-los-plugins" class="sidebar-link reco-side-configurar-los-plugins" data-v-cb1513f6>Configurar los plugins</a></li><li class="level-3" data-v-cb1513f6><a href="/blogs/2023/2023-07-10-reactive-api-rest-pt-iii.html#documentar-con-dokka" class="sidebar-link reco-side-documentar-con-dokka" data-v-cb1513f6>Documentar con Dokka</a></li><li class="level-3" data-v-cb1513f6><a href="/blogs/2023/2023-07-10-reactive-api-rest-pt-iii.html#documentar-con-swagger" class="sidebar-link reco-side-documentar-con-swagger" data-v-cb1513f6>Documentar con Swagger</a></li><li class="level-2" data-v-cb1513f6><a href="/blogs/2023/2023-07-10-reactive-api-rest-pt-iii.html#test-de-las-rutas" class="sidebar-link reco-side-test-de-las-rutas" data-v-cb1513f6>Test de las rutas</a></li><li class="level-3" data-v-cb1513f6><a href="/blogs/2023/2023-07-10-reactive-api-rest-pt-iii.html#anaadir-dependencias" class="sidebar-link reco-side-anaadir-dependencias" data-v-cb1513f6>Añaadir dependencias</a></li><li class="level-3" data-v-cb1513f6><a href="/blogs/2023/2023-07-10-reactive-api-rest-pt-iii.html#pruebas" class="sidebar-link reco-side-pruebas" data-v-cb1513f6>Pruebas</a></li><li class="level-2" data-v-cb1513f6><a href="/blogs/2023/2023-07-10-reactive-api-rest-pt-iii.html#despliegue-con-docker" class="sidebar-link reco-side-despliegue-con-docker" data-v-cb1513f6>Despliegue con Docker</a></li><li class="level-2" data-v-cb1513f6><a href="/blogs/2023/2023-07-10-reactive-api-rest-pt-iii.html#¿y-ahora-como-podrias-continuar" class="sidebar-link reco-side-¿y-ahora-como-podrias-continuar" data-v-cb1513f6>¿Y ahora cómo podrías continuar?</a></li></ul></main> <!----> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.39fd9e7d.js" defer></script><script src="/assets/js/3.a10607c3.js" defer></script><script src="/assets/js/1.65d7671f.js" defer></script><script src="/assets/js/52.cdf939fe.js" defer></script>
  </body>
</html>
